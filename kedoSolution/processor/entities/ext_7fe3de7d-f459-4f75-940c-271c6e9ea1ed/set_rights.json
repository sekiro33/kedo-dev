{
  "__id": "018c8757-193d-7f5d-be50-b4cd7e4ce5be",
  "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "code": "set_rights",
  "category": "00000000-0000-0000-0000-000000000000",
  "__name": "Выдача прав на элемент",
  "type": "bpmn",
  "draft": false,
  "version": 3,
  "context": [
    {
      "code": "namespace",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "namespace",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "access_settings_name",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Название группы доступа",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "app",
      "type": "REF_ITEM",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Элемент приложения",
        "data": {}
      }
    },
    {
      "code": "access_settings_organization",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "access_settings_organization",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Настройки доступа по организациям",
        "data": {}
      }
    },
    {
      "code": "organization",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "organization",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Организация",
        "data": {}
      }
    },
    {
      "code": "debug",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "debug",
        "data": {
          "additionalType": "text"
        }
      }
    },
    {
      "code": "code",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "code",
        "data": {
          "additionalType": "string"
        }
      }
    }
  ],
  "manualRun": true,
  "readonly": false,
  "__createdAt": "2023-09-13T07:18:27.028095298Z",
  "__createdBy": "b1815b65-1548-40d4-a2c2-8c2edb60ebe9",
  "__updatedAt": "2023-09-29T13:55:51.888711125Z",
  "__updatedBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "process": {
    "items": {
      "00000000-0000-0000-0000-000000000000": {
        "x": 64,
        "y": 256,
        "id": "00000000-0000-0000-0000-000000000000",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "type": "start",
        "color": "#ffffff",
        "exits": ["2e37663a-bbd7-4736-a987-33c42eb84986"],
        "width": 32,
        "height": 32,
        "settings": {
          "formFields": [
            {
              "code": "__name",
              "display": "Название",
              "tooltip": "Название экземпляра процесса, будет показываться в задачах",
              "readonly": false,
              "required": true
            }
          ],
          "instruction": "",
          "notifyMessage": "Запущен процесс",
          "titleTemplate": "Выдача прав на элемент - {$__createdAt}",
          "titleGenerateMethod": "template"
        }
      },
      "03f39561-c965-4d77-915f-aa098483172d": {
        "x": 336,
        "y": 384,
        "id": "03f39561-c965-4d77-915f-aa098483172d",
        "icon": "end",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "4379ba97-edb0-4fd1-b2f1-bb3880021de8": {
        "x": 448,
        "y": 240,
        "id": "4379ba97-edb0-4fd1-b2f1-bb3880021de8",
        "icon": "script",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "Определить организацию и настройки доступа",
        "type": "script",
        "color": "#fde9a0",
        "exits": [
          "4d81c068-c288-492b-a38a-6cf007a360b3",
          "e0b6ddc8-4c6e-45e7-8319-2c90f5ee6230"
        ],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "get_access_settings",
          "count": 1,
          "delay": 5,
          "retry": false,
          "escalation": {
            "byError": {
              "exit": "e0b6ddc8-4c6e-45e7-8319-2c90f5ee6230",
              "notify": false,
              "interrupt": true,
              "receivers": []
            }
          }
        }
      },
      "96f0ba7d-45c1-40d4-975b-3ab8baf4122d": {
        "x": 824,
        "y": 256,
        "id": "96f0ba7d-45c1-40d4-975b-3ab8baf4122d",
        "icon": "end",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "bf372919-2aa2-4f76-a91f-57ccfdcecf40": {
        "x": 336,
        "y": 256,
        "id": "bf372919-2aa2-4f76-a91f-57ccfdcecf40",
        "icon": "exclusive",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "Проверка типа элемента",
        "type": "gateway",
        "color": "#ffffff",
        "exits": [
          "5c1284aa-4a8a-4304-9ff5-b9592ce374a7",
          "761d319e-5599-4872-ba3b-a6b8534d3ed8"
        ],
        "width": 32,
        "height": 32,
        "settings": {
          "func": "check_app_code",
          "type": "exclusive",
          "useFunc": true,
          "funcType": "BOOLEAN",
          "description": ""
        }
      },
      "c2587080-97e6-4b1f-9926-132c3c15c9a8": {
        "x": 136,
        "y": 240,
        "id": "c2587080-97e6-4b1f-9926-132c3c15c9a8",
        "icon": "script",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "Определить тип элемента",
        "type": "script",
        "color": "#fde9a0",
        "exits": [
          "ca37e2ed-ad5f-4d6c-b3c1-5b0ca67b86a7",
          "48ec311a-8fe8-47e4-9414-5f428c22c067"
        ],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "get_app_type",
          "count": 1,
          "delay": 5,
          "retry": false,
          "escalation": {
            "byError": {
              "exit": "48ec311a-8fe8-47e4-9414-5f428c22c067",
              "notify": false,
              "interrupt": true,
              "receivers": []
            }
          }
        }
      },
      "d9b44da1-eb37-4cd5-a0ab-c7bc588f09f2": {
        "x": 584,
        "y": 240,
        "id": "d9b44da1-eb37-4cd5-a0ab-c7bc588f09f2",
        "icon": "script",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "Выдача прав на элемент",
        "type": "script",
        "color": "#fde9a0",
        "exits": [
          "7e308ede-ba67-4338-a334-57dd389c42dd",
          "c7c69376-319e-43a7-ae89-b471a0207cf3"
        ],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "set_permissions",
          "count": 1,
          "delay": 5,
          "retry": false,
          "escalation": {
            "byError": {
              "exit": "c7c69376-319e-43a7-ae89-b471a0207cf3",
              "notify": false,
              "interrupt": true,
              "receivers": []
            }
          }
        }
      },
      "d9ca6590-7893-4009-a9e5-ef085d20b69a": {
        "x": 696,
        "y": 240,
        "id": "d9ca6590-7893-4009-a9e5-ef085d20b69a",
        "icon": "script",
        "lane": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "Логирование",
        "type": "script",
        "color": "#fde9a0",
        "exits": [
          "b29ade2a-6746-4a7b-82f1-996ef9f42b7f",
          "eebfcf59-7a23-482b-b36a-7ee6d542019f"
        ],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "log",
          "count": 1,
          "delay": 5,
          "retry": false,
          "escalation": {
            "byError": {
              "exit": "eebfcf59-7a23-482b-b36a-7ee6d542019f",
              "notify": false,
              "interrupt": true,
              "receivers": []
            }
          }
        }
      }
    },
    "lanes": {
      "597c58bc-630f-4ba7-91df-6460047c0237": {
        "x": 8,
        "y": 8,
        "id": "597c58bc-630f-4ba7-91df-6460047c0237",
        "name": "Инициатор",
        "color": "#d6f0cc",
        "width": 896,
        "height": 600,
        "settings": {
          "type": "dynamic",
          "variable": "__createdBy",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      }
    },
    "paper": {
      "format": "A4",
      "orientation": "landscape"
    },
    "transitions": {
      "2e37663a-bbd7-4736-a987-33c42eb84986": {
        "id": "2e37663a-bbd7-4736-a987-33c42eb84986",
        "name": "",
        "path": [
          {
            "x": 96,
            "y": 272
          },
          {
            "x": 136,
            "y": 272
          }
        ],
        "type": "plain",
        "source": "00000000-0000-0000-0000-000000000000",
        "target": "c2587080-97e6-4b1f-9926-132c3c15c9a8",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "48ec311a-8fe8-47e4-9414-5f428c22c067": {
        "id": "48ec311a-8fe8-47e4-9414-5f428c22c067",
        "name": "",
        "path": [
          {
            "x": 176,
            "y": 304
          },
          {
            "x": 176,
            "y": 400
          },
          {
            "x": 336,
            "y": 400
          }
        ],
        "type": "error",
        "source": "c2587080-97e6-4b1f-9926-132c3c15c9a8",
        "target": "03f39561-c965-4d77-915f-aa098483172d",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "4d81c068-c288-492b-a38a-6cf007a360b3": {
        "id": "4d81c068-c288-492b-a38a-6cf007a360b3",
        "name": "",
        "path": [
          {
            "x": 528,
            "y": 272
          },
          {
            "x": 584,
            "y": 272
          }
        ],
        "type": "plain",
        "source": "4379ba97-edb0-4fd1-b2f1-bb3880021de8",
        "target": "d9b44da1-eb37-4cd5-a0ab-c7bc588f09f2",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "5c1284aa-4a8a-4304-9ff5-b9592ce374a7": {
        "id": "5c1284aa-4a8a-4304-9ff5-b9592ce374a7",
        "name": "",
        "path": [
          {
            "x": 368,
            "y": 272
          },
          {
            "x": 448,
            "y": 272
          }
        ],
        "type": "plain",
        "source": "bf372919-2aa2-4f76-a91f-57ccfdcecf40",
        "target": "4379ba97-edb0-4fd1-b2f1-bb3880021de8",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [
            {
              "a": {
                "kind": "context",
                "value": "__service"
              },
              "b": {
                "kind": "manual",
                "value": true
              },
              "type": "BOOLEAN",
              "inversion": false,
              "operation": {
                "relation": "equal",
                "inversion": false,
                "caseInsensitive": false
              },
              "conjunction": false
            }
          ],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "761d319e-5599-4872-ba3b-a6b8534d3ed8": {
        "id": "761d319e-5599-4872-ba3b-a6b8534d3ed8",
        "name": "",
        "path": [
          {
            "x": 352,
            "y": 288
          },
          {
            "x": 352,
            "y": 384
          }
        ],
        "type": "default",
        "source": "bf372919-2aa2-4f76-a91f-57ccfdcecf40",
        "target": "03f39561-c965-4d77-915f-aa098483172d",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "7e308ede-ba67-4338-a334-57dd389c42dd": {
        "id": "7e308ede-ba67-4338-a334-57dd389c42dd",
        "name": "",
        "path": [
          {
            "x": 664,
            "y": 272
          },
          {
            "x": 696,
            "y": 272
          }
        ],
        "type": "plain",
        "source": "d9b44da1-eb37-4cd5-a0ab-c7bc588f09f2",
        "target": "d9ca6590-7893-4009-a9e5-ef085d20b69a",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "b29ade2a-6746-4a7b-82f1-996ef9f42b7f": {
        "id": "b29ade2a-6746-4a7b-82f1-996ef9f42b7f",
        "name": "",
        "path": [
          {
            "x": 776,
            "y": 272
          },
          {
            "x": 824,
            "y": 272
          }
        ],
        "type": "plain",
        "source": "d9ca6590-7893-4009-a9e5-ef085d20b69a",
        "target": "96f0ba7d-45c1-40d4-975b-3ab8baf4122d",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "c7c69376-319e-43a7-ae89-b471a0207cf3": {
        "id": "c7c69376-319e-43a7-ae89-b471a0207cf3",
        "name": "",
        "path": [
          {
            "x": 624,
            "y": 304
          },
          {
            "x": 624,
            "y": 316
          },
          {
            "x": 736,
            "y": 316
          },
          {
            "x": 736,
            "y": 304
          }
        ],
        "type": "error",
        "source": "d9b44da1-eb37-4cd5-a0ab-c7bc588f09f2",
        "target": "d9ca6590-7893-4009-a9e5-ef085d20b69a",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "ca37e2ed-ad5f-4d6c-b3c1-5b0ca67b86a7": {
        "id": "ca37e2ed-ad5f-4d6c-b3c1-5b0ca67b86a7",
        "name": "",
        "path": [
          {
            "x": 216,
            "y": 272
          },
          {
            "x": 336,
            "y": 272
          }
        ],
        "type": "plain",
        "source": "c2587080-97e6-4b1f-9926-132c3c15c9a8",
        "target": "bf372919-2aa2-4f76-a91f-57ccfdcecf40",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "e0b6ddc8-4c6e-45e7-8319-2c90f5ee6230": {
        "id": "e0b6ddc8-4c6e-45e7-8319-2c90f5ee6230",
        "name": "",
        "path": [
          {
            "x": 488,
            "y": 240
          },
          {
            "x": 488,
            "y": 212
          },
          {
            "x": 736,
            "y": 212
          },
          {
            "x": 736,
            "y": 240
          }
        ],
        "type": "error",
        "source": "4379ba97-edb0-4fd1-b2f1-bb3880021de8",
        "target": "d9ca6590-7893-4009-a9e5-ef085d20b69a",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "eebfcf59-7a23-482b-b36a-7ee6d542019f": {
        "id": "eebfcf59-7a23-482b-b36a-7ee6d542019f",
        "name": "",
        "path": [
          {
            "x": 756,
            "y": 304
          },
          {
            "x": 756,
            "y": 316
          },
          {
            "x": 840,
            "y": 316
          },
          {
            "x": 840,
            "y": 288
          }
        ],
        "type": "error",
        "source": "d9ca6590-7893-4009-a9e5-ef085d20b69a",
        "target": "96f0ba7d-45c1-40d4-975b-3ab8baf4122d",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      }
    }
  },
  "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n**/\n\nclass MyRole {\n    group: UserGroupItem | UserItem[] | OrganisationStructureItem\n    type: 'group' | 'user' | 'orgstruct'\n    code: string\n    constructor(group: UserGroupItem | UserItem[] | OrganisationStructureItem, type: 'group' | 'user' | 'orgstruct', code: string) {\n        this.code = code;\n        this.group = group;\n        this.type = type;\n    }\n    getUsers(): Promise\u003cUserItem[]\u003e {\n        if (this.type == \"group\") {\n            return (\u003cUserGroupItem\u003ethis.group).users();\n        }\n        else if (this.type == \"orgstruct\") {\n            return System.users.search().where(i =\u003e i.osIds.has((\u003cOrganisationStructureItem\u003ethis.group))).size(10000).all()\n        }\n        else return new Promise\u003cUserItem[]\u003e(() =\u003e \u003cUserItem[]\u003ethis.group)\n    }\n    json(): any {\n        return {\n            code: this.code,\n            type: this.type\n        }\n    }\n}\n\nconst app_codes = [\n    \"vacation_docs\",\n    \"vacation_orders\",\n    \"vacations\",\n    \"staff\",\n]\n\nasync function get_app_type(): Promise\u003cvoid\u003e {\n    if (!Context.data.app) {\n        throw new Error(\"Context.data.app is undefined\");\n    }\n\n    const app = await Context.data.app.fetch();\n\n    Context.data.code = app.code;\n    Context.data.namespace = app.namespace;\n}\n\nasync function check_app_code(): Promise\u003cboolean\u003e {\n    if (!Context.data.code) {\n        return false;\n    }\n\n    if (app_codes.find(f =\u003e f == Context.data.code)) {\n        return true;\n    }\n\n    return false;\n}\n\n\nasync function set_permissions(): Promise\u003cvoid\u003e {\n    if (!Context.data.access_settings_organization) {\n        Context.data.debug = \"Context.data.access_settings_organization is undefined\";\n        throw new Error(\"Context.data.access_settings_organization is undefined\")\n    }\n\n    const app = await Context.data.app!.fetch();\n    const get_access_settings_organization = await Context.data.access_settings_organization.fetch();\n\n    // Получаем группу в зависимости от кода приложения.\n    const groups = get_access_settings_organization.data[Context.data.code! as keyof typeof get_access_settings_organization.data];\n    Context.data.debug += app.id\n\n    if (!groups) {\n        Context.data.debug += `access_settings_organization group (${Context.data.code!}) is undefined`;\n        throw new Error(`access_settings_organization group (${Context.data.code!}) is undefined`);\n    }\n\n    if (!app.fields.access_group) {\n        Context.data.debug += groups[0].code;\n        throw new Error(`no field access_group in app ${app.code}`);\n    }\n    app.data.access_group = [];\n    const roleGroup = await System.userGroups.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.__id.eq(groups[0].code)\n    )).first();\n    Context.data.debug += roleGroup!.data.__id\n    const newRole = new MyRole(roleGroup!, \"group\", roleGroup!.id) as Role;\n    app.data.access_group = [newRole];\n    await app.save();\n\n    // if (app.data.hasOwnProperty('access_group')) {\n    //     app.data.access_group = groups;\n    // }\n    // await app.setPermissions(permissions);\n}\n\nasync function get_access_settings(): Promise\u003cvoid\u003e {\n    const app = await Context.data.app!.fetch();\n    let kedo_staff: ApplicationItem\u003cApplication$kedo$staff$Data, any\u003e;\n\n    // Определяем организацию.\n    switch (Context.data.code) {\n        // Сотрудники.\n        case \"staff\":\n            Context.data.organization = app.data.organization;\n            break;\n\n        // Отпуска.\n        case \"vacations\":\n            if (app.data.kedo_staff) {\n                kedo_staff = await app.data.kedo_staff.fetch();\n                Context.data.organization = kedo_staff.data.organization;\n            }\n            break;\n\n        // Заявления на отпуск.\n        case \"vacation_docs\":\n            if (app.data.kedo_staff) {\n                kedo_staff = await app.data.kedo_staff.fetch();\n                Context.data.organization = kedo_staff.data.organization;\n            }\n            break;\n\n        // Приказы на отпуск.\n        case \"vacation_orders\":\n            if (app.data.kedo_staff) {\n                kedo_staff = await app.data.kedo_staff.fetch();\n                Context.data.organization = kedo_staff.data.organization;\n            }\n            break;\n\n        default:\n            break;\n    }\n\n    if (!Context.data.organization) {\n        Context.data.debug = `Context.data.organization is undefined. App code ${Context.data.code}`;\n        throw new Error(`Context.data.organization is undefined. App code ${Context.data.code}`);\n    };\n\n    \n    const organization = await Context.data.organization.fetch();\n    if (organization.data.access_settings_organization) {\n        const accessSettings = await organization.data.access_settings_organization.fetch();\n        Context.data.access_settings_organization = accessSettings;\n        Context.data.access_settings_name = accessSettings.data.__name\n    }\n\n    // Context.data.access_settings_organization = await Context.fields.access_settings_organization.app.search()\n    //     .where((f, g) =\u003e g.and(\n    //         f.__deletedAt.eq(null),\n    //         f.organization.link(Context.data.organization!)\n    //     ))\n    //     .first();\n}\n\n\nasync function log(): Promise\u003cvoid\u003e {\n    const token = \"87fd58b9-5c8c-479b-a357-0ae42a56ae45\";\n\n    const ok = {\n        code: \"ok\",\n        name: \"ok\"\n    }\n\n    const error = {\n        code: \"error\",\n        name: \"error\"\n    }\n\n    const currentDatetime = new Datetime().format();\n    const element = await Context.data.app!.fetch();\n    const organization = Context.data.organization?.id;\n    const acess_setting = Context.data.access_settings_organization?.id;\n    const result = Context.data.debug ? error : ok;\n\n    const body = {\n        \"context\": {\n            \"app\": {\n                \"id\": element.id,\n                \"code\": element.code,\n                \"namespace\": element.namespace\n            },\n            \"error\": Context.data.debug,\n            \"result\": [\n                result\n            ],\n            \"organization\": organization ? [organization] : [],\n            \"access_setting_organization\": acess_setting ? [acess_setting] : [],\n            \"create_datetime\": currentDatetime,\n            \"group_name\": Context.data.access_settings_name\n        }\n    }\n\n    try {\n        await fetch(`https://kedo-onpremis-test1.sale.elewise.com/pub/v1/app/kedo_tests/access_settings_log/create`, {\n            method: \"POST\",\n            headers: {\n                \"Authorization\": `Bearer ${token}`\n            },\n            body: JSON.stringify(body),\n        });\n    } catch (e) {\n        Context.data.debug = JSON.stringify(e);\n    }\n}\n",
  "forms": [],
  "settings": {
    "logged": true,
    "targetFeed": {
      "type": "instance",
      "variable": ""
    },
    "allowGlobal": false,
    "instanceCard": {
      "allFields": true,
      "formFields": []
    },
    "notifyOnStart": true,
    "allowNamespace": false,
    "applicationContext": false,
    "fieldVisibilityConditions": {
      "app": {
        "enabled": false,
        "conditions": []
      },
      "code": {
        "enabled": false,
        "conditions": []
      },
      "debug": {
        "enabled": false,
        "conditions": []
      },
      "namespace": {
        "enabled": false,
        "conditions": []
      },
      "organization": {
        "enabled": false,
        "conditions": []
      },
      "access_settings_name": {
        "enabled": false,
        "conditions": []
      },
      "access_settings_organization": {
        "enabled": false,
        "conditions": []
      }
    }
  },
  "hideInList": false,
  "applicationLink": false,
  "__deletedAt": null
}
