{
  "__id": "018c8757-193d-7f4d-84fd-5ca8f44296ac",
  "namespace": "kedo_ext",
  "code": "familiarization_termination_dismissal",
  "category": "00000000-0000-0000-0000-000000000000",
  "__name": "Ознакомление с прекращением увольнение",
  "type": "bpmn",
  "draft": false,
  "version": 3,
  "context": [
    {
      "code": "staff",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "staff",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Сотрудник",
        "data": {}
      }
    },
    {
      "code": "chief_app",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "staff",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Руководитель(app)",
        "data": {}
      }
    },
    {
      "code": "alert_body",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Тело оповещения",
        "data": {
          "additionalType": "text"
        }
      }
    },
    {
      "code": "letter_of_resignation",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "letter_of_resignation",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Заявление на увольнение",
        "data": {}
      }
    },
    {
      "code": "recall_dismissal",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "recall_dismissal",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Отзыв заявление на увольнение",
        "data": {}
      }
    },
    {
      "code": "debug",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "debug",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "chief",
      "type": "SYS_USER",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        }
      },
      "view": {
        "name": "Руководитель сотрудника",
        "data": {}
      }
    }
  ],
  "manualRun": true,
  "readonly": false,
  "__createdAt": "2023-07-11T11:34:08.943414018Z",
  "__createdBy": "8bd76988-cc8c-4f8e-9c59-3065f1aa77e5",
  "__updatedAt": "2023-07-13T10:52:16.249732664Z",
  "__updatedBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "process": {
    "items": {
      "00000000-0000-0000-0000-000000000000": {
        "x": 104,
        "y": 72,
        "id": "00000000-0000-0000-0000-000000000000",
        "lane": "7eda320d-e94b-437b-aed1-d2f3a2b02a50",
        "type": "start",
        "color": "#ffffff",
        "exits": ["a0175c5d-616d-43c6-bf27-34669ab0a4c5"],
        "width": 32,
        "height": 32,
        "settings": {
          "formFields": [
            {
              "code": "__name",
              "display": "Название",
              "tooltip": "Название экземпляра процесса, будет показываться в задачах",
              "readonly": false,
              "required": true
            }
          ],
          "instruction": "",
          "notifyMessage": "Запущен процесс",
          "titleTemplate": "Ознакомление с прекращением увольнение - {$__createdAt}",
          "titleGenerateMethod": "template"
        }
      },
      "03d33994-9958-47b7-839e-c89601c6c3f3": {
        "x": 624,
        "y": 304,
        "id": "03d33994-9958-47b7-839e-c89601c6c3f3",
        "icon": "script",
        "lane": "b8a61470-d606-43e7-a45a-59986455744d",
        "name": "Заполнение поля контракта(строка статуса)",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["c5dd8ad2-6bab-46f6-b8de-460690c80a7c"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "set_contract_field",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      },
      "2b22158a-5ad3-499b-b200-21ca61a1933e": {
        "x": 864,
        "y": 320,
        "id": "2b22158a-5ad3-499b-b200-21ca61a1933e",
        "icon": "end",
        "lane": "b8a61470-d606-43e7-a45a-59986455744d",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "2e160439-b63f-4baa-bad2-b075d60e0ded": {
        "x": 304,
        "y": 304,
        "id": "2e160439-b63f-4baa-bad2-b075d60e0ded",
        "icon": "send_doc",
        "lane": "b8a61470-d606-43e7-a45a-59986455744d",
        "name": "Ознакомление",
        "type": "inform_list_process",
        "color": "#f0f4c3",
        "exits": ["002c652f-04ed-4d78-864f-95652b63cc02"],
        "width": 80,
        "height": 64,
        "settings": {
          "taskName": "{$recall_dismissal}: Ознакомление",
          "receivers": [],
          "escalation": {
            "byTime": {
              "limit": {
                "days": 0,
                "kind": "duration",
                "hours": 0,
                "minutes": 0,
                "absolute": false
              },
              "action": {
                "notify": false,
                "interrupt": false,
                "receivers": []
              },
              "enabled": false
            }
          },
          "settingSign": {
            "isSign": "disabled"
          },
          "messageHeader": "{$empty}: Ознакомление",
          "withoutNotify": false,
          "targetFieldCode": "recall_dismissal",
          "customStatusSettings": {
            "customStatuses": [
              {
                "status": "done",
                "enabled": false,
                "buttonText": "",
                "statusText": ""
              }
            ]
          }
        }
      },
      "53cd99c4-7acf-4b12-ab53-94110c94f435": {
        "x": 80,
        "y": 304,
        "id": "53cd99c4-7acf-4b12-ab53-94110c94f435",
        "icon": "script",
        "lane": "7eda320d-e94b-437b-aed1-d2f3a2b02a50",
        "name": "Получение данных",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["947d9a9d-bf1a-4d09-b7ca-47bd1aafc7be"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "get_data",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      },
      "860b1ee8-21a3-46e1-a604-03833afc4245": {
        "x": 480,
        "y": 304,
        "id": "860b1ee8-21a3-46e1-a604-03833afc4245",
        "icon": "change",
        "lane": "b8a61470-d606-43e7-a45a-59986455744d",
        "name": "Заявление на увольнение -\u003e Отзыв заявления",
        "type": "status",
        "color": "#fde9a0",
        "exits": ["c56b61d0-619e-4724-9371-3397adb53b3d"],
        "width": 80,
        "height": 64,
        "settings": {
          "status": 7,
          "variable": "letter_of_resignation",
          "keepInCurrentGroup": false
        }
      },
      "cade16da-d463-43a5-92e0-a139e36af04e": {
        "x": 80,
        "y": 192,
        "id": "cade16da-d463-43a5-92e0-a139e36af04e",
        "lane": "7eda320d-e94b-437b-aed1-d2f3a2b02a50",
        "name": "Определение руководителя",
        "type": "call",
        "color": "#ffffff",
        "exits": ["b768c20d-ea9f-4602-9160-ae6f9ea5e617"],
        "width": 80,
        "height": 64,
        "settings": {
          "code": "periodic_medical_examination",
          "async": false,
          "input": [
            {
              "source": {
                "kind": "context",
                "value": "staff"
              },
              "target": {
                "kind": "context",
                "value": "staff"
              }
            }
          ],
          "output": [
            {
              "source": {
                "kind": "context",
                "value": "chief_app"
              },
              "target": {
                "kind": "context",
                "value": "chief_app"
              }
            }
          ],
          "linkCode": "staff",
          "namespace": "kedo.staff",
          "subProcessTargetFieldCode": ""
        }
      },
      "cb1ad4cb-0680-44fa-9a4a-b18a563f955d": {
        "x": 760,
        "y": 304,
        "id": "cb1ad4cb-0680-44fa-9a4a-b18a563f955d",
        "icon": "script",
        "lane": "b8a61470-d606-43e7-a45a-59986455744d",
        "name": "Прерывание процесса увольнение",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["f13fe6c8-773d-49b6-9a0e-ccfa50c69f2f"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "interrupt_process",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      }
    },
    "lanes": {
      "7eda320d-e94b-437b-aed1-d2f3a2b02a50": {
        "x": 8,
        "y": 8,
        "id": "7eda320d-e94b-437b-aed1-d2f3a2b02a50",
        "name": "Инициатор",
        "color": "#d6f0cc",
        "width": 264,
        "height": 836,
        "settings": {
          "type": "dynamic",
          "variable": "__createdBy",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      },
      "b8a61470-d606-43e7-a45a-59986455744d": {
        "x": 272,
        "y": 8,
        "id": "b8a61470-d606-43e7-a45a-59986455744d",
        "name": "Руководитель сотрудника",
        "color": "#d6f0cc",
        "width": 808,
        "height": 836,
        "settings": {
          "type": "dynamic",
          "groups": [null],
          "variable": "chief",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      }
    },
    "paper": {
      "format": "A4",
      "orientation": "landscape"
    },
    "transitions": {
      "002c652f-04ed-4d78-864f-95652b63cc02": {
        "id": "002c652f-04ed-4d78-864f-95652b63cc02",
        "name": "",
        "path": [
          {
            "x": 384,
            "y": 336
          },
          {
            "x": 480,
            "y": 336
          }
        ],
        "type": "plain",
        "source": "2e160439-b63f-4baa-bad2-b075d60e0ded",
        "target": "860b1ee8-21a3-46e1-a604-03833afc4245",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "947d9a9d-bf1a-4d09-b7ca-47bd1aafc7be": {
        "id": "947d9a9d-bf1a-4d09-b7ca-47bd1aafc7be",
        "name": "",
        "path": [
          {
            "x": 160,
            "y": 336
          },
          {
            "x": 304,
            "y": 336
          }
        ],
        "type": "plain",
        "source": "53cd99c4-7acf-4b12-ab53-94110c94f435",
        "target": "2e160439-b63f-4baa-bad2-b075d60e0ded",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "a0175c5d-616d-43c6-bf27-34669ab0a4c5": {
        "id": "a0175c5d-616d-43c6-bf27-34669ab0a4c5",
        "name": "",
        "path": [
          {
            "x": 120,
            "y": 104
          },
          {
            "x": 120,
            "y": 192
          }
        ],
        "type": "plain",
        "source": "00000000-0000-0000-0000-000000000000",
        "target": "cade16da-d463-43a5-92e0-a139e36af04e",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "b768c20d-ea9f-4602-9160-ae6f9ea5e617": {
        "id": "b768c20d-ea9f-4602-9160-ae6f9ea5e617",
        "name": "",
        "path": [
          {
            "x": 120,
            "y": 256
          },
          {
            "x": 120,
            "y": 304
          }
        ],
        "type": "plain",
        "source": "cade16da-d463-43a5-92e0-a139e36af04e",
        "target": "53cd99c4-7acf-4b12-ab53-94110c94f435",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "c56b61d0-619e-4724-9371-3397adb53b3d": {
        "id": "c56b61d0-619e-4724-9371-3397adb53b3d",
        "name": "",
        "path": [
          {
            "x": 560,
            "y": 336
          },
          {
            "x": 624,
            "y": 336
          }
        ],
        "type": "plain",
        "source": "860b1ee8-21a3-46e1-a604-03833afc4245",
        "target": "03d33994-9958-47b7-839e-c89601c6c3f3",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "c5dd8ad2-6bab-46f6-b8de-460690c80a7c": {
        "id": "c5dd8ad2-6bab-46f6-b8de-460690c80a7c",
        "name": "",
        "path": [
          {
            "x": 704,
            "y": 336
          },
          {
            "x": 760,
            "y": 336
          }
        ],
        "type": "plain",
        "source": "03d33994-9958-47b7-839e-c89601c6c3f3",
        "target": "cb1ad4cb-0680-44fa-9a4a-b18a563f955d",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "f13fe6c8-773d-49b6-9a0e-ccfa50c69f2f": {
        "id": "f13fe6c8-773d-49b6-9a0e-ccfa50c69f2f",
        "name": "",
        "path": [
          {
            "x": 840,
            "y": 336
          },
          {
            "x": 864,
            "y": 336
          }
        ],
        "type": "plain",
        "source": "cb1ad4cb-0680-44fa-9a4a-b18a563f955d",
        "target": "2b22158a-5ad3-499b-b200-21ca61a1933e",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      }
    }
  },
  "scripts": "/**\nHere you can write scripts for complex server processing of the context during process execution.\nTo write scripts, use TypeScript (https://www.typescriptlang.org).\nELMA365 SDK documentation available on https://tssdk.elma365.com.\n**/\n\nasync function get_data(): Promise\u003cvoid\u003e {\n    if(Context.data.chief_app){\n        Context.data.chief = (await Context.data.chief_app.fetch()).data.ext_user;\n    }\n    Context.data.alert_body = `Сотрудник ${(await Context.data.staff!.fetch()).data.__name} отозвал заявление на увольнение`;\n    if(Context.data.letter_of_resignation){\n        let app = await Context.data.letter_of_resignation.fetch();\n        if(app.data.linked_order){\n            let order = await app.data.linked_order.fetch();\n            order.setStatus(order.fields.__status.variants.recall)\n        }\n    }\n}\nasync function set_contract_field(): Promise\u003cvoid\u003e {\n    let statement = await Context.data.letter_of_resignation!.fetch();\n    statement.data.line_status = statement.data.__status!.code + ';' + statement.data.__status!.name;\n    await statement.save();\n}\n\n\nasync function interrupt_process(): Promise\u003cvoid\u003e {\n    if (Context.data.letter_of_resignation) {\n        let app = await Context.data.letter_of_resignation.fetch();\n        let id = app!.data.id_process!;\n        let process = await Context.fields.staff.app.processes.the_dismissal_process._searchInstances().where((proc, g) =\u003e g.and(proc.__id.eq(id))).first();\n        if (process) {\n            try {\n               await process.interrupt(\"Отзыв заявление\");\n            }\n            catch (e) {\n                Context.data.debug = e.message\n            }\n        }\n    }\n}\n",
  "forms": [],
  "settings": {
    "logged": true,
    "targetFeed": {
      "type": "instance",
      "variable": ""
    },
    "allowGlobal": false,
    "instanceCard": {
      "allFields": true,
      "formFields": []
    },
    "notifyOnStart": true,
    "allowNamespace": false,
    "applicationContext": false,
    "fieldVisibilityConditions": {
      "chief": {
        "enabled": false,
        "conditions": []
      },
      "debug": {
        "enabled": false,
        "conditions": []
      },
      "staff": {
        "enabled": false,
        "conditions": []
      },
      "chief_app": {
        "enabled": false,
        "conditions": []
      },
      "alert_body": {
        "enabled": false,
        "conditions": []
      },
      "recall_dismissal": {
        "enabled": false,
        "conditions": []
      },
      "letter_of_resignation": {
        "enabled": false,
        "conditions": []
      }
    }
  },
  "hideInList": false,
  "applicationLink": false,
  "__deletedAt": null
}
