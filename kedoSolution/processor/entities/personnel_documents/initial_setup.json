{
  "__id": "018c8757-193c-7f08-a388-8e84ee30b1df",
  "namespace": "personnel_documents",
  "code": "initial_setup",
  "category": "00000000-0000-0000-0000-000000000000",
  "__name": "Типовой процесс поиска заявлений",
  "type": "bpmn",
  "draft": false,
  "version": 7,
  "context": [
    {
      "code": "employment_placement",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "employment_directory",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Заявка по месту занятости",
        "data": {},
        "input": true,
        "output": true
      }
    },
    {
      "code": "business_trip_application",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "memo_business_trip",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "personnel_documents",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Заявление на командировку",
        "data": {}
      }
    },
    {
      "code": "debug",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "debug",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "mat_help",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "application_for_financial_assistance",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "personnel_documents",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Заявление на материальную помощь",
        "data": {}
      }
    },
    {
      "code": "kad_docs",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "personnel_documents",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "personnel_documents",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Кадровые документы",
        "data": {}
      }
    },
    {
      "code": "paid_leave_application",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "paid_leave",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "personnel_documents",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Заявление на оплачиваемый отпуск",
        "data": {}
      }
    },
    {
      "code": "withoutpay_leave_application",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "application_for_leave_without_pay",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "personnel_documents",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Заявление на отпуск без сохранения з/п",
        "data": {}
      }
    }
  ],
  "manualRun": false,
  "readonly": false,
  "__createdAt": "2023-03-14T12:49:28.456053286Z",
  "__createdBy": "8b6393ab-540b-4559-8c18-7ef92a9cc24a",
  "__updatedAt": "2024-03-14T19:54:51.804914881Z",
  "__updatedBy": "b9287795-55a7-42be-989a-2677b5bb0a2c",
  "process": {
    "items": {
      "00000000-0000-0000-0000-000000000000": {
        "x": 176,
        "y": 64,
        "id": "00000000-0000-0000-0000-000000000000",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "type": "start",
        "color": "#ffffff",
        "exits": ["cfe7b569-3e3f-4503-a7c5-19a7f4bcd235"],
        "width": 32,
        "height": 32,
        "settings": {
          "formCode": "",
          "formFields": [],
          "instruction": "",
          "notifyMessage": "Запущен процесс",
          "titleTemplate": "Типовой процесс поиска заявлений",
          "titleGenerateMethod": "template"
        }
      },
      "391c522c-23e6-4158-851f-7ff9fd12b473": {
        "x": 152,
        "y": 368,
        "id": "391c522c-23e6-4158-851f-7ff9fd12b473",
        "icon": "script",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "Запуск типового бизнес-процесса (заявления)",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["b27d2eb0-36f4-4e9f-ab6b-df7c25f40043"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "runProcess",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      },
      "4754b62b-fa05-432f-9233-02e8f7e2218e": {
        "x": 152,
        "y": 160,
        "id": "4754b62b-fa05-432f-9233-02e8f7e2218e",
        "icon": "script",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "Поиск заявления",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["2edc6fba-0248-4410-b7d3-5671081ffca5"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "get_doc",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      },
      "6e3f969c-8a41-47c4-9492-8de4f63ed462": {
        "x": 384,
        "y": 264,
        "id": "6e3f969c-8a41-47c4-9492-8de4f63ed462",
        "icon": "end",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "b73e6fba-49bc-4df2-9ae3-fd7e5225947d": {
        "x": 176,
        "y": 488,
        "id": "b73e6fba-49bc-4df2-9ae3-fd7e5225947d",
        "icon": "end",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "d907afa0-27a9-4ba7-aa84-61163e5d3c86": {
        "x": 256,
        "y": 248,
        "id": "d907afa0-27a9-4ba7-aa84-61163e5d3c86",
        "icon": "notification",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "Не удалось найти заявление",
        "type": "notification",
        "color": "#ffff66",
        "exits": ["50c90b4c-e72e-4a41-9a69-908fe8cf0f82"],
        "width": 80,
        "height": 64,
        "settings": {
          "author": {
            "code": "",
            "kind": "system"
          },
          "target": {
            "kind": "process"
          },
          "receivers": [
            {
              "kind": "current"
            },
            {
              "code": "administrators",
              "kind": "group",
              "multi": true,
              "namespace": "system"
            }
          ],
          "messageHeader": "Не удалось найти заявление"
        }
      },
      "e36847ae-4547-4f84-b778-d10ba8ee4aa8": {
        "x": 176,
        "y": 264,
        "id": "e36847ae-4547-4f84-b778-d10ba8ee4aa8",
        "icon": "exclusive",
        "lane": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "",
        "type": "gateway",
        "color": "#ffffff",
        "exits": [
          "b0b1adf2-6b64-48b6-bbea-a65e34b74b07",
          "4d405f42-f9b1-48c5-86e4-0ef8c0f43e6b"
        ],
        "width": 32,
        "height": 32,
        "settings": {
          "func": "",
          "type": "exclusive",
          "useFunc": false,
          "funcType": "STRING",
          "description": ""
        }
      }
    },
    "lanes": {
      "8eeaed7f-82df-4299-b4ac-76e6055a5841": {
        "x": 8,
        "y": 8,
        "id": "8eeaed7f-82df-4299-b4ac-76e6055a5841",
        "name": "Инициатор",
        "color": "#d6f0cc",
        "width": 584,
        "height": 600,
        "settings": {
          "type": "dynamic",
          "variable": "__createdBy",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      }
    },
    "paper": {
      "format": "A4",
      "orientation": "landscape"
    },
    "transitions": {
      "2edc6fba-0248-4410-b7d3-5671081ffca5": {
        "id": "2edc6fba-0248-4410-b7d3-5671081ffca5",
        "name": "",
        "path": [
          {
            "x": 192,
            "y": 224
          },
          {
            "x": 192,
            "y": 264
          }
        ],
        "type": "plain",
        "source": "4754b62b-fa05-432f-9233-02e8f7e2218e",
        "target": "e36847ae-4547-4f84-b778-d10ba8ee4aa8",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "4d405f42-f9b1-48c5-86e4-0ef8c0f43e6b": {
        "id": "4d405f42-f9b1-48c5-86e4-0ef8c0f43e6b",
        "name": "",
        "path": [
          {
            "x": 208,
            "y": 280
          },
          {
            "x": 256,
            "y": 280
          }
        ],
        "type": "default",
        "source": "e36847ae-4547-4f84-b778-d10ba8ee4aa8",
        "target": "d907afa0-27a9-4ba7-aa84-61163e5d3c86",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "50c90b4c-e72e-4a41-9a69-908fe8cf0f82": {
        "id": "50c90b4c-e72e-4a41-9a69-908fe8cf0f82",
        "name": "",
        "path": [
          {
            "x": 336,
            "y": 280
          },
          {
            "x": 384,
            "y": 280
          }
        ],
        "type": "plain",
        "source": "d907afa0-27a9-4ba7-aa84-61163e5d3c86",
        "target": "6e3f969c-8a41-47c4-9492-8de4f63ed462",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "b0b1adf2-6b64-48b6-bbea-a65e34b74b07": {
        "id": "b0b1adf2-6b64-48b6-bbea-a65e34b74b07",
        "name": "",
        "path": [
          {
            "x": 192,
            "y": 296
          },
          {
            "x": 192,
            "y": 368
          }
        ],
        "type": "plain",
        "source": "e36847ae-4547-4f84-b778-d10ba8ee4aa8",
        "target": "391c522c-23e6-4158-851f-7ff9fd12b473",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [
            {
              "a": {
                "kind": "context",
                "value": "kad_docs"
              },
              "type": "SYS_COLLECTION",
              "inversion": false,
              "operation": {
                "relation": "empty",
                "inversion": true,
                "caseInsensitive": false
              },
              "conjunction": false
            }
          ],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "b27d2eb0-36f4-4e9f-ab6b-df7c25f40043": {
        "id": "b27d2eb0-36f4-4e9f-ab6b-df7c25f40043",
        "name": "",
        "path": [
          {
            "x": 192,
            "y": 432
          },
          {
            "x": 192,
            "y": 488
          }
        ],
        "type": "plain",
        "source": "391c522c-23e6-4158-851f-7ff9fd12b473",
        "target": "b73e6fba-49bc-4df2-9ae3-fd7e5225947d",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "cfe7b569-3e3f-4503-a7c5-19a7f4bcd235": {
        "id": "cfe7b569-3e3f-4503-a7c5-19a7f4bcd235",
        "name": "",
        "path": [
          {
            "x": 192,
            "y": 96
          },
          {
            "x": 192,
            "y": 160
          }
        ],
        "type": "plain",
        "source": "00000000-0000-0000-0000-000000000000",
        "target": "4754b62b-fa05-432f-9233-02e8f7e2218e",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      }
    }
  },
  "scripts": "type WithoutPayLeave = ApplicationItem\u003cApplication$personnel_documents$application_for_leave_without_pay$Data, Application$personnel_documents$application_for_leave_without_pay$Params\u003e;\ntype BusinessTrip = ApplicationItem\u003cApplication$personnel_documents$memo_business_trip$Data, Application$personnel_documents$memo_business_trip$Params\u003e;\ntype PaidLeave = ApplicationItem\u003cApplication$personnel_documents$paid_leave$Data, Application$personnel_documents$paid_leave$Params\u003e;\ntype MatHelp = ApplicationItem\u003cApplication$personnel_documents$application_for_financial_assistance$Data, Application$personnel_documents$application_for_financial_assistance$Params\u003e;\n\nasync function get_doc(): Promise\u003cvoid\u003e {\n    let ref: RefItem | undefined = undefined;\n\n    if (Context.data.business_trip_application) {\n        const business_trip = Context.data.business_trip_application;\n        ref = new RefItem\u003cBusinessTrip\u003e(business_trip.namespace, business_trip.code, business_trip.id);\n    }\n\n    if (Context.data.withoutpay_leave_application) {\n        const withoutpay_leave_application = Context.data.withoutpay_leave_application;\n        ref = new RefItem\u003cWithoutPayLeave\u003e(withoutpay_leave_application.namespace, withoutpay_leave_application.code, withoutpay_leave_application.id);\n    }\n\n    if (Context.data.paid_leave_application) {\n        const paid_leave_application = Context.data.paid_leave_application;\n        ref = new RefItem\u003cPaidLeave\u003e(paid_leave_application.namespace, paid_leave_application.code, paid_leave_application.id);\n    }\n\n    if (Context.data.mat_help) {\n        const mat_help = Context.data.mat_help;\n        ref = new RefItem\u003cMatHelp\u003e(mat_help.namespace, mat_help.code, mat_help.id);\n    }\n\n    if (ref) {\n        Context.data.kad_docs = await Context.fields.kad_docs.app.search().where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.__sourceRef.eq(ref!)\n        )).first();\n    }\n}\n\nasync function runProcess(): Promise\u003cvoid\u003e {\n    const process_template = Namespace.processes.typical_business_process;\n\n    if (!Context.data.kad_docs) {\n        throw new Error(\"Context.data.kad_docs is undefined\");\n    }\n\n    const kad_docs = await Context.data.kad_docs.fetch();\n\n    if (!kad_docs.data.__sourceRef) {\n        throw new Error(\"__sourceRef of kad_docs is undefined\");\n    }\n\n    const source = kad_docs.data.__sourceRef;\n\n    const context: any = {\n        personnel_documents: [Context.data.kad_docs.id],\n        leave_application_withoutpay: Context.data.withoutpay_leave_application ? [Context.data.withoutpay_leave_application.id] : null,\n        leavle_application: Context.data.paid_leave_application ? [Context.data.paid_leave_application.id] : null,\n        financial_assistance_application: Context.data.mat_help ? [Context.data.mat_help.id] : null,\n        business_trip: Context.data.business_trip_application ? [Context.data.business_trip_application.id] : null,\n        employment_placement: Context.data.employment_placement ? [Context.data.employment_placement.id] : null,\n        __item: {\n            id: source.id,\n            code: source.code,\n            namespace: source.namespace,\n        }\n    }\n\n    await process_template.run(context);\n}\n",
  "forms": [
    {
      "id": "",
      "code": "form_c51127ea-7b8a-44bd-ac66-08030c8f2094",
      "name": "Форма запуска",
      "values": {
        "formType": "start-process-form",
        "formGroup": {
          "path": ["context"]
        }
      },
      "widget": {
        "draft": false,
        "deleted": false,
        "version": 3
      },
      "content": {
        "[footer]": [
          {
            "id": "cc734fcd-17d6-4b8c-8529-91a25cc2a94e",
            "values": {
              "buttons": {
                "path": ["actionButtons"]
              }
            },
            "content": null,
            "descriptor": "buttons-panel",
            "descriptorVersion": null
          }
        ],
        "[content]": [
          {
            "id": "c18e9118-cda2-49f4-ae50-5414c9b970b2",
            "values": {
              "shadow": true
            },
            "content": {
              "": [
                {
                  "id": "11c9f46a-b3c4-4e77-8ee8-dd2b38dd892e",
                  "values": {
                    "form": {
                      "path": ["context"]
                    },
                    "fields": {
                      "path": ["fields"]
                    }
                  },
                  "content": null,
                  "descriptor": "dynamic-form",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "modal-body",
            "descriptorVersion": null
          }
        ],
        "[sidebar]": [
          {
            "id": "0ceaa8ec-5cdc-4385-9a6b-b0ae1e04039b",
            "values": null,
            "content": {
              "": [
                {
                  "id": "2c1bfe32-44b9-46d5-bee7-2ed66205f4d6",
                  "values": {
                    "userGuide": {
                      "path": ["instruction"]
                    }
                  },
                  "content": null,
                  "descriptor": "user-guide",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          },
          {
            "id": "2112f287-a8ad-433c-862d-f9808c2d4f7b",
            "values": null,
            "content": {
              "": [
                {
                  "id": "8900384e-a047-46b0-8ba7-462c23711e72",
                  "values": {
                    "context": {
                      "path": ["context"]
                    }
                  },
                  "content": null,
                  "descriptor": "target-widget",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          }
        ],
        "[headerControls]": [],
        "[headerCustomization]": []
      },
      "descriptor": "item-form-complex-popup",
      "descriptorVersion": 2
    }
  ],
  "settings": {
    "logged": true,
    "debugForm": {
      "allFields": false,
      "formFields": []
    },
    "targetFeed": {
      "type": "instance",
      "variable": ""
    },
    "allowGlobal": false,
    "instanceCard": {
      "allFields": true,
      "formFields": []
    },
    "notifyOnStart": false,
    "allowNamespace": false,
    "applicationContext": false,
    "importsDependencies": [],
    "fieldVisibilityConditions": {
      "debug": {
        "enabled": false,
        "conditions": []
      },
      "kad_docs": {
        "enabled": false,
        "conditions": []
      },
      "mat_help": {
        "enabled": false,
        "conditions": []
      },
      "types_of_material": {
        "enabled": false,
        "conditions": []
      },
      "employment_placement": {
        "enabled": false,
        "conditions": []
      },
      "paid_leave_application": {
        "enabled": false,
        "conditions": []
      },
      "business_trip_application": {
        "enabled": false,
        "conditions": []
      },
      "withoutpay_leave_application": {
        "enabled": false,
        "conditions": []
      }
    }
  },
  "hideInList": false,
  "applicationLink": false,
  "__deletedAt": null
}
