{
  "__id": "32dba56b-ed23-4b7f-80b8-b9dfd89eef13",
  "__name": "(1С) Перевод сотрудника",
  "code": "employee_move",
  "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "type": [
    {
      "code": "script",
      "name": "Скрипт"
    }
  ],
  "group": "7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "icon": "system",
  "color": "#20c997",
  "itemName": "",
  "bindForm": true,
  "description": "",
  "retryCount": 0,
  "retryDelay": 10,
  "context": [
    {
      "code": "error",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ошибка",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    },
    {
      "code": "response",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ответ",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    },
    {
      "code": "org_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID организации",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "is_subdiv",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID подразделения",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "id_pos",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID должности",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "id_employee",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID сотрудника",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "id_personal",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID ФЛ сотрудника",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "move_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) Дата перевода",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "end_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) Дата окончания",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "id_work_schedule",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID графика работы",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "connection_name",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Имя подключения 1С",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "alternative_way",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": false,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Альтернативная интеграция",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "integration_app_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "ID приложения интеграции",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    },
    {
      "code": "move_reason",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Причина перевода",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "move_osn",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Основание перевода",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "change_contract",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": false,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Изменить сведения о договоре",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "remote_work",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Работает дистанционно",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "change_remote_work",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": false,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Изменить дистанционную работу",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "comment",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Комментарий",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "change_work_place",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": false,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Изменить рабочее место",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "new_workplace_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1C) ID нового рабочего места",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "additional_info",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дополнительная информация",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    }
  ],
  "draft": false,
  "published": true,
  "data": {
    "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n\nСигнатуры функций\n\nДля синхронного взаимодействия:\n\tasync function action(): Promise\u003cvoid\u003e;\n\nДля модели проверки результата:\n\tasync function action(): Promise\u003cvoid\u003e;\n\tasync function check(): Promise\u003cboolean\u003e;\n\nДля модели обратного вызова:\n\tasync function action(url: string): Promise\u003cvoid\u003e;\n\tasync function callback(req: HTTPRequest): Promise\u003cvoid\u003e;\n\n**/\n\n\nlet baseUrl: string;\nlet login: string\nlet password: string\nlet myHeaders: any\n\nasync function log(text: string): Promise\u003cvoid\u003e {\n\tconst response = fetch(`https://sivbciaps6tzy.elma365.ru/pub/v1/app/testovyi/logirovanie_dlya_modulya/create`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\tAuthorization: 'Bearer 4417c175-29f2-4366-b0cf-246ef39f8423',\n\t\t},\n\t\tbody: JSON.stringify({\n\t\t\t\"context\": {\n\t\t\t\t\"__name\": \"log\",\n\t\t\t\t\"debug\": `${text}`,\n\t\t\t},\n\t\t})\n\t});\n}\n\nfunction getConnectionInfo(): Error | null {\n\tconst connectionsArray = Namespace.params.data.list_of_connected_platforms ? JSON.parse(Namespace.params.data.list_of_connected_platforms) : undefined;\n\tif (!connectionsArray) {\n\t\treturn new Error(`Не найдено записей подключения`)\n\t}\n\n\n\tconst currentConnection = connectionsArray.length \u003e 1 ? connectionsArray.find((item: any) =\u003e {\n\t\treturn item.name === Context.data.connection_name\n\t}) : connectionsArray[0]\n\tif (!currentConnection) {\n\t\treturn new Error(`Не найдено подключение c именем ${Context.data.connection_name}`)\n\t}\n\n\tbaseUrl = currentConnection.url;\n\tlogin = currentConnection.login\n\tpassword = currentConnection.password\n\tmyHeaders = {\n\t\tAuthorization: `Basic ${btoa(login + ':' + password)}`,\n\t};\n\treturn null\n}\n\nasync function action(): Promise\u003cvoid\u003e {\n\tconst currentDate = new TDate();\n\n\tconst body: any = {\n\t\t\"Date\": `${currentDate.format('YYYY-MM-DD')}T00:00:00`,\n\t\t\"Организация_Key\": Context.data.org_id,\n\t\t\"Сотрудник_Key\": Context.data.id_employee,\n\t\t\"ФизическоеЛицо_Key\": Context.data.id_personal,\n\t\t\"ДатаНачала\": `${Context.data.move_date}T00:00:00`,\n\t\t\"ВидЗанятости\": \"ОсновноеМестоРаботы\",\n\t\t\"КоличествоСтавок\": 1,\n\t\t\"ВидДоговора\": \"ТрудовойДоговор\",\n\t\t\"КоэффициентИндексации\": 1,\n\t\t\"ДатаЗапрета\": `${Context.data.move_date}T00:00:00`,\n\t\t\"НаименованиеДокумента\": \"Приказ\",\n\t\t\"ПричинаПеревода\": Context.data.move_reason ?? \"\",\n\t\t\"ОснованиеПеревода\": Context.data.move_osn ?? \"\",\n\t\t\"ИзменитьСведенияОДоговореКонтракте\": !!Context.data.change_contract,\n\t\t\"Комментарий\": Context.data.comment ?? \"\"\n\t}\n\n\tif (!!Context.data.change_work_place) {\n\t\tbody[\"ИзменитьРабочееМесто\"] = true\n\t\tbody[\"РабочееМесто_Key\"] = Context.data.new_workplace_id\n\t}\n\n\tif (!!Context.data.change_remote_work) {\n\t\tbody[\"РаботаетДистанционно\"] = Context.data.remote_work\n\t\tbody[\"ИзменитьДистанционнуюРаботу\"] = true\n\t}\n\n\tif (Context.data.id_pos \u0026\u0026 Context.data.is_subdiv) {\n\t\tbody[\"Должность_Key\"] = Context.data.id_pos;\n\t\tbody[\"Подразделение_Key\"] = Context.data.is_subdiv;\n\t\tbody[\"ИзменитьПодразделениеИДолжность\"] = true;\n\t}\n\n\tif (Context.data.id_work_schedule) {\n\t\tbody[\"ГрафикРаботы_Key\"] = Context.data.id_work_schedule;\n\t\tbody[\"ИзменитьГрафикРаботы\"] = true\n\t}\n\n\tif (Context.data.end_date) {\n\t\tbody[\"ДатаОкончания\"] = Context.data.end_date\n\t}\n\n\tlog(Context.data.alternative_way ? Context.data.alternative_way == true ? 'true' : 'false' : 'undefined');\n\n\tif (!Context.data.alternative_way) {\n\t\tconst error = getConnectionInfo()\n\t\tif (error != null) {\n\t\t\tContext.data.error = error.message\n\t\t\treturn\n\t\t}\n\t\tconst requestOptions: FetchRequest = {\n\t\t\tmethod: 'POST',\n\t\t\theaders: myHeaders,\n\t\t};\n\n\t\trequestOptions.body = JSON.stringify(body);\n\n\n\t\tContext.data.debug = 'fetch'\n\t\tconst resUrl = `${baseUrl}/Document_КадровыйПеревод?$format=json`;\n\n\t\ttry {\n\t\t\tconst response = await fetch(`${encodeURI(resUrl)}`, requestOptions)\n\t\t\tif (!response.ok) {\n\t\t\t\tconst responseText = await response.text()\n\t\t\t\tContext.data.error += ` staff data res.status error; resUrl - ${resUrl} `\n\t\t\t\tthrow new Error(`status ${response.status} res error ${resUrl}, err text ${responseText}`);\n\t\t\t}\n\n\t\t\tContext.data.response = JSON.stringify(await response.json());\n\t\t} catch (err) {\n\t\t\tContext.data.error += ` try/catch error ${err}; resUrl - ${resUrl} `\n\t\t\tthrow new Error(err.message)\n\t\t}\n\t} else {\n\t\tconst accounting1c = Namespace.params.fields.awaiting_docs_table_1c.app.fields.accounting_systems.variants.zup_1c\n\t\tconst awaitingApp = Namespace.params.fields.awaiting_docs_table_1c.app.create()\n\t\tawaitingApp.data.__name = \"Кадровый перевод\"\n\t\tawaitingApp.data.document_odata_name = \"Document_КадровыйПеревод\"\n\t\tawaitingApp.data.accounting_systems = accounting1c\n\t\tawaitingApp.data.personal_guid_1c = JSON.stringify([Context.data.id_personal])\n\t\tawaitingApp.data.document_creation_data = JSON.stringify(body)\n\t\tawaitingApp.data.additional_info = Context.data.additional_info ?? \"\";\n\t\tawaitingApp.data.base_1c_name = Context.data.connection_name ?? undefined;\n\t\tawait awaitingApp.save()\n\n\t\tContext.data.integration_app_id = awaitingApp.data.__id\n\t}\n}",
    "execution": [
      {
        "code": "sync",
        "name": "Синхронное"
      }
    ],
    "allowGlobal": false,
    "checkInterval": ""
  },
  "async": false,
  "__createdAt": "2023-12-20T13:08:01.623447167Z",
  "__createdBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "__updatedAt": "2024-02-14T11:09:53.852663892Z",
  "__updatedBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "__deletedAt": null
}
