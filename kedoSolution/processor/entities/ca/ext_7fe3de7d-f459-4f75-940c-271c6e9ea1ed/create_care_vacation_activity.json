{
  "__id": "b808afdc-6995-46cb-b512-b6ce6bce5221",
  "__name": "__old Создать отпуск по уходу за ребенком(Удалить)",
  "code": "create_care_vacation",
  "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "type": [
    {
      "code": "script",
      "name": "Скрипт"
    }
  ],
  "group": "7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "icon": "system",
  "color": "#fde9a0",
  "itemName": "",
  "description": "",
  "retryCount": 0,
  "retryDelay": 5,
  "context": [
    {
      "code": "error",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ошибка",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    },
    {
      "code": "response",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ответ",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    },
    {
      "code": "org_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "id Организации",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "start_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дата начала",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "end_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дата окончания",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "end_payment_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дата окончания выплат",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "pay_during_vacation",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Начислять зарплату по время отпуска",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "guid",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "id Сотрдуника",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "personal_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "id ФЛ",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "planned_payment_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дата планируемой вылаты",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    }
  ],
  "draft": false,
  "published": true,
  "data": {
    "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n\nСигнатуры функций\n\nДля синхронного взаимодействия:\n\tasync function action(): Promise\u003cvoid\u003e;\n\nДля модели проверки результата:\n\tasync function action(): Promise\u003cvoid\u003e;\n\tasync function check(): Promise\u003cboolean\u003e;\n\nДля модели обратного вызова:\n\tasync function action(url: string): Promise\u003cvoid\u003e;\n\tasync function callback(req: HTTPRequest): Promise\u003cvoid\u003e;\n\n**/\n\nconst baseUrl = Namespace.params.data.url_1c_odata;\nconst login = Namespace.params.data.login;\nconst password = Namespace.params.data.password;\nconst myHeaders = {\n    Authorization: `Basic ${btoa(login + ':' + password)}`,\n};\n\nasync function action(): Promise\u003cvoid\u003e{\n\tconst requestOptions: FetchRequest = {\n\t\tmethod: 'POST',\n\t\theaders: myHeaders,\n\t};\n\tconst currentDate = new TDate();\n\tlet planned_payment_date = ''\n\n\tif(!Context.data.planned_payment_date) {\n\t\tconst startDate = new Datetime(Context.data.start_date!);\n\t\tplanned_payment_date = startDate.addDate(0, 0, -3).format('YYYY-MM-DD');\n\t} else {\n\t\tplanned_payment_date = Context.data.planned_payment_date\n\t}\n\n\tconst body = {\n\t\t\"Date\": `${currentDate.format('YYYY-MM-DD')}T00:00:00`,\n\t\t\"ВыплачиватьПособиеДоТрехЛет\": false,\n\t\t\"ПериодРегистрации\": `${currentDate.format('YYYY-MM')}-01T00:00:00`,\n\t\t\"ПланируемаяДатаВыплаты\": `${planned_payment_date}T00:00:00`,\n\t\t\"ДатаЗапрета\": `${Context.data.start_date}T00:00:00`,\n\t\t\"ДатаНачала\": `${Context.data.start_date}T00:00:00`,\n\t\t\"ДатаОкончания\": `${Context.data.end_date}T00:00:00`,\n\t\t\"НеНачислятьЗарплатуИНеВыплачиватьАвансВоВремяОтпуска\": !!Context.data.pay_during_vacation,\n\t\t\"Организация_Key\": Context.data.org_id,\n\t\t\"ОсновнойСотрудник_Key\": Context.data.guid,\n\t\t\"ПорядокВыплаты\": \"Межрасчет\",\n\t\t\"РайонныйКоэффициентРФнаНачалоСобытия\": 1,\n\t\t\"РассчитатьЗарплату\": false,\n\n\t\t\"РасчетПоПравилам2010Года\": false,\n\t\t\"Сотрудник_Key\": Context.data.guid,\n\t\t\"ФиксПериодРасчетаСреднегоЗаработка\": false\n\t}\n\n\t\n\n\trequestOptions.body = JSON.stringify(body);\n\n\n\tContext.data.debug = 'fetch'\n\tconst resUrl = `${baseUrl}/Document_ОтпускПоУходуЗаРебенком?$format=json`;\n\n\ttry {\n\t\tconst response = await fetch(`${encodeURI(resUrl)}`, requestOptions)\n\t\tif (!response.ok) {\n\t\t\tContext.data.error += ` staff data res.status error; resUrl - ${resUrl} `\n\t\t\tthrow new Error(`res error ${resUrl}`);\n\t\t}\n\n\t\tContext.data.response = JSON.stringify(await response.json());\n\t} catch (err){\n\t\tContext.data.error += ` try/catch error ${err}; resUrl - ${resUrl} `\n\t\tthrow new Error(err)\n\t}\n}",
    "execution": [
      {
        "code": "sync",
        "name": "Синхронное"
      }
    ],
    "allowGlobal": false,
    "checkInterval": ""
  },
  "async": false,
  "__createdAt": "2023-12-20T13:08:02.000482191Z",
  "__createdBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "__updatedAt": "2024-02-14T11:09:54.764461703Z",
  "__updatedBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "__deletedAt": null
}
