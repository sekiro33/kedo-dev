{
  "__id": "fa9f976d-3ce9-4dca-b9c8-75592b4266a8",
  "__name": "Смена статуса",
  "code": "change_status",
  "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "type": [
    {
      "code": "script",
      "name": "Скрипт"
    }
  ],
  "group": "7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "icon": "system",
  "color": "#20c997",
  "itemName": "",
  "bindForm": true,
  "description": "",
  "retryCount": 0,
  "retryDelay": 5,
  "context": [
    {
      "code": "app",
      "type": "REF_ITEM",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Приложение",
        "data": {},
        "input": true,
        "output": false
      }
    },
    {
      "code": "status",
      "type": "ENUM",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "enumItems": [
          {
            "code": "new",
            "name": "Новая",
            "checked": false
          },
          {
            "code": "additional_signing",
            "name": "На доп. подписании",
            "checked": false
          },
          {
            "code": "paper_prepare",
            "name": "Оформление на бумаге",
            "checked": false
          },
          {
            "code": "cancelled",
            "name": "Отменено",
            "checked": false
          },
          {
            "code": "transfer",
            "name": "Оформление переноса",
            "checked": false
          },
          {
            "code": "order_prepare",
            "name": "Подготовка приказа",
            "checked": false
          },
          {
            "code": "withdrawal",
            "name": "Отзыв заявления",
            "checked": false
          },
          {
            "code": "correction",
            "name": "На корректировке",
            "checked": false
          },
          {
            "code": "chief_order_signing",
            "name": "Подписание приказа работодателем",
            "checked": false
          },
          {
            "code": "order_correction",
            "name": "Приказ на корректировке",
            "checked": false
          },
          {
            "code": "signing",
            "name": "На подписании",
            "checked": false
          },
          {
            "code": "order_signed",
            "name": "Приказ подписан",
            "checked": false
          },
          {
            "code": "staff_cancelled",
            "name": "Отказ сотрудника",
            "checked": false
          },
          {
            "code": "approval",
            "name": "На согласовании",
            "checked": false
          },
          {
            "code": "staff_order_signing",
            "name": "Подписание приказа сотрудником",
            "checked": false
          },
          {
            "code": "paper_signed",
            "name": "Подписан на бумаге",
            "checked": false
          },
          {
            "code": "need_decision",
            "name": "Требует принять решение",
            "checked": false
          },
          {
            "code": "pending",
            "name": "В процессе оформления",
            "checked": false
          },
          {
            "code": "on_prepare",
            "name": "На подготовке",
            "checked": false
          },
          {
            "code": "agreed_signed",
            "name": "Согласовано / подписано",
            "checked": false
          },
          {
            "code": "completed",
            "name": "Завершен",
            "checked": false
          },
          {
            "code": "issued",
            "name": "Оформлено",
            "checked": false
          },
          {
            "code": "signed",
            "name": "Подписан",
            "checked": false
          },
          {
            "code": "signing_application",
            "name": "На подписании заявления",
            "checked": false
          },
          {
            "code": "at_look",
            "name": "На ознакомлении",
            "checked": false
          },
          {
            "code": "waiting_start",
            "name": "Ожидание начала",
            "checked": false
          },
          {
            "code": "in_progress",
            "name": "В процессе",
            "checked": false
          },
          {
            "code": "waiting_confirm",
            "name": "Ожидание подтверждения",
            "checked": false
          },
          {
            "code": "submit_document",
            "name": "Требуется передать документ",
            "checked": false
          },
          {
            "code": "payment_money",
            "name": "Выплата начислений",
            "checked": false
          },
          {
            "code": "prepare_report",
            "name": "Подготовка отчета",
            "checked": false
          },
          {
            "code": "making_cancellation",
            "name": "Оформление отмены",
            "checked": false
          },
          {
            "code": "signing_consent",
            "name": "На подписании согласия",
            "checked": false
          },
          {
            "code": "at_work",
            "name": "В работе",
            "checked": false
          },
          {
            "code": "doc_issuance",
            "name": "Выдача документа",
            "checked": false
          },
          {
            "code": "introduction",
            "name": "Ознакомлен",
            "checked": false
          },
          {
            "code": "vacation_pay_calculation",
            "name": "Расчёт отпускных",
            "checked": false
          },
          {
            "code": "vacation_pay_payment",
            "name": "Выплата отпускных",
            "checked": false
          }
        ]
      },
      "view": {
        "name": "Статус",
        "data": {},
        "input": true
      }
    },
    {
      "code": "kedo_status",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "statuses",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "namespace": "kedo"
      },
      "view": {
        "name": "КЭДО статусы",
        "data": {},
        "input": false,
        "output": false
      }
    }
  ],
  "draft": false,
  "published": true,
  "data": {
    "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n\nСигнатуры функций\n\nДля синхронного взаимодействия:\n\tasync function action(): Promise\u003cvoid\u003e;\n\nДля модели проверки результата:\n\tasync function action(): Promise\u003cvoid\u003e;\n\tasync function check(): Promise\u003cboolean\u003e;\n\nДля модели обратного вызова:\n\tasync function action(url: string): Promise\u003cvoid\u003e;\n\tasync function callback(req: HTTPRequest): Promise\u003cvoid\u003e;\n\n**/\n\nasync function action(): Promise\u003cvoid\u003e {\n\tif (!Context.data.app) {\n\t\treturn\n\t\t//throw new Error(\"Context.data.app is undefined\");\n\t}\n\n\tif (!Context.data.status) {\n\t\tthrow new Error(\"Context.data.status is undefined\");\n\t}\n\n\tconst app = await Context.data.app.fetch();\n\tconst status_code = Context.data.status.code;\n\n\t// const status = await Context.fields.kedo_status.app.search()\n\t// \t.where((f, g) =\u003e g.and(\n\t// \t\tf.__deletedAt.eq(null),\n\t// \t\tf.code.eq(status_code)\n\t// \t))\n\t// \t.first();\n\n\t// const status = await Namespace.params.fields.kedo_status.app.search()\n\tconst status = await Context.fields.kedo_status.app.search()\n\t\t.where((f, g) =\u003e g.and(\n\t\t\tf.__deletedAt.eq(null),\n\t\t\tf.code.eq(status_code)\n\t\t))\n\t\t.first();\n\n\tapp.data.kedo_status = status;\n\tawait app.save();\n}",
    "execution": [
      {
        "code": "sync",
        "name": "Синхронное"
      }
    ],
    "allowGlobal": false,
    "checkInterval": ""
  },
  "async": false,
  "__createdAt": "2023-12-20T13:08:02.253671014Z",
  "__createdBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "__updatedAt": "2024-03-12T07:32:28.785932204Z",
  "__updatedBy": "d4c0aacb-19ed-44fa-b229-5f7ed736889c",
  "__deletedAt": null
}
