{
  "__id": "08f5dcd9-2c07-41ac-8ad1-0040ad167960",
  "__name": "__old(1С ЗУП) Создать заявление на материальную помощь",
  "code": "create_financial_assistance",
  "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "type": [
    {
      "code": "script",
      "name": "Скрипт"
    }
  ],
  "group": "7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "icon": "system",
  "color": "#20c997",
  "itemName": "",
  "description": "",
  "retryCount": 0,
  "retryDelay": 5,
  "context": [
    {
      "code": "document_data",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Данные документа",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "alternative_way",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": false,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Альтернативная интеграция",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        },
        "input": true
      }
    },
    {
      "code": "connection_name",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Имя подключения 1С",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "additional_info",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дополнительная информация",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "integration_app_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "ID приложения интеграции",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    }
  ],
  "draft": false,
  "published": true,
  "data": {
    "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n\nСигнатуры функций\n\nДля синхронного взаимодействия:\n\tasync function action(): Promise\u003cvoid\u003e;\n\nДля модели проверки результата:\n\tasync function action(): Promise\u003cvoid\u003e;\n\tasync function check(): Promise\u003cboolean\u003e;\n\nДля модели обратного вызова:\n\tasync function action(url: string): Promise\u003cvoid\u003e;\n\tasync function callback(req: HTTPRequest): Promise\u003cvoid\u003e;\n\n**/\n\ninterface IFinancialAssistanceData {\n\tcreationAt : string,\n\torganizationId : string,\n\tsubdivisionId : string,\n\tstaffId : string,\n\tindividualId: string\n\tmoney: number,\n\tcomment? : string,\n}\n\nasync function action(): Promise\u003cvoid\u003e {\n\tif (!Context.data.document_data) {\n\t\tthrow new Error(\"Данные для создания документа не указаны. Context.data.document_data is undefined\");\n\t}\n\n\tconst financial_assistance_data : IFinancialAssistanceData = JSON.parse(Context.data.document_data);\n\n\tconst currentDate = new Datetime();\n\n\tconst body: any = {\n\t\t\"Date\": `${currentDate.format('YYYY-MM-DD')}T00:00:00`,\n\t\t\"ПериодРегистрации\" : `${currentDate.format('YYYY-MM')}-01T00:00:00`,\n\t\t\"Организация_Key\": financial_assistance_data.organizationId,\n\t\t\"ДатаНачала\": financial_assistance_data.creationAt,\n\t\t\"ДатаОкончания\": financial_assistance_data.creationAt,\n\t\t\"ОснованиеВыплаты\": \"Заявление сотрудника\",\n\t\t\"Комментарий\": financial_assistance_data.comment ?? \"\",\n\t\t\"ПорядокВыплаты\":\"Межрасчет\",\n\t\t\"Начисления\": [\n\t\t\t{\n\t\t\t\t\"LineNumber\": \"1\",\n\t\t\t\t\"Сотрудник_Key\": financial_assistance_data.staffId,\n\t\t\t\t\"Подразделение_Key\": financial_assistance_data.subdivisionId,\n\t\t\t\t\"ДатаНачала\": financial_assistance_data.creationAt,\n\t\t\t\t\"ДатаОкончания\": financial_assistance_data.creationAt,\n\t\t\t\t\"Результат\" : financial_assistance_data.money,\n\t\t\t}\n\t\t],\n\t}\n\n\tconst accounting1c = Namespace.params.fields.awaiting_docs_table_1c.app.fields.accounting_systems.variants.zup_1c\n\tconst integration_app = Namespace.params.fields.awaiting_docs_table_1c.app.create()\n\n\tintegration_app.data.__name = \"Материальная помощь\"\n\tintegration_app.data.document_odata_name = \"Document_МатериальнаяПомощь\"\n\tintegration_app.data.accounting_systems = accounting1c\n\tintegration_app.data.personal_guid_1c = JSON.stringify([financial_assistance_data.individualId])\n\tintegration_app.data.document_creation_data = JSON.stringify(body)\n\tintegration_app.data.additional_info = Context.data.additional_info ?? \"\";\n\tintegration_app.data.base_1c_name = Context.data.connection_name ?? undefined;\n\tawait integration_app.save()\n\n\tContext.data.integration_app_id = integration_app.data.__id\n}",
    "execution": [
      {
        "code": "sync",
        "name": "Синхронное"
      }
    ],
    "allowGlobal": false,
    "checkInterval": ""
  },
  "async": false,
  "deprecated": true,
  "deprecatedMessage": "Перенесено в модуль 1С",
  "__createdAt": "2024-05-27T06:34:20.837063697Z",
  "__createdBy": "59e0911f-230a-4b6d-becf-6b302a91977a",
  "__updatedAt": "2024-05-30T13:14:19.098271657Z",
  "__updatedBy": "59e0911f-230a-4b6d-becf-6b302a91977a",
  "__deletedAt": null
}
