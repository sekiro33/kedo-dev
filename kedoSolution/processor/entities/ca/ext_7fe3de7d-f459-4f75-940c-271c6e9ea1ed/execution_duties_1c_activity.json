{
  "__id": "7a818e72-5557-4d63-bbeb-118ab8037dc3",
  "__name": "__old(1С ЗУП) Исполнение обязанностей",
  "code": "execution_duties_1c",
  "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "type": [
    {
      "code": "script",
      "name": "Скрипт"
    }
  ],
  "group": "7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
  "icon": "system",
  "color": "#20c997",
  "itemName": "",
  "bindForm": true,
  "description": "",
  "retryCount": 0,
  "retryDelay": 5,
  "context": [
    {
      "code": "organization_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1C) ID организации",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "combining_staff_id_1c",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID совмещающего сотрудника",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "combining_staff_persoal_id_1c",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID ФЛ совмещающего сотрудника",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "start_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) Дата начала совмещения",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "end_date",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) Дата окончания совмещения",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "combining_postiion",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID совмещаемой должности",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "absent_staff_id_1c",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1С) ID отсутствующего сотрудника",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "bet_size",
      "type": "FLOAT",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "(1C) Размер ставки",
        "data": {
          "additionalType": "float",
          "showRowSeparator": true
        },
        "input": true
      }
    },
    {
      "code": "combination_type",
      "type": "ENUM",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "enumItems": [
          {
            "code": "professional_duties",
            "name": "Совмещение профессий (должностей)",
            "checked": false
          },
          {
            "code": "performance_duties",
            "name": "Исполнение обязанностей сотрудника",
            "checked": false
          },
          {
            "code": "expansion_service_areas",
            "name": "Расширение зон обслуживания",
            "checked": false
          }
        ]
      },
      "view": {
        "name": "Вид совмещения",
        "data": {},
        "input": true
      }
    },
    {
      "code": "integration_app_id",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "ID приложения интеграции",
        "data": {
          "additionalType": "string"
        },
        "output": true
      }
    },
    {
      "code": "comment",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Комментарий",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "type_surcharge",
      "type": "ENUM",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "enumItems": [
          {
            "code": "percent_main_position",
            "name": "Процент от оклада по основной должности",
            "checked": false
          },
          {
            "code": "percen_combination",
            "name": "Процент от оклада по должности совмещения",
            "checked": false
          },
          {
            "code": "fixed_amount",
            "name": "Фиксированная сумма",
            "checked": false
          }
        ]
      },
      "view": {
        "name": "Вид доплаты",
        "data": {},
        "input": true
      }
    },
    {
      "code": "percent",
      "type": "FLOAT",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Процент доплаты / фиксированная сумма",
        "data": {
          "additionalType": "float",
          "showRowSeparator": true
        },
        "input": true
      }
    },
    {
      "code": "connection_name",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Имя подключения 1С",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    },
    {
      "code": "additional_info",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дополнительная информация",
        "data": {
          "additionalType": "string"
        },
        "input": true
      }
    }
  ],
  "draft": false,
  "published": true,
  "data": {
    "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n\nСигнатуры функций\n\nДля синхронного взаимодействия:\n\tasync function action(): Promise\u003cvoid\u003e;\n\nДля модели проверки результата:\n\tasync function action(): Promise\u003cvoid\u003e;\n\tasync function check(): Promise\u003cboolean\u003e;\n\nДля модели обратного вызова:\n\tasync function action(url: string): Promise\u003cvoid\u003e;\n\tasync function callback(req: HTTPRequest): Promise\u003cvoid\u003e;\n\n**/\n\nasync function action(): Promise\u003cvoid\u003e {\n\tconst currentDate = new Datetime();\n\n\tconst body: any = {\n\t\t\"Date\": `${currentDate.format('YYYY-MM-DD')}T00:00:00`,\n\t\t\"Организация_Key\": `${Context.data.organization_id}`,\n\t\t\"ДатаНачала\": `${Context.data.start_date}T00:00:00`,\n\t\t\"ДатаОкончания\": `${Context.data.end_date}T00:00:00`,\n\t\t\"СовмещающийСотрудник_Key\": `${Context.data.combining_staff_id_1c}`,\n\t\t\"Комментарий\": `${Context.data.comment ?? \"\"}`,\n\t\t\"КоличествоСтавок\": Context.data.bet_size ?? 0.25,\n\t}\n\n\tif (Context.data.combination_type) {\n\t\tswitch (Context.data.combination_type.code) {\n\t\t\tcase Context.fields.combination_type.variants.expansion_service_areas.code:\n\t\t\t\tbody['ПричинаСовмещения'] = 'УвеличениеОбъемаРабот';\n\t\t\t\tbreak;\n\n\t\t\tcase Context.fields.combination_type.variants.performance_duties.code:\n\t\t\t\tbody['ПричинаСовмещения'] = 'ИсполнениеОбязанностей';\n\t\t\t\tbody['ОтсутствующийСотрудник_Key'] = `${Context.data.absent_staff_id_1c ?? \"\"}`;\n\t\t\t\tbreak;\n\n\t\t\tcase Context.fields.combination_type.variants.professional_duties.code:\n\t\t\t\tbody['ПричинаСовмещения'] = 'СовмещениеПрофессийДолжностей';\n\t\t\t\tbody['СовмещаемаяДолжность_Key'] = `${Context.data.combining_postiion ?? \"\"}`;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (Context.data.type_surcharge) {\n\t\tswitch (Context.data.type_surcharge.code) {\n\t\t\tcase Context.fields.type_surcharge.variants.fixed_amount.code:\n\t\t\t\tbody['РазмерДоплаты'] = Context.data.percent ?? 0;\n\t\t\t\tbreak;\n\n\t\t\tcase Context.fields.type_surcharge.variants.percen_combination.code:\n\t\t\t\tbody['РассчитыватьДоплату'] = true;\n\t\t\t\tbody['СпособРасчетаДоплаты'] = 'ПроцентФОТСовмещающего';\n\t\t\t\tbody['ПроцентДоплаты'] = Context.data.percent ?? 0;\n\t\t\t\tbreak;\n\n\t\t\tcase Context.fields.type_surcharge.variants.percent_main_position.code:\n\t\t\t\tbody['РассчитыватьДоплату'] = true;\n\t\t\t\tbody['СпособРасчетаДоплаты'] = 'ПроцентФОТ';\n\t\t\t\tbody['ПроцентДоплаты'] = Context.data.percent ?? 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst accounting1c = Namespace.params.fields.awaiting_docs_table_1c.app.fields.accounting_systems.variants.zup_1c;\n\tconst awaitingApp = Namespace.params.fields.awaiting_docs_table_1c.app.create();\n\n\tawaitingApp.data.__name = \"Исполнение обязанностей\";\n\tawaitingApp.data.document_odata_name = \"Document_Совмещение\";\n\tawaitingApp.data.accounting_systems = accounting1c;\n\tawaitingApp.data.personal_guid_1c = JSON.stringify([Context.data.combining_staff_persoal_id_1c]);\n\tawaitingApp.data.document_creation_data = JSON.stringify(body);\n\tawaitingApp.data.additional_info = Context.data.additional_info ?? \"\"\n\tif(Context.data.connection_name) {\n\t\tawaitingApp.data.base_1c_name = Context.data.connection_name\n\t}\n\tawait awaitingApp.save();\n\n\tContext.data.integration_app_id = awaitingApp.data.__id\n}",
    "execution": [
      {
        "code": "sync",
        "name": "Синхронное"
      }
    ],
    "allowGlobal": false,
    "checkInterval": ""
  },
  "async": false,
  "deprecated": true,
  "deprecatedMessage": "Перенесено в модуль 1С",
  "__createdAt": "2024-05-27T06:34:21.539058738Z",
  "__createdBy": "59e0911f-230a-4b6d-becf-6b302a91977a",
  "__updatedAt": "2024-05-30T13:14:55.368587143Z",
  "__updatedBy": "59e0911f-230a-4b6d-becf-6b302a91977a",
  "__deletedAt": null
}
