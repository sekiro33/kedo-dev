{
  "__id": "79401469-d292-4add-b3a0-c12d546898c7",
  "__name": "Перевод сотрудника",
  "code": "transfer_staff",
  "namespace": "ext_3c26e96d-9ba5-486d-a26e-47918e61fad3",
  "type": [
    {
      "code": "script",
      "name": "Скрипт"
    }
  ],
  "group": "3c26e96d-9ba5-486d-a26e-47918e61fad3",
  "icon": "system",
  "color": "#20c997",
  "itemName": "",
  "description": "",
  "retryCount": 0,
  "retryDelay": 5,
  "context": [
    {
      "code": "transfer_staff_data",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": true,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Данные по переводу сотрудника",
        "data": {
          "additionalType": "string"
        },
        "input": true,
        "output": false
      }
    },
    {
      "code": "connection_name",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Имя подключения 1С",
        "data": {
          "additionalType": "string"
        },
        "input": true,
        "output": false
      }
    },
    {
      "code": "additional_info",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дополнительная информация",
        "data": {
          "additionalType": "string"
        },
        "input": true,
        "output": false
      }
    },
    {
      "code": "integration_app",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "awaiting_documents_table_1c",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "namespace": "kedo"
      },
      "view": {
        "name": "Приложение интеграции",
        "data": {},
        "input": false,
        "output": true
      }
    }
  ],
  "draft": false,
  "published": true,
  "data": {
    "scripts": "/**\nЗдесь вы можете написать скрипты для сложной серверной обработки контекста во время выполнения процесса.\nДля написания скриптов используйте TypeScript (https://www.typescriptlang.org).\nДокументация TS SDK доступна на сайте https://tssdk.elma365.com.\n\nСигнатуры функций\n\nДля синхронного взаимодействия:\n\tasync function action(): Promise\u003cvoid\u003e;\n\nДля модели проверки результата:\n\tasync function action(): Promise\u003cvoid\u003e;\n\tasync function check(): Promise\u003cboolean\u003e;\n\nДля модели обратного вызова:\n\tasync function action(url: string): Promise\u003cvoid\u003e;\n\tasync function callback(req: HTTPRequest): Promise\u003cvoid\u003e;\n\n**/\n\ninterface IStaffData {\n\tname: string,\n\tid_1c: string,\n\tindividual_id_1c: string,\n\torganization_id: string,\n\tposition_id: string,\n\tstructural_subdivision_id: string,\n}\n\ninterface TransferData {\n\tstaff: IStaffData,\n\tstart_date: string,\n\tend_date?: string,\n\treason: string,\n\tbase: string,\n\tcomment?: string,\n\twork_place?: string,\n\tremote_work?: boolean,\n\tposition_id?: string,\n\tsubdivison_id?: string,\n\twork_schedule_id?: string,\n\ttemporary_transfer?: boolean,\n}\n\nasync function action(): Promise\u003cvoid\u003e {\n\tif (!Context.data.transfer_staff_data) {\n\t\tthrow new Error(\"Context.data.transfer_staff_data is undefined\");\n\t}\n\n\tconst current_date = new Datetime();\n\tconst transfer: TransferData = JSON.parse(Context.data.transfer_staff_data);\n\n\tconst body: any = {\n\t\t\"Date\": current_date.format(\"YYYY-MM-DDT00:00:00\"),\n\t\t\"Организация_Key\": transfer.staff.organization_id,\n\t\t\"Сотрудник_Key\": transfer.staff.id_1c,\n\t\t\"ФизическоеЛицо_Key\": transfer.staff.individual_id_1c,\n\t\t\"ДатаНачала\": transfer.start_date,\n\t\t\"ВидЗанятости\": \"ОсновноеМестоРаботы\",\n\t\t\"КоличествоСтавок\": 1,\n\t\t\"ВидДоговора\": \"ТрудовойДоговор\",\n\t\t\"КоэффициентИндексации\": 1,\n\t\t\"ДатаЗапрета\": transfer.start_date,\n\t\t\"НаименованиеДокумента\": \"Приказ\",\n\t\t\"ПричинаПеревода\": transfer.reason,\n\t\t\"ОснованиеПеревода\": transfer.base,\n\t\t\"ИзменитьСведенияОДоговореКонтракте\": true,\n\t\t\"Комментарий\": transfer.comment,\n\t}\n\n\tif (transfer.work_place) {\n\t\tbody[\"ИзменитьРабочееМесто\"] = true;\n\t\tbody[\"РабочееМесто_Key\"] = transfer.work_place;\n\t}\n\n\tif (transfer.remote_work) {\n\t\tbody[\"РаботаетДистанционно\"] = transfer.remote_work;\n\t\tbody[\"ИзменитьДистанционнуюРаботу\"] = true;\n\t}\n\n\tif (transfer.position_id \u0026\u0026 transfer.subdivison_id) {\n\t\tbody[\"Должность_Key\"] = transfer.position_id;\n\t\tbody[\"Подразделение_Key\"] = transfer.subdivison_id;\n\t\tbody[\"ИзменитьПодразделениеИДолжность\"] = true;\n\t}\n\n\tif (transfer.work_schedule_id) {\n\t\tbody[\"ГрафикРаботы_Key\"] = transfer.work_schedule_id;\n\t\tbody[\"ИзменитьГрафикРаботы\"] = true;\n\t}\n\n\tif (transfer.end_date) {\n\t\tbody[\"ДатаОкончания\"] = transfer.end_date;\n\t}\n\n\tconst accounting1c = Namespace.params.fields.integration_app.app.fields.accounting_systems.variants.zup_1c;\n\tconst integration_app = Namespace.params.fields.integration_app.app.create();\n\n\tintegration_app.data.__name = `Кадровый перевод (${transfer.staff.name})`;\n\tintegration_app.data.document_odata_name = \"Document_КадровыйПеревод\";\n\tintegration_app.data.accounting_systems = accounting1c;\n\tintegration_app.data.personal_guid_1c = JSON.stringify([transfer.staff.individual_id_1c]);\n\tintegration_app.data.document_creation_data = JSON.stringify(body);\n\tintegration_app.data.additional_info = Context.data.additional_info;\n\tintegration_app.data.base_1c_name = Context.data.connection_name;\n\n\tawait integration_app.save();\n\n\tContext.data.integration_app = integration_app;\n}",
    "execution": [
      {
        "code": "sync",
        "name": "Синхронное"
      }
    ],
    "allowGlobal": false,
    "checkInterval": ""
  },
  "async": false,
  "__createdAt": "2024-05-31T11:19:29.769738348Z",
  "__createdBy": "59e0911f-230a-4b6d-becf-6b302a91977a",
  "__updatedAt": "2024-05-31T20:31:08.443659173Z",
  "__updatedBy": "59e0911f-230a-4b6d-becf-6b302a91977a",
  "__deletedAt": null
}
