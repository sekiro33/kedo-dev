{
  "__id": "018e83e7-588d-7e24-8dd5-5757449b2efb",
  "namespace": "kedo.docs_lna",
  "code": "introduction_lna",
  "category": "00000000-0000-0000-0000-000000000000",
  "__name": "Ознакомление с ЛНА",
  "type": "bpmn",
  "draft": false,
  "version": 1,
  "context": [
    {
      "code": "staff",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "staff",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Сотрудник",
        "data": {}
      }
    },
    {
      "code": "counter",
      "type": "FLOAT",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "counter",
        "data": {
          "additionalType": "integer",
          "showRowSeparator": true
        }
      }
    },
    {
      "code": "review_date",
      "type": "DATETIME",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Дата ознакомления",
        "data": {
          "additionalType": "datetime",
          "defaultTimeType": "startOfDay"
        }
      }
    },
    {
      "code": "link",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ссылка",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "all_docs_lna",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": false,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "docs_lna",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Документы ЛНА",
        "data": {}
      }
    },
    {
      "code": "position",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "position",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Позиция ШР",
        "data": {}
      }
    },
    {
      "code": "docs_count",
      "type": "FLOAT",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "docs_count",
        "data": {
          "additionalType": "integer",
          "showRowSeparator": true
        }
      }
    },
    {
      "code": "docs_lna",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "docs_lna",
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        },
        "bindings": null,
        "namespace": "kedo",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Документ ЛНА"
      }
    },
    {
      "code": "personal_data_employee",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Личные данные внёс сотрудник",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        }
      }
    },
    {
      "code": "staff_user",
      "type": "SYS_USER",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "filter": {
          "value": {
            "tf": {}
          },
          "enabled": false
        }
      },
      "view": {
        "name": "Сотрудник пользователь",
        "data": {}
      }
    },
    {
      "code": "ignore_substitution",
      "type": "BOOLEAN",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": true,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Игнорировать замещение?",
        "data": {
          "additionalType": "radio",
          "noValue": "Нет",
          "yesValue": "Да"
        }
      }
    }
  ],
  "manualRun": false,
  "readonly": false,
  "__createdAt": "2023-03-23T06:17:04.546991218Z",
  "__createdBy": "8b6393ab-540b-4559-8c18-7ef92a9cc24a",
  "__updatedAt": "2024-03-13T12:26:26.33316264Z",
  "__updatedBy": "cd06151e-bd48-4554-bb3b-34ae2f4e4eb3",
  "process": {
    "items": {
      "00000000-0000-0000-0000-000000000000": {
        "x": 104,
        "y": 72,
        "id": "00000000-0000-0000-0000-000000000000",
        "lane": "a5425754-e784-4e84-88ba-c5547ba5d08f",
        "type": "start",
        "color": "#ffffff",
        "exits": ["57cff533-f94f-4926-af77-ed99960ac2ec"],
        "width": 32,
        "height": 32,
        "settings": {
          "formFields": [
            {
              "code": "docs_lna",
              "data": {
                "listSettings": {
                  "sort": {
                    "field": "",
                    "direction": "",
                    "additionalSortSettings": null
                  },
                  "limit": 10,
                  "buttons": [
                    {
                      "id": "2c110a38-81dd-45e7-8856-2e09cbcfcdf0",
                      "code": "create",
                      "type": "primary",
                      "label": "+ Документ ЛНА",
                      "bindings": [],
                      "immutable": false,
                      "silentRun": false,
                      "permission": "create",
                      "skipRequired": false,
                      "defaultValues": {},
                      "useSimpleForm": false,
                      "simpleFormSize": "default",
                      "allowedGroupIds": [],
                      "allowedStatusIds": [],
                      "processLinkChanged": false,
                      "showForAllowedStatuses": false,
                      "showForAllowedStatusGroups": false
                    },
                    {
                      "id": "6e28f41c-bae0-4273-9018-d2004f232e42",
                      "type": "default",
                      "label": "Ознакомление с ЛНА",
                      "bindings": [],
                      "immutable": false,
                      "silentRun": false,
                      "processCode": "introduction_lna",
                      "processField": "docs_lna",
                      "skipRequired": false,
                      "useSimpleForm": true,
                      "simpleFormSize": "default",
                      "allowedGroupIds": [],
                      "allowedStatusIds": [],
                      "processNamespace": "kedo.docs_lna",
                      "processLinkChanged": true,
                      "showForAllowedStatuses": false,
                      "showForAllowedStatusGroups": false
                    },
                    {
                      "id": "642bad1f-914f-416c-a8fe-d73a07953a98",
                      "type": "default",
                      "label": "Выгрузка отчета ознакомление с ЛНА по сотруднику",
                      "bindings": [],
                      "immutable": false,
                      "silentRun": false,
                      "permission": "create",
                      "processCode": "uploading_report_consultations_LNA_employee",
                      "processField": "docs_lna",
                      "skipRequired": false,
                      "useSimpleForm": true,
                      "simpleFormSize": "default",
                      "allowedGroupIds": [],
                      "allowedStatusIds": [],
                      "processNamespace": "kedo.docs_lna",
                      "processLinkChanged": true,
                      "showForAllowedStatuses": false,
                      "showForAllowedStatusGroups": false
                    }
                  ],
                  "aggregateField": "",
                  "autoUpdateCards": false,
                  "enabledMassActions": false
                },
                "tableSettings": {
                  "displayFields": [
                    "__name",
                    "name",
                    "organization",
                    "wWho_acquainted",
                    "groups_lna",
                    "agreement_position",
                    "staff"
                  ]
                },
                "createButtonId": "",
                "showCreateItem": false,
                "showSelectItem": true
              },
              "tooltip": "",
              "readonly": false,
              "required": true,
              "hideEmpty": false
            },
            {
              "code": "staff",
              "data": {
                "listSettings": {
                  "sort": {
                    "field": "",
                    "direction": "",
                    "additionalSortSettings": null
                  },
                  "limit": 10,
                  "buttons": [
                    {
                      "id": "47e6f238-74e0-48f4-b6fe-cacdb77def81",
                      "code": "create",
                      "type": "primary",
                      "label": "+ Сотрудник",
                      "bindings": [],
                      "immutable": false,
                      "silentRun": false,
                      "permission": "create",
                      "skipRequired": false,
                      "defaultValues": {
                        "inn": null,
                        "sex": null,
                        "city": null,
                        "home": null,
                        "note": null,
                        "email": null,
                        "phone": null,
                        "snils": null,
                        "entity": null,
                        "region": null,
                        "street": null,
                        "address": null,
                        "housing": null,
                        "ext_user": null,
                        "inn_file": null,
                        "marriage": null,
                        "position": null,
                        "apartment": null,
                        "full_name": null,
                        "issued_by": null,
                        "scan_soev": null,
                        "note_files": null,
                        "snils_file": null,
                        "__directory": null,
                        "is_employed": null,
                        "__externalId": null,
                        "notification": null,
                        "staff_access": true,
                        "date_of_birth": null,
                        "date_of_issue": null,
                        "external_user": null,
                        "staff_comment": null,
                        "document_table": null,
                        "invalid_fields": null,
                        "passport_number": null,
                        "passport_series": null,
                        "personal_number": null,
                        "disclaimer_comment": null,
                        "employment_documents": null,
                        "__externalProcessMeta": null,
                        "structural_subdivision": null,
                        "passport_department_code": null,
                        "photo_with_unfolded_passport": null,
                        "passport_page_with_photo_and_data": null,
                        "the_passport_page_with_current_registration": null
                      },
                      "useSimpleForm": false,
                      "simpleFormSize": "default",
                      "allowedGroupIds": [],
                      "allowedStatusIds": [],
                      "processLinkChanged": false,
                      "showForAllowedStatuses": false,
                      "showForAllowedStatusGroups": false
                    },
                    {
                      "id": "377e8253-14a2-4996-a0f6-c9bf66fa54ab",
                      "code": "create",
                      "type": "default",
                      "label": "+ Сотрудник бэк-офиса",
                      "bindings": [],
                      "immutable": false,
                      "silentRun": false,
                      "permission": "create",
                      "skipRequired": false,
                      "defaultValues": {
                        "inn": null,
                        "sex": null,
                        "city": null,
                        "home": null,
                        "note": null,
                        "email": null,
                        "phone": null,
                        "snils": null,
                        "entity": null,
                        "region": null,
                        "street": null,
                        "address": null,
                        "housing": null,
                        "ext_user": null,
                        "inn_file": null,
                        "marriage": null,
                        "position": null,
                        "apartment": null,
                        "full_name": null,
                        "issued_by": null,
                        "scan_soev": null,
                        "note_files": null,
                        "snils_file": null,
                        "__directory": null,
                        "is_employed": null,
                        "__externalId": null,
                        "notification": null,
                        "staff_access": false,
                        "date_of_birth": null,
                        "date_of_issue": null,
                        "external_user": null,
                        "staff_comment": null,
                        "document_table": null,
                        "invalid_fields": null,
                        "passport_number": null,
                        "passport_series": null,
                        "personal_number": null,
                        "disclaimer_comment": null,
                        "employment_documents": null,
                        "__externalProcessMeta": null,
                        "structural_subdivision": null,
                        "passport_department_code": null,
                        "photo_with_unfolded_passport": null,
                        "passport_page_with_photo_and_data": null,
                        "the_passport_page_with_current_registration": null
                      },
                      "useSimpleForm": false,
                      "simpleFormSize": "default",
                      "allowedGroupIds": [],
                      "allowedStatusIds": [],
                      "processLinkChanged": false,
                      "showForAllowedStatuses": false,
                      "showForAllowedStatusGroups": false
                    },
                    {
                      "id": "e7878e60-015d-4b4d-a99f-254188a243ed",
                      "type": "default",
                      "label": "Загрузить сотрудников из 1С",
                      "bindings": [],
                      "immutable": false,
                      "silentRun": false,
                      "processCode": "load_employee_list",
                      "processField": "staff",
                      "skipRequired": false,
                      "useSimpleForm": true,
                      "simpleFormSize": "default",
                      "allowedGroupIds": [],
                      "allowedStatusIds": [],
                      "processNamespace": "kedo.staff",
                      "processLinkChanged": true,
                      "showForAllowedStatuses": false,
                      "showForAllowedStatusGroups": false
                    }
                  ],
                  "aggregateField": "",
                  "autoUpdateCards": false,
                  "enabledMassActions": true
                },
                "tableSettings": {
                  "columnsWidth": {
                    "__name": "257px",
                    "__status": "300px",
                    "ext_user": "300px",
                    "position": "525px",
                    "__createdAt": "300px",
                    "__createdBy": "300px",
                    "access_group": "300px",
                    "organization": "272px",
                    "staff_member": "300px",
                    "kedo_agreement": "164px",
                    "staff_categories": "300px",
                    "structural_subdivision": "300px",
                    "time_acceptance_agreement": "300px"
                  },
                  "displayFields": [
                    "__name",
                    "kedo_agreement",
                    "organization",
                    "position",
                    "structural_subdivision",
                    "__status",
                    "__createdAt",
                    "ext_user",
                    "access_group",
                    "time_acceptance_agreement",
                    "__updatedAt"
                  ]
                },
                "createButtonId": "",
                "showCreateItem": false,
                "showSelectItem": true
              },
              "tooltip": "",
              "readonly": false,
              "required": true,
              "hideEmpty": false
            }
          ],
          "instruction": "",
          "notifyMessage": "Запущен процесс",
          "titleTemplate": "Ознакомление с ЛНА ({$docs_lna})",
          "titleGenerateMethod": "template"
        }
      },
      "51173eb9-150b-4b58-824d-62b2c0a9f0a4": {
        "x": 416,
        "y": 392,
        "id": "51173eb9-150b-4b58-824d-62b2c0a9f0a4",
        "icon": "end",
        "lane": "fbc819d4-d5a5-4037-9dbe-6e47887e8022",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "547c97fc-b208-4a6a-bea0-d76e6238ad44": {
        "x": 392,
        "y": 184,
        "id": "547c97fc-b208-4a6a-bea0-d76e6238ad44",
        "icon": "send_doc",
        "lane": "fbc819d4-d5a5-4037-9dbe-6e47887e8022",
        "name": "Ознакомление с ЛНА",
        "type": "inform_list_process",
        "color": "#f0f4c3",
        "exits": ["dff69ea5-3e57-48cb-a5f5-79e99e798001"],
        "width": 80,
        "height": 64,
        "settings": {
          "formCode": "form_0bac81c2-20c3-43d2-bac8-d2bf3d0083d2",
          "taskName": " Ознакомиться: {$docs_lna}",
          "receivers": [],
          "escalation": {
            "byTime": {
              "limit": {
                "code": "review_date",
                "days": 0,
                "kind": "variable",
                "hours": 0,
                "minutes": 0,
                "absolute": true,
                "substraction": false
              },
              "action": {
                "notify": false,
                "interrupt": false,
                "receivers": []
              },
              "enabled": true
            }
          },
          "formFields": [
            {
              "code": "docs_lna",
              "tooltip": "",
              "readonly": true,
              "required": false,
              "hideEmpty": false
            }
          ],
          "settingSign": {
            "isSign": "required",
            "signFile": "required"
          },
          "messageHeader": "{$empty}: Ознакомление",
          "withoutNotify": true,
          "targetFieldCode": "docs_lna",
          "customStatusSettings": {
            "customStatuses": [
              {
                "status": "done",
                "enabled": false,
                "buttonText": "",
                "statusText": ""
              }
            ]
          },
          "isIgnoreSubstitutionTagret": "ignore_substitution"
        }
      },
      "6567d7f7-9182-47ab-8a13-ca0dd1313e9f": {
        "x": 392,
        "y": 288,
        "id": "6567d7f7-9182-47ab-8a13-ca0dd1313e9f",
        "icon": "script",
        "lane": "fbc819d4-d5a5-4037-9dbe-6e47887e8022",
        "name": "Добавление ЛНА в список в карточке сотрудника",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["1ed87ca1-d7dd-4839-b0f0-c941b41e72bf"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "add_lna_doc",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      },
      "a1a2159d-7492-4093-9e98-4a6bccc2ed67": {
        "x": 80,
        "y": 184,
        "id": "a1a2159d-7492-4093-9e98-4a6bccc2ed67",
        "icon": "system",
        "lane": "a5425754-e784-4e84-88ba-c5547ba5d08f",
        "name": "Присваивание сотрудника",
        "type": "assignment",
        "color": "#fde9a0",
        "exits": ["97c0e5ec-d568-472d-b28c-5f51f68ec92d"],
        "width": 80,
        "height": 64,
        "settings": {
          "bindings": [
            {
              "source": {
                "kind": "context",
                "value": "staff.ext_user"
              },
              "target": {
                "kind": "context",
                "value": "staff_user"
              }
            }
          ]
        }
      }
    },
    "lanes": {
      "a5425754-e784-4e84-88ba-c5547ba5d08f": {
        "x": 8,
        "y": 8,
        "id": "a5425754-e784-4e84-88ba-c5547ba5d08f",
        "name": "Инициатор",
        "color": "#d6f0cc",
        "width": 224,
        "height": 448,
        "settings": {
          "type": "dynamic",
          "variable": "__createdBy",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      },
      "fbc819d4-d5a5-4037-9dbe-6e47887e8022": {
        "x": 232,
        "y": 8,
        "id": "fbc819d4-d5a5-4037-9dbe-6e47887e8022",
        "name": "Сотрудник",
        "color": "#d6f0cc",
        "width": 536,
        "height": 448,
        "settings": {
          "type": "dynamic",
          "groups": [null],
          "variable": "staff_user",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      }
    },
    "paper": {
      "format": "A4",
      "orientation": "landscape"
    },
    "transitions": {
      "1ed87ca1-d7dd-4839-b0f0-c941b41e72bf": {
        "id": "1ed87ca1-d7dd-4839-b0f0-c941b41e72bf",
        "name": "",
        "path": [
          {
            "x": 432,
            "y": 352
          },
          {
            "x": 432,
            "y": 392
          }
        ],
        "type": "plain",
        "source": "6567d7f7-9182-47ab-8a13-ca0dd1313e9f",
        "target": "51173eb9-150b-4b58-824d-62b2c0a9f0a4",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "57cff533-f94f-4926-af77-ed99960ac2ec": {
        "id": "57cff533-f94f-4926-af77-ed99960ac2ec",
        "name": "На ознакомление",
        "path": [
          {
            "x": 120,
            "y": 104
          },
          {
            "x": 120,
            "y": 184
          }
        ],
        "type": "plain",
        "source": "00000000-0000-0000-0000-000000000000",
        "target": "a1a2159d-7492-4093-9e98-4a6bccc2ed67",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "97c0e5ec-d568-472d-b28c-5f51f68ec92d": {
        "id": "97c0e5ec-d568-472d-b28c-5f51f68ec92d",
        "name": "",
        "path": [
          {
            "x": 160,
            "y": 216
          },
          {
            "x": 392,
            "y": 216
          }
        ],
        "type": "plain",
        "source": "a1a2159d-7492-4093-9e98-4a6bccc2ed67",
        "target": "547c97fc-b208-4a6a-bea0-d76e6238ad44",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "dff69ea5-3e57-48cb-a5f5-79e99e798001": {
        "id": "dff69ea5-3e57-48cb-a5f5-79e99e798001",
        "name": "Ознакомлен",
        "path": [
          {
            "x": 432,
            "y": 248
          },
          {
            "x": 432,
            "y": 288
          }
        ],
        "type": "default",
        "source": "547c97fc-b208-4a6a-bea0-d76e6238ad44",
        "target": "6567d7f7-9182-47ab-8a13-ca0dd1313e9f",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      }
    }
  },
  "scripts": "/**\nHere you can write scripts for complex server processing of the context during process execution.\nTo write scripts, use TypeScript (https://www.typescriptlang.org).\nELMA365 SDK documentation available on https://tssdk.elma365.com.\n**/\n\nasync function staffs_get(): Promise\u003cvoid\u003e {\n    const staff = await Context.data.staff!.fetch();\n    Context.data.staff_user = staff.data.ext_user;\n    let position: TApplication\u003cApplication$kedo$position$Data, Application$kedo$position$Params, Application$kedo$position$Processes\u003e | undefined;\n    position = Context.data.position ? Context.data.position : staff.data.position;\n    const documents_pull = await Context.fields.docs_lna.app.search()\n        .where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.positions_review.has(position!),\n            g.or(\n                f.__status.eq(Context.fields.docs_lna.app.fields.__status.variants.approved),\n                f.__status.eq(Context.fields.docs_lna.app.fields.__status.variants.current)\n            )\n        ))\n        .size(10000)\n        .all();\n    Context.data.all_docs_lna = documents_pull;\n    Context.data.docs_count = Context.data.all_docs_lna ? Context.data.all_docs_lna.length : 0;\n    Context.data.counter = 0;\n}\n\nasync function set_current_lna(): Promise\u003cboolean\u003e {\n    if (Context.data.all_docs_lna \u0026\u0026 Context.data.all_docs_lna.length \u003e 0) {\n        Context.data.docs_lna = Context.data.all_docs_lna[0];\n        Context.data.all_docs_lna.splice(0, 1);\n        return true\n    }\n    return false;\n}\n\nasync function get_doc(): Promise\u003cvoid\u003e {\n    const start = Context.data.counter;\n    const end = Context.data.counter! + 1;\n    Context.data.docs_lna = Context.data.all_docs_lna!.slice(start, end)[0];\n    Context.data.counter = end;\n    const app = await Context.data.docs_lna.fetch();\n    Context.data.review_date = new Datetime().addDate(0, 0, app.data.familiarize_days || 1)\n}\n\nasync function add_lna_doc(): Promise\u003cvoid\u003e {\n    if (Context.data.staff) {\n        const staff = await Context.data.staff!.fetch();\n        if (Context.data.docs_lna) {\n            if(staff.data.list_sign_lna) {\n                staff.data.list_sign_lna.push(Context.data.docs_lna)\n            } else {\n                staff.data.list_sign_lna = [];\n                staff.data.list_sign_lna.push(Context.data.docs_lna)\n            }\n            staff.data.list_sign_lna = staff.data.list_sign_lna\n            await staff.save();\n\n            const lna = await Context.data.docs_lna.fetch();\n            const row_list = lna.data.list_acquaintances!.insert();\n            row_list.staff = Context.data.staff;\n            row_list.date_review = new Datetime;\n            lna.data.list_acquaintances = lna.data.list_acquaintances;\n            await lna.save();\n        }\n    }\n}\n\nasync function addUserToGroup(): Promise\u003cvoid\u003e {\n    const user = await Context.data.staff_user!.fetch();\n    const staff = await Context.data.staff!.fetch();\n    const readPermission = [new PermissionValue(user, [PermissionType.READ, PermissionType.ASSIGN, PermissionType.UPDATE, PermissionType.CREATE])];\n    await staff.setPermissions(new Permissions(readPermission));\n    \n    let userIsHrOrAccounting = false;\n    if (staff.data.position \u0026\u0026 staff.data.organization) {\n        const organization = await staff.data.organization.fetch();\n        const hrPositions = organization.data.hr_department_positions ? organization.data.hr_department_positions.map(pos =\u003e pos.id) : undefined;\n        const accountingPositions = organization.data.accounting_positions ? organization.data.accounting_positions.map(pos =\u003e pos.id) : undefined;\n        if (hrPositions) {\n            const userIsHr = hrPositions.indexOf(staff.data.position.id) != -1;\n            if (userIsHr) {\n                const hrGroup = await System.userGroups.search().where((f, g) =\u003e g.and(\n                    f.__deletedAt.eq(null),\n                    f.code.eq(\"abdecf4b-b6ba-419f-bac7-c1455d2a6159\")\n                )).first();\n                if (hrGroup) {\n                    userIsHrOrAccounting = true;\n                    if (!organization.data.hr_department || organization.data.hr_department.length \u003c 1) {\n                        organization.data.hr_department = [staff]\n                    } else {\n                        organization.data.hr_department.push(staff)\n                    };\n                    await organization.save();\n                    await hrGroup.addItem(user);\n                    await hrGroup.save();\n                };\n            };\n        } else if (accountingPositions) {\n            const userIsAccounting = accountingPositions.indexOf(staff.data.position.id) != -1;\n            if (userIsAccounting) {\n                const accountingGroup = await System.userGroups.search().where((f, g) =\u003e g.and(\n                    f.__deletedAt.eq(null),\n                    f.code.eq(\"dfede5be-5011-4ec9-b535-8c9ca3fc4d19\")\n                )).first();\n                if (accountingGroup) {\n                    if (!organization.data.accounting || organization.data.accounting.length \u003c 1) {\n                        organization.data.accounting = [staff];\n                    } else {\n                        organization.data.accounting.push(staff);\n                    };\n                    userIsHrOrAccounting = true;\n                    await organization.save();\n                    await accountingGroup.addItem(user);\n                    await accountingGroup.save();\n                };\n            }\n        }\n    };\n    if (staff.data.organization \u0026\u0026 staff.data.ext_user \u0026\u0026 !userIsHrOrAccounting) {\n        const org = await staff.fields.organization.app.search().where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.__id.eq(staff.data.organization!.id)\n        )).first();\n        if (!org || !org.data.access_settings_organization) {\n            return;\n        };\n        const orgRights = await org.fields.access_settings_organization.app.search().where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.__id.eq(org.data.access_settings_organization!.id)\n        )).first();\n        if (staff.data.staff_access == false \u0026\u0026 orgRights) {\n            if (!orgRights.data.inner_org_users || orgRights.data.inner_org_users.length \u003c 1) {\n                return;\n            };\n            const group = await System.userGroups.search().where((f, g) =\u003e g.and(\n                f.__deletedAt.eq(null),\n                f.__id.eq(orgRights.data.inner_org_users![0].code)\n            )).first();\n            const innerUsersGroup = await System.userGroups.search().where((f, g) =\u003e g.and(\n                f.__deletedAt.eq(null),\n                f.code.eq(\"04df3ffc-9921-4854-abe1-59ec199212ae\")\n            )).first();\n            if (innerUsersGroup) {\n                await innerUsersGroup.addItem(staff.data.ext_user);\n                await innerUsersGroup.save()\n            };\n            if (group) {\n                await group.addItem(staff.data.ext_user);\n                await group.save();\n            }\n        } else {\n            if (!orgRights!.data.external_org_users || orgRights!.data.external_org_users.length \u003c 1) {\n                return;\n            };\n            const extUsersGroup = await System.userGroups.search().where((f, g) =\u003e g.and(\n                f.__deletedAt.eq(null),\n                f.code.eq(\"e50cb6cb-ea63-4d4e-8585-eb234a070256\")\n            )).first();\n            if (extUsersGroup) {\n                await extUsersGroup.addItem(staff.data.ext_user);\n                await extUsersGroup.save()\n            };\n            const group = await System.userGroups.search().where((f, g) =\u003e g.and(\n                f.__deletedAt.eq(null),\n                f.__id.eq(orgRights!.data.external_org_users![0].code)\n            )).first();\n            if (group) {\n                await group.addItem(staff.data.ext_user);\n                await group.save();\n            };\n        };\n    };\n};\n",
  "forms": [
    {
      "id": "",
      "code": "form_0bac81c2-20c3-43d2-bac8-d2bf3d0083d2",
      "name": "Ознакомление с ЛНА",
      "values": {
        "formType": "docflow-task-form",
        "formGroup": {
          "path": ["context"]
        }
      },
      "widget": {
        "draft": false,
        "deleted": false,
        "version": 1
      },
      "content": {
        "[footer]": [
          {
            "id": "31979bac-00bd-4123-a901-9d14190c8dde",
            "values": {
              "buttons": {
                "path": ["actionButtons"]
              }
            },
            "content": null,
            "descriptor": "buttons-panel",
            "descriptorVersion": null
          }
        ],
        "[content]": [
          {
            "id": "c18e9118-cda2-49f4-ae50-5414c9b970b2",
            "values": {
              "shadow": true
            },
            "content": {
              "": [
                {
                  "id": "dcdd3e4e-0c49-483b-87c2-8c782a8890f0",
                  "values": {
                    "form": {
                      "path": ["context"]
                    },
                    "fields": {
                      "path": ["fields"]
                    }
                  },
                  "content": null,
                  "descriptor": "dynamic-form",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "modal-body",
            "descriptorVersion": null
          }
        ],
        "[sidebar]": [
          {
            "id": "39d7757a-529f-4526-98f3-fddc66becf85",
            "values": null,
            "content": {
              "": [
                {
                  "id": "abe4b782-6e2d-49cc-a57e-81b636422ee5",
                  "values": {
                    "context": {
                      "path": ["context"]
                    }
                  },
                  "content": null,
                  "descriptor": "target-widget",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          },
          {
            "id": "231b371a-64ae-4b61-8014-cba6da318ac9",
            "values": null,
            "content": {
              "": [
                {
                  "id": "5e39b91d-aea4-467e-862f-0f8766eb44df",
                  "values": {
                    "context": {
                      "path": ["context"]
                    }
                  },
                  "content": null,
                  "descriptor": "linked-item",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          },
          {
            "id": "a4469de0-d7f3-11ec-9d64-0242ac120002",
            "values": null,
            "content": {
              "": [
                {
                  "id": "3ead7c41-6dfa-4144-80da-2bfb5f0ccf59",
                  "values": {
                    "formGroup": {
                      "path": ["context"]
                    }
                  },
                  "content": null,
                  "descriptor": "item-reminder",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          },
          {
            "id": "56d1d0e8-aa83-4cdd-ae43-294b26ad4d04",
            "values": null,
            "content": {
              "": [
                {
                  "id": "e1525e34-14ba-456b-b703-f407945c01e0",
                  "values": {
                    "formGroup": {
                      "path": ["context"]
                    }
                  },
                  "content": null,
                  "descriptor": "item-tasks",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          },
          {
            "id": "eef018f2-1d3a-4600-a19d-791733b28b5e",
            "values": null,
            "content": {
              "": [
                {
                  "id": "e0a17dec-603a-461a-becf-861637630584",
                  "values": {
                    "target": {
                      "path": ["target"]
                    }
                  },
                  "content": null,
                  "descriptor": "messages-target",
                  "descriptorVersion": null
                }
              ]
            },
            "descriptor": "sidebar-widget",
            "descriptorVersion": null
          }
        ],
        "[formInfoPanel]": [
          {
            "id": "d40a31e8-6f70-4063-aaf5-d9f7bf448092",
            "values": {
              "__validateResult": {
                "path": ["context", "__validateResult"]
              }
            },
            "content": null,
            "descriptor": "validation-info-block",
            "descriptorVersion": null
          }
        ],
        "[headerControls]": [
          {
            "id": "475aa008-aaff-402f-8de2-408bae1f1928",
            "values": {
              "task": {
                "path": ["task"]
              }
            },
            "content": null,
            "descriptor": "task-percent-widget",
            "descriptorVersion": null
          },
          {
            "id": "702d9c59-77ae-4dd5-b71a-a5fe7b58858f",
            "values": {
              "item": {
                "path": ["__itemRef"]
              }
            },
            "content": null,
            "descriptor": "extension-zone-toolbar-widget",
            "descriptorVersion": null
          },
          {
            "id": "f7b11c79-4267-4f5b-a002-dd629d549682",
            "values": {
              "task": {
                "path": ["task"]
              },
              "skipRulesCheck": true
            },
            "content": null,
            "descriptor": "process-item-map",
            "descriptorVersion": null
          },
          {
            "id": "ff2500ee-6573-49cd-a9e8-2d5c93350f26",
            "values": {
              "icon": "menu_vertical",
              "view": "icon",
              "label": "bpm.tasks.item@menu",
              "action": {
                "path": ["menuAction"]
              }
            },
            "content": null,
            "descriptor": "button",
            "descriptorVersion": null
          }
        ],
        "[headerCustomization]": []
      },
      "descriptor": "item-form-complex-popup",
      "descriptorVersion": 2
    }
  ],
  "settings": {
    "logged": true,
    "debugForm": {
      "allFields": false,
      "formFields": []
    },
    "targetFeed": {
      "type": "object",
      "variable": "docs_lna"
    },
    "allowGlobal": false,
    "instanceCard": {
      "allFields": true,
      "formFields": []
    },
    "notifyOnStart": true,
    "allowNamespace": false,
    "applicationContext": false,
    "importsDependencies": [],
    "fieldVisibilityConditions": {
      "link": {
        "enabled": false,
        "conditions": []
      },
      "staff": {
        "enabled": false,
        "conditions": []
      },
      "counter": {
        "enabled": false,
        "conditions": []
      },
      "docs_lna": {
        "enabled": false,
        "conditions": []
      },
      "position": {
        "enabled": false,
        "conditions": []
      },
      "docs_count": {
        "enabled": false,
        "conditions": []
      },
      "staff_user": {
        "enabled": false,
        "conditions": []
      },
      "review_date": {
        "enabled": false,
        "conditions": []
      },
      "all_docs_lna": {
        "enabled": false,
        "conditions": []
      },
      "personal_data_employee": {
        "enabled": false,
        "conditions": []
      }
    }
  },
  "hideInList": false,
  "applicationLink": false,
  "__deletedAt": null
}
