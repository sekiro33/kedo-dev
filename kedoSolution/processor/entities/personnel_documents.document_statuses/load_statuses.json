{
  "__id": "018c8757-193d-7f13-a904-2a1b66fd7900",
  "namespace": "personnel_documents.document_statuses",
  "code": "load_statuses",
  "category": "00000000-0000-0000-0000-000000000000",
  "__name": "old_Загрузить статусы",
  "type": "bpmn",
  "draft": false,
  "version": 3,
  "context": [
    {
      "code": "url",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "URL",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "error",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ошибка",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "response",
      "type": "STRING",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": false,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {},
      "view": {
        "name": "Ответ",
        "data": {
          "additionalType": "string"
        }
      }
    },
    {
      "code": "document_statuses",
      "type": "SYS_COLLECTION",
      "searchable": false,
      "indexed": false,
      "deleted": false,
      "array": true,
      "required": false,
      "single": true,
      "defaultValue": null,
      "calcByFormula": false,
      "formula": "",
      "data": {
        "code": "document_statuses",
        "filter": null,
        "bindings": null,
        "namespace": "personnel_documents",
        "isDependent": false,
        "linkedFieldCode": ""
      },
      "view": {
        "name": "Статусы документов"
      }
    }
  ],
  "manualRun": false,
  "readonly": false,
  "__createdAt": "2022-11-01T11:41:32.727678226Z",
  "__createdBy": "b3904ee1-c631-4888-88ee-3922dc2fcbea",
  "__updatedAt": "2022-11-02T06:57:55.137964705Z",
  "__updatedBy": "7303b866-4220-4086-a09e-348a76b12c73",
  "process": {
    "items": {
      "00000000-0000-0000-0000-000000000000": {
        "x": 104,
        "y": 72,
        "id": "00000000-0000-0000-0000-000000000000",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "type": "start",
        "color": "#ffffff",
        "exits": ["450583a0-62ec-4801-b824-3ba1f47dbe47"],
        "width": 32,
        "height": 32,
        "settings": {
          "formFields": [
            {
              "code": "__name",
              "display": "Название",
              "tooltip": "Название экземпляра процесса, будет показываться в задачах",
              "readonly": false,
              "required": true
            }
          ],
          "instruction": "",
          "notifyMessage": "Запущен процесс",
          "titleTemplate": "Загрузить статусы ({$document_statuses})",
          "titleGenerateMethod": "template"
        }
      },
      "195410dd-3131-4b80-b46a-dcc2ba8899c0": {
        "x": 304,
        "y": 152,
        "id": "195410dd-3131-4b80-b46a-dcc2ba8899c0",
        "icon": "user",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "Ознакомиться с ошибкой",
        "type": "user",
        "color": "#daeef7",
        "exits": ["335f6527-78b9-4e90-adf2-d640f75e6544"],
        "width": 80,
        "height": 64,
        "settings": {
          "name": "",
          "notify": true,
          "escalation": {
            "byTime": {
              "limit": {
                "days": 0,
                "kind": "duration",
                "hours": 0,
                "minutes": 0,
                "absolute": false
              },
              "action": {
                "notify": false,
                "interrupt": false,
                "receivers": []
              },
              "enabled": false
            }
          },
          "formFields": [
            {
              "code": "__createdBy",
              "tooltip": "",
              "readonly": false,
              "required": false,
              "hideEmpty": false
            },
            {
              "code": "url",
              "tooltip": "",
              "readonly": false,
              "required": false,
              "hideEmpty": false
            },
            {
              "code": "error",
              "tooltip": "",
              "readonly": false,
              "required": false,
              "hideEmpty": false
            },
            {
              "code": "response",
              "tooltip": "",
              "readonly": false,
              "required": false,
              "hideEmpty": false
            }
          ],
          "allowReassign": true,
          "planDatesSettings": {
            "enabled": false,
            "planCodes": {
              "endCode": "",
              "startCode": ""
            }
          }
        }
      },
      "24519223-4e57-41cf-981b-3445ed181fde": {
        "x": 616,
        "y": 280,
        "id": "24519223-4e57-41cf-981b-3445ed181fde",
        "icon": "end",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "",
        "type": "end",
        "color": "#ffffff",
        "exits": [],
        "width": 32,
        "height": 32,
        "settings": {
          "actions": [],
          "isModal": false,
          "actionType": "nothing",
          "messageText": "",
          "redirectUrl": ""
        }
      },
      "46bd43d5-376e-4011-ab1e-b58855885d8a": {
        "x": 80,
        "y": 152,
        "id": "46bd43d5-376e-4011-ab1e-b58855885d8a",
        "icon": "script",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "Заполнить данный запроса",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["0f65a30f-5e70-4ddd-96b4-356385bfa75a"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "fillRequestData",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      },
      "8b5def33-6e83-410b-b62d-7396807ee9ee": {
        "x": 328,
        "y": 280,
        "id": "8b5def33-6e83-410b-b62d-7396807ee9ee",
        "icon": "exclusive",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "",
        "type": "gateway",
        "color": "#ffffff",
        "exits": [
          "0969d332-a310-4ce8-8645-41fdfe8f6716",
          "1705519d-2a4b-4cbf-b61c-7195633b7f25"
        ],
        "width": 32,
        "height": 32,
        "settings": {
          "func": "",
          "type": "exclusive",
          "useFunc": false,
          "funcType": "STRING",
          "description": ""
        }
      },
      "8e1aed4d-7c6d-4d3b-ae97-43eebb4c2066": {
        "x": 80,
        "y": 264,
        "id": "8e1aed4d-7c6d-4d3b-ae97-43eebb4c2066",
        "icon": "system",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "Запрос в 1С 1",
        "type": "ca",
        "color": "#fde9a0",
        "exits": [
          "f42078b9-afef-42eb-b0e3-164d7727debf",
          "c88189ee-fb55-469a-8169-ff3c66344c87"
        ],
        "width": 80,
        "height": 64,
        "settings": {
          "code": "request_in_1c",
          "name": "",
          "input": [
            {
              "source": {
                "kind": "context",
                "value": "url"
              },
              "target": {
                "kind": "context",
                "value": "request_parameters"
              }
            },
            {
              "target": {
                "kind": "context",
                "value": "request_body"
              }
            },
            {
              "target": {
                "kind": "context",
                "value": "request_type_string"
              }
            }
          ],
          "output": [
            {
              "source": {
                "kind": "context",
                "value": "error"
              },
              "target": {
                "kind": "context",
                "value": "error"
              }
            },
            {
              "source": {
                "kind": "context",
                "value": "response"
              },
              "target": {
                "kind": "context",
                "value": "response_1c_json"
              }
            }
          ],
          "namespace": "ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed",
          "escalation": {
            "byTime": {
              "limit": {
                "days": 0,
                "kind": "duration",
                "hours": 0,
                "minutes": 0,
                "absolute": false
              },
              "action": {
                "notify": false,
                "interrupt": false,
                "receivers": []
              },
              "enabled": false
            },
            "byError": {
              "exit": "c88189ee-fb55-469a-8169-ff3c66344c87",
              "notify": true,
              "interrupt": true,
              "receivers": [
                {
                  "kind": "current"
                }
              ]
            }
          },
          "bindingForm": {
            "fieldValues": {}
          },
          "targetAppCode": "",
          "dynamicBinding": {}
        }
      },
      "cbf18851-ffac-45f6-ba14-32bbfd7da365": {
        "x": 496,
        "y": 264,
        "id": "cbf18851-ffac-45f6-ba14-32bbfd7da365",
        "icon": "script",
        "lane": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "Обновить данные статусов",
        "type": "script",
        "color": "#fde9a0",
        "exits": ["4dc49edd-c8c9-4b64-8f76-ce298475b158"],
        "width": 80,
        "height": 64,
        "settings": {
          "func": "updateStatusData",
          "count": 1,
          "delay": 5,
          "retry": true,
          "escalation": {
            "byError": {
              "notify": false,
              "interrupt": false,
              "receivers": []
            }
          }
        }
      }
    },
    "lanes": {
      "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6": {
        "x": 8,
        "y": 8,
        "id": "3c04dc7d-8b76-45bd-a6a8-45d07e14ead6",
        "name": "Инициатор",
        "color": "#d6f0cc",
        "width": 704,
        "height": 600,
        "settings": {
          "type": "dynamic",
          "variable": "__createdBy",
          "permissionExtend": {
            "kind": "simple"
          }
        },
        "direction": "vertical",
        "multiInstance": false
      }
    },
    "paper": {
      "format": "A4",
      "orientation": "landscape"
    },
    "transitions": {
      "0969d332-a310-4ce8-8645-41fdfe8f6716": {
        "id": "0969d332-a310-4ce8-8645-41fdfe8f6716",
        "name": "",
        "path": [
          {
            "x": 344,
            "y": 280
          },
          {
            "x": 344,
            "y": 216
          }
        ],
        "type": "plain",
        "source": "8b5def33-6e83-410b-b62d-7396807ee9ee",
        "target": "195410dd-3131-4b80-b46a-dcc2ba8899c0",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [
            {
              "a": {
                "kind": "context",
                "value": "error"
              },
              "type": "STRING",
              "inversion": false,
              "operation": {
                "relation": "empty",
                "inversion": true,
                "caseInsensitive": false
              },
              "conjunction": false
            }
          ],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "0f65a30f-5e70-4ddd-96b4-356385bfa75a": {
        "id": "0f65a30f-5e70-4ddd-96b4-356385bfa75a",
        "name": "",
        "path": [
          {
            "x": 120,
            "y": 216
          },
          {
            "x": 120,
            "y": 264
          }
        ],
        "type": "plain",
        "source": "46bd43d5-376e-4011-ab1e-b58855885d8a",
        "target": "8e1aed4d-7c6d-4d3b-ae97-43eebb4c2066",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "1705519d-2a4b-4cbf-b61c-7195633b7f25": {
        "id": "1705519d-2a4b-4cbf-b61c-7195633b7f25",
        "name": "",
        "path": [
          {
            "x": 360,
            "y": 296
          },
          {
            "x": 496,
            "y": 296
          }
        ],
        "type": "default",
        "source": "8b5def33-6e83-410b-b62d-7396807ee9ee",
        "target": "cbf18851-ffac-45f6-ba14-32bbfd7da365",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "335f6527-78b9-4e90-adf2-d640f75e6544": {
        "id": "335f6527-78b9-4e90-adf2-d640f75e6544",
        "name": "",
        "path": [
          {
            "x": 384,
            "y": 184
          },
          {
            "x": 632,
            "y": 184
          },
          {
            "x": 632,
            "y": 280
          }
        ],
        "type": "plain",
        "source": "195410dd-3131-4b80-b46a-dcc2ba8899c0",
        "target": "24519223-4e57-41cf-981b-3445ed181fde",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "450583a0-62ec-4801-b824-3ba1f47dbe47": {
        "id": "450583a0-62ec-4801-b824-3ba1f47dbe47",
        "name": "",
        "path": [
          {
            "x": 120,
            "y": 104
          },
          {
            "x": 120,
            "y": 152
          }
        ],
        "type": "plain",
        "source": "00000000-0000-0000-0000-000000000000",
        "target": "46bd43d5-376e-4011-ab1e-b58855885d8a",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "4dc49edd-c8c9-4b64-8f76-ce298475b158": {
        "id": "4dc49edd-c8c9-4b64-8f76-ce298475b158",
        "name": "",
        "path": [
          {
            "x": 576,
            "y": 296
          },
          {
            "x": 616,
            "y": 296
          }
        ],
        "type": "plain",
        "source": "cbf18851-ffac-45f6-ba14-32bbfd7da365",
        "target": "24519223-4e57-41cf-981b-3445ed181fde",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "c88189ee-fb55-469a-8169-ff3c66344c87": {
        "id": "c88189ee-fb55-469a-8169-ff3c66344c87",
        "name": "",
        "path": [
          {
            "x": 160,
            "y": 280
          },
          {
            "x": 244,
            "y": 280
          },
          {
            "x": 244,
            "y": 184
          },
          {
            "x": 304,
            "y": 184
          }
        ],
        "type": "error",
        "source": "8e1aed4d-7c6d-4d3b-ae97-43eebb4c2066",
        "target": "195410dd-3131-4b80-b46a-dcc2ba8899c0",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      },
      "f42078b9-afef-42eb-b0e3-164d7727debf": {
        "id": "f42078b9-afef-42eb-b0e3-164d7727debf",
        "name": "",
        "path": [
          {
            "x": 160,
            "y": 296
          },
          {
            "x": 328,
            "y": 296
          }
        ],
        "type": "plain",
        "source": "8e1aed4d-7c6d-4d3b-ae97-43eebb4c2066",
        "target": "8b5def33-6e83-410b-b62d-7396807ee9ee",
        "settings": {
          "exit": {
            "confirm": "none",
            "interrupt": false,
            "skipCheck": false,
            "formFields": [],
            "buttonClass": "default",
            "confirmText": "",
            "popoverSize": "md",
            "formDescription": ""
          },
          "conditions": [],
          "descritpion": ""
        },
        "nameShift": 0
      }
    }
  },
  "scripts": "/**\nHere you can write scripts for complex server processing of the context during process execution.\nTo write scripts, use TypeScript (https://www.typescriptlang.org).\nELMA365 SDK documentation available on https://tssdk.elma365.com.\n**/\n\nasync function fillRequestData(): Promise\u003cvoid\u003e {\n    Context.data.url = \"Catalog_EM_СтатусыELMA?$format=json\";\n}\n\n\nasync function updateStatusData(): Promise\u003cvoid\u003e {\n    const response = JSON.parse(Context.data.response!);\n\n    const prevStatuses = await Context.fields.document_statuses.fetchAll();\n    const deletePromises: any[] = [];\n    prevStatuses.forEach(async (status:any) =\u003e deletePromises.push(status.delete()));\n\n    const savePromises: any[] = []\n    response.value.forEach((status: any) =\u003e {\n        const newApp = Context.fields.document_statuses.app.create();\n        newApp.data.__name = status[\"Description\"];\n        newApp.data.full_name = status[\"ИмяДляРазработчика\"];\n        newApp.data.is_blocking = status[\"БлокироватьДокумент\"];\n        newApp.data.guid = status[\"Ref_Key\"]\n        savePromises.push(newApp.save())\n    })\n\n    await Promise.all([...savePromises, ...deletePromises])\n}\n",
  "forms": [],
  "settings": {
    "logged": true,
    "targetFeed": {
      "type": "object",
      "variable": "document_statuses"
    },
    "allowGlobal": false,
    "instanceCard": {
      "allFields": true,
      "formFields": []
    },
    "notifyOnStart": true,
    "allowNamespace": false,
    "applicationContext": false,
    "fieldVisibilityConditions": {
      "url": {
        "enabled": false,
        "conditions": []
      },
      "error": {
        "enabled": false,
        "conditions": []
      },
      "response": {
        "enabled": false,
        "conditions": []
      }
    }
  },
  "hideInList": false,
  "applicationLink": false,
  "__deletedAt": null
}
