{"scripts":"async function migrationPositions() {\n    var _a, _b, _c;\n    if (!Context.data.offset_iterations) {\n        Context.data.offset_iterations = 0;\n    }\n    const size_iterations = 5;\n    let searchElementsPosition = await Context.fields.position.app.search().where(f =\u003e f.__deletedAt.eq(null)).sort(\"__createdAt\", true).size(5).from(Context.data.offset_iterations).all();\n    if (!Context.data.count) {\n        Context.data.count = 0;\n    }\n    if (searchElementsPosition) {\n        Context.data.count += searchElementsPosition.length;\n        for (let element of searchElementsPosition) {\n            if (element.data.staff \u0026\u0026 element.data.staff.length \u003e 0) {\n                const old_staff_array = (_a = element.data.old_staff) !== null \u0026\u0026 _a !== void 0 ? _a : [];\n                const staff_array = element.data.staff;\n                const staff_length = staff_array.length;\n                for (let index = 0; index \u003c staff_length; index++) {\n                    const staff = await staff_array[index].fetch();\n                    const staff_status_code = staff.data.__status.code;\n                    Context.data.debug += staff_status_code + ' статус полученного сотрудника(основное место работы) \\n';\n                    if (staff_status_code == \"dismissed\") {\n                        old_staff_array.push(staff_array[index]);\n                        staff_array.splice(index, 1);\n                    }\n                }\n                element.data.staff = staff_array;\n                element.data.old_staff = old_staff_array;\n                await element.save();\n            }\n            if (element.data.staff_external_combination \u0026\u0026 element.data.staff_external_combination.length \u003e 0) {\n                const old_staff_array = (_b = element.data.old_staff_external_combination) !== null \u0026\u0026 _b !== void 0 ? _b : [];\n                const staff_array = element.data.staff_external_combination;\n                const staff_length = staff_array.length;\n                for (let index = 0; index \u003c staff_length; index++) {\n                    const staff = await staff_array[index].fetch();\n                    const staff_status_code = staff.data.__status.code;\n                    Context.data.debug += staff_status_code + ' статус полученного сотрудника(основное место работы) \\n';\n                    if (staff_status_code == \"dismissed\") {\n                        old_staff_array.push(staff_array[index]);\n                        staff_array.splice(index, 1);\n                    }\n                }\n                element.data.staff_external_combination = staff_array;\n                element.data.old_staff_external_combination = old_staff_array;\n                await element.save();\n            }\n            if (element.data.staff_internal_combination \u0026\u0026 element.data.staff_internal_combination.length \u003e 0) {\n                const old_staff_array = (_c = element.data.old_staff_internal_combination) !== null \u0026\u0026 _c !== void 0 ? _c : [];\n                const staff_array = element.data.staff_internal_combination;\n                const staff_length = staff_array.length;\n                for (let index = 0; index \u003c staff_length; index++) {\n                    const staff = await staff_array[index].fetch();\n                    const staff_status_code = staff.data.__status.code;\n                    Context.data.debug += staff_status_code + ' статус полученного сотрудника(основное место работы) \\n';\n                    if (staff_status_code == \"dismissed\") {\n                        old_staff_array.push(staff_array[index]);\n                        staff_array.splice(index, 1);\n                    }\n                }\n                element.data.staff_internal_combination = staff_array;\n                element.data.old_staff_internal_combination = old_staff_array;\n                await element.save();\n            }\n        }\n    }\n    if (searchElementsPosition.length \u003c size_iterations) {\n        Context.data.end_processing = true;\n    }\n    else {\n        Context.data.offset_iterations += 5;\n    }\n}\n","gatewayPairs":{},"hasTranslations":false}
