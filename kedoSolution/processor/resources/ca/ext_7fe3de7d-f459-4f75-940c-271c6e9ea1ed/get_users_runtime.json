{
  "scripts": "async function action() {\n    var _a, _b, _c;\n    let error = '';\n    const refItem = new RefItem('kedo', 'organization', Context.data.organization.id);\n    const organiaztion = await refItem.fetch();\n    const staffs = await Namespace.params.fields.employee_app.app.search()\n        .where((f, g) => g.and(f.__deletedAt.eq(null)))\n        .size(10000)\n        .all();\n    if (organiaztion.data.hr_department && organiaztion.data.hr_department.length > 0) {\n        for (const item of organiaztion.data.hr_department) {\n            const staff = staffs.find(f => f.id == item.id);\n            if (staff && staff.data.__status && staff.data.__status.code == staff.fields.__status.variants.signed_documents.code) {\n                Context.data.hr_dep = (Context.data.hr_dep || []).concat(staff.data.ext_user);\n            }\n        }\n        if (!Context.data.hr_dep || Context.data.hr_dep.length == 0)\n            error = error + `Нет трудоустроенных сотруднииков в свойстве \"Отдел кадров\" организации ${organiaztion.data.__name}` + ' || ';\n    }\n    else {\n        error = error + `Не заполнено свойство \"Отдел кадров\" в организации ${organiaztion.data.__name}` + ' || ';\n    }\n    if (organiaztion.data.accounting && organiaztion.data.accounting.length > 0) {\n        for (const item of organiaztion.data.accounting) {\n            const staff = staffs.find(f => f.id == item.id);\n            if (staff && staff.data.__status && staff.data.__status.code == staff.fields.__status.variants.signed_documents.code) {\n                Context.data.accounting = (Context.data.accounting || []).concat(staff.data.ext_user);\n            }\n        }\n        if (!Context.data.accounting || Context.data.accounting.length == 0)\n            error = error + `Нет трудоустроенных сотруднииков в свойстве \"Бухгалтерия\" организации ${organiaztion.data.__name}` + ' || ';\n    }\n    else {\n        error = error + `Не заполнено свойство \"Бухгалтерия\" в организации ${organiaztion.data.__name}` + ' || ';\n    }\n    if (organiaztion.data.signatories && organiaztion.data.signatories.length > 0) {\n        for (const item of organiaztion.data.signatories) {\n            const staff = staffs.find(f => f.id == item.id);\n            if (staff && staff.data.__status && staff.data.__status.code == staff.fields.__status.variants.signed_documents.code) {\n                Context.data.signatories = (Context.data.signatories || []).concat(staff.data.ext_user);\n            }\n        }\n        if (!Context.data.signatories || Context.data.signatories.length == 0)\n            error = error + `Нет трудоустроенных сотруднииков в свойстве \"Подписанты\" организации ${organiaztion.data.__name}` + ' || ';\n    }\n    else {\n        error = error + `Не заполнено свойство \"Подписанты\" в организации ${organiaztion.data.__name}` + ' || ';\n    }\n    if (organiaztion.data.office_managers && organiaztion.data.office_managers.length > 0) {\n        for (const item of organiaztion.data.office_managers) {\n            const staff = staffs.find(f => f.id == item.id);\n            if (staff && staff.data.__status && staff.data.__status.code == staff.fields.__status.variants.signed_documents.code) {\n                Context.data.office_managers = (Context.data.office_managers || []).concat(staff.data.ext_user);\n            }\n        }\n        if (!Context.data.office_managers || Context.data.office_managers.length == 0)\n            error = error + `Нет трудоустроенных сотруднииков в свойстве \"Офис менеджеры\" организации ${organiaztion.data.__name}` + ' || ';\n    }\n    else {\n        error = error + `Не заполнено свойство \"Офис менеджеры\" в организации ${organiaztion.data.__name}` + ' || ';\n    }\n    if (organiaztion.data.matching_finance && organiaztion.data.matching_finance.length > 0) {\n        for (const item of organiaztion.data.matching_finance) {\n            const staff = staffs.find(f => f.id == item.id);\n            if (staff && staff.data.__status && staff.data.__status.code == staff.fields.__status.variants.signed_documents.code) {\n                Context.data.matching_finance = (Context.data.matching_finance || []).concat(staff.data.ext_user);\n            }\n        }\n        if (!Context.data.matching_finance || Context.data.matching_finance.length == 0)\n            error = error + `Нет трудоустроенных сотруднииков в свойстве \"Ответственные за финансы\" организации ${organiaztion.data.__name}` + ' || ';\n    }\n    else {\n        error = error + `Не заполнено свойство \"Ответственные за финансы\" в организации ${organiaztion.data.__name}` + ' || ';\n    }\n    if (organiaztion.data.position_head) {\n        const position_head = await organiaztion.data.position_head.fetch();\n        const head_staffs_app = [\n            ...((_a = position_head.data.staff) !== null && _a !== void 0 ? _a : []),\n            ...((_b = position_head.data.staff_internal_combination) !== null && _b !== void 0 ? _b : []),\n            ...((_c = position_head.data.staff_external_combination) !== null && _c !== void 0 ? _c : []),\n        ];\n        const head_staffs_ids = head_staffs_app.map(s => s.id);\n        if (head_staffs_ids.length > 0) {\n            const head_staffs = await organiaztion.fields.position_head.app.fields.staff.app.search()\n                .where((f, g) => g.and(f.__deletedAt.eq(null), f.__id.in(head_staffs_ids)))\n                .size(head_staffs_ids.length)\n                .all();\n            for (const item of head_staffs) {\n                const staff = head_staffs.find(f => f.id == item.id);\n                if (staff && staff.data.__status && staff.data.__status.code == staff.fields.__status.variants.signed_documents.code) {\n                    Context.data.boss = staff.data.ext_user;\n                    break;\n                }\n            }\n        }\n        else {\n            error = error + `Нет сотруднииков, назначенных на должность в свойстве \"Руководитель организации\" организации ${organiaztion.data.__name}` + ' || ';\n        }\n        if (!Context.data.boss)\n            error = error + `Нет трудоустроенных сотруднииков в свойстве \"Руководитель организации\" организации ${organiaztion.data.__name}` + ' || ';\n    }\n    else {\n        error = error + `Не заполнено свойство \"Руководитель организации\" в организации ${organiaztion.data.__name}` + ' || ';\n    }\n    Context.data.error = error;\n}\n(async function () {\n    action();\n});\n",
  "execution": [
    {
      "code": "sync",
      "name": "Синхронное"
    }
  ],
  "allowGlobal": false,
  "checkInterval": ""
}
