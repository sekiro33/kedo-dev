{
  "scripts": "let baseUrl;\nlet login;\nlet password;\nlet myHeaders;\nfunction getConnectionInfo() {\n    const connectionsArray = Namespace.params.data.list_of_connected_platforms ? JSON.parse(Namespace.params.data.list_of_connected_platforms) : undefined;\n    if (!connectionsArray) {\n        return new Error(`Не найдено записей подключения`);\n    }\n    const currentConnection = connectionsArray.length > 1 ? connectionsArray.find((item) => {\n        return item.name === Context.data.connection_name;\n    }) : connectionsArray[0];\n    if (!currentConnection) {\n        return new Error(`Не найдено подключение c именем ${Context.data.connection_name}`);\n    }\n    baseUrl = currentConnection.url;\n    login = currentConnection.login;\n    password = currentConnection.password;\n    myHeaders = {\n        Authorization: `Basic ${btoa(login + ':' + password)}`,\n    };\n    return null;\n}\nasync function action() {\n    const error = getConnectionInfo();\n    if (error != null) {\n        Context.data.error = error.message;\n        return;\n    }\n    const requestOptions = {\n        method: 'GET',\n        headers: myHeaders,\n    };\n    const resUrl = `${baseUrl}/Document_ГрафикОтпусков?$format=json`;\n    try {\n        const response = await fetch(`${encodeURI(resUrl)}`, requestOptions);\n        if (!response.ok) {\n            const responseText = await response.text();\n            Context.data.error += ` staff data res.status error; resUrl - ${resUrl} `;\n            throw new Error(`status ${response.status} res error ${resUrl}, err text ${responseText}`);\n        }\n        const parsedResponse = await response.json();\n        const vacationsArray = parsedResponse.value;\n        const lastElement = vacationsArray[vacationsArray.length - 1];\n        Context.data.response = JSON.stringify(vacationsArray);\n        Context.data.last_vacation_schedule = lastElement;\n    }\n    catch (err) {\n        Context.data.error += ` try/catch error ${err}; resUrl - ${resUrl} `;\n        throw new Error(err.message);\n    }\n}\n(async function () {\n    action();\n});\n",
  "execution": [
    {
      "code": "sync",
      "name": "Синхронное"
    }
  ],
  "allowGlobal": false,
  "checkInterval": ""
}
