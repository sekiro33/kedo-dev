{"scripts":"async function setOrderStatus(status_code) {\n    if (!Context.data.decree) {\n        throw new Error(\"Context.data.decree is undefined\");\n    }\n    const order = await Context.data.decree.fetch();\n    const order_statuses = order.fields.__status.all;\n    const status = order_statuses.find((i) =\u003e i.code == status_code);\n    if (!status) {\n        throw new Error(`status with code ${status_code} not found`);\n    }\n    await order.setStatus(status);\n    order.data.line_status = `${order.data.__status.code};${order.data.__status.name}`;\n    await order.save();\n}\nasync function status_signing() {\n    await setOrderStatus('signing');\n}\nasync function status_signed() {\n    await setOrderStatus('signed');\n}\nasync function status_rejected() {\n    await setOrderStatus('rejected');\n}\nasync function generateAlertBody() {\n    if (!Context.data.decree) {\n        throw new Error(\"Context.data.decree is undefined\");\n    }\n    const order = await Context.data.decree.fetch();\n    Context.data.alert_body = `Подготовлен ${order.data.__name}. Подпишите его электронной подписью на портале КЭДО`;\n}\nasync function setXmlFile() {\n    if (!Context.data.decree) {\n        throw new Error(\"Context.data.decree is undefined\");\n    }\n    const order = await Context.data.decree.fetch();\n    order.data.xml_file = Context.data.xml_file;\n    await order.save();\n}\nasync function getSigners() {\n    var _a, _b;\n    const kedo_settings = await Context.fields.kedo_settings.app.search()\n        .where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.code.eq('head_signing_notification')))\n        .first();\n    Context.data.head_signing_notification = kedo_settings ? kedo_settings.data.status : false;\n    const staff = await ((_a = Context.data.staff) === null || _a === void 0 ? void 0 : _a.fetch());\n    const organization_staff = await ((_b = staff === null || staff === void 0 ? void 0 : staff.data.organization) === null || _b === void 0 ? void 0 : _b.fetch());\n    Context.data.signers_app = organization_staff === null || organization_staff === void 0 ? void 0 : organization_staff.data.signatories;\n    if (Context.data.decree) {\n        const ref = new RefItem(Context.data.decree.namespace, Context.data.decree.code, Context.data.decree.id);\n        Context.data.personnel_documents = await Context.fields.personnel_documents.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.__sourceRef.eq(ref))).first();\n    }\n}\n","gatewayPairs":{},"hasTranslations":false}
