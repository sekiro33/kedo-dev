{"__id":"018c8758-5b62-7f30-9bf6-399757cd8329","namespace":"ext_7fe3de7d-f459-4f75-940c-271c6e9ea1ed","code":"converting_dates","__name":"–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞—Ç –≤ —Å—Ç—Ä–æ–∫—É","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":3,"hidden":false,"draft":false,"readonly":false,"descriptor":{"template":{"id":"1e31d127-aa10-4166-be40-d579abbeab50","descriptor":"component","values":{"systemFunctions":{"onInit":{"kind":"Function","name":"onInit","type":"client"}}},"content":{"":[{"id":"1da49ecb-9d18-4f5d-be01-76e37a7745cb","descriptor":"label","values":{"__isConstValues":[],"text":"üéÉ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞—Ç"}},{"id":"197ea1a9-c2cb-4af4-af17-68843274a3ae","descriptor":"dynamic-form-row","values":{"__isConstValues":[],"showDisplayName":true,"control":{"path":["date_1"]},"tooltip":null,"hideEmpty":false,"onChangeValue":{"kind":"Function","name":"onInit","type":"client"},"__hidden":true,"required":false,"__readOnly":null,"bindingMode":false}},{"id":"5589216a-be9f-4540-8bc0-9f48cd569fb2","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"tooltip":null,"hideEmpty":false,"required":false,"__readOnly":null,"onChangeValue":{"kind":"Function","name":"onInit","type":"client"},"__isConstValues":[],"control":{"path":["date_2"]},"__hidden":true}}]}},"fields":[{"code":"date_1","type":"DATETIME","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–î–∞—Ç–∞ 1","data":{"additionalType":"datetime","defaultTimeType":"startOfDay"},"output":false}},{"code":"date_2","type":"DATETIME","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–î–∞—Ç–∞ 2","data":{"additionalType":"datetime","defaultTimeType":"startOfDay"},"output":false}},{"code":"date_1_string","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–î–∞—Ç–∞ 1 (—Å—Ç—Ä–æ–∫–∞)","data":{"additionalType":"string"},"input":false}},{"code":"date_2_string","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–î–∞—Ç–∞ 2 (—Å—Ç—Ä–æ–∫–∞)","data":{"additionalType":"string"},"input":false}},{"code":"from_utc","type":"FLOAT","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç UTC","data":{"additionalType":"integer","showRowSeparator":true},"input":false}},{"code":"date_1_string_time","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–î–∞—Ç–∞ 1 (—Å—Ç—Ä–æ–∫–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)","data":{"additionalType":"string"},"input":false}},{"code":"date_2_string_time","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"–î–∞—Ç–∞ 2 (—Å—Ç—Ä–æ–∫–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)","data":{"additionalType":"string"},"input":false}}],"fieldVisibilityConditions":{"date_1":{"enabled":false,"conditions":[]},"date_2":{"enabled":false,"conditions":[]},"__hidden":{"enabled":false,"conditions":[]},"__outlet":{"enabled":false,"conditions":[]},"__styles":{"enabled":false,"conditions":[]},"from_utc":{"enabled":false,"conditions":[]},"__baseURL":{"enabled":false,"conditions":[]},"__classes":{"enabled":false,"conditions":[]},"__readOnly":{"enabled":false,"conditions":[]},"__relativeURL":{"enabled":false,"conditions":[]},"date_1_string":{"enabled":false,"conditions":[]},"date_2_string":{"enabled":false,"conditions":[]},"__onMouseEnter":{"enabled":false,"conditions":[]},"__onMouseLeave":{"enabled":false,"conditions":[]},"__isConstValues":{"enabled":false,"conditions":[]},"date_1_string_time":{"enabled":false,"conditions":[]},"date_2_string_time":{"enabled":false,"conditions":[]},"__renderContentAsync":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\ndeclare const console: any;\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    const user = await System.users.getCurrentUser();\n\n    // –ü–æ–ª—É—á–∞–µ–º —Ç–∞–π–º–∑–æ–Ω—É –∫–æ–º–ø–∞–Ω–∏–∏.\n    const companyTimeZone = System.timezones.default;\n\n    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–∞–π–º–∑–æ–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n    let userTimeZone = user.timezone;\n\n    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–µ—à–Ω–∏–π: –ø–æ–ª—É—á–∞–µ–º –µ–≥–æ —Å–∏—Å—Ç–µ–º–Ω—É—é —Ç–∞–π–º–æ–∑–æ–Ω—É.\n    if (user.data.groupIds \u0026\u0026 user.data.groupIds.find(f =\u003e f.id === 'f25906e4-41c3-5a89-8ec2-06648dd1f614')) {\n        const timeZones = System.timezones.all();\n        const userTimeZoneName = Intl.DateTimeFormat().resolvedOptions().timeZone;\n        Intl.DateTimeFormat().resolvedOptions()\n        userTimeZone = timeZones.find(f =\u003e f.name == userTimeZoneName) ?? companyTimeZone;\n    }\n\n    console.log(\"companyTimeZone\", companyTimeZone);\n    console.log(\"userTimeZone\", userTimeZone);\n\n    convert(userTimeZone);\n}\n\nfunction convert(timezone: TTimezone): void {\n    const date_1 = Context.data.date_1;\n    const date_2 = Context.data.date_2;\n\n    if (date_1) {\n        console.log(\"date_1 before correct\",date_1.format('DD.MM.YYYY HH:mm'));\n\n        Context.data.date_1_string = date_1.getDate(timezone).format(\"DD.MM.YYYY\");\n        Context.data.date_1_string_time = `${Context.data.date_1_string} ${date_1.getTime(timezone).format(\"HH:mm\")}`\n\n        console.log(\"date_1 after correct\",Context.data.date_1_string_time);\n    }\n\n    if (date_2) {\n        console.log(\"date_2 before correct\",date_2.format('DD.MM.YYYY HH:mm'));\n\n        Context.data.date_2_string = date_2.getDate(timezone).format(\"DD.MM.YYYY\");\n        Context.data.date_2_string_time = `${Context.data.date_2_string} ${date_2.getTime(timezone).format(\"HH:mm\")}`\n\n        console.log(\"date_2 after correct\",Context.data.date_2_string_time);\n    }\n}\n\n","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{}},"dataNamespace":"","dataCode":"","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server) {\n        async function onInit() {\n            var _a;\n            const user = await System.users.getCurrentUser();\n            const companyTimeZone = System.timezones.default;\n            let userTimeZone = user.timezone;\n            if (user.data.groupIds \u0026\u0026 user.data.groupIds.find(f =\u003e f.id === 'f25906e4-41c3-5a89-8ec2-06648dd1f614')) {\n                const timeZones = System.timezones.all();\n                const userTimeZoneName = Intl.DateTimeFormat().resolvedOptions().timeZone;\n                Intl.DateTimeFormat().resolvedOptions();\n                userTimeZone = (_a = timeZones.find(f =\u003e f.name == userTimeZoneName)) !== null \u0026\u0026 _a !== void 0 ? _a : companyTimeZone;\n            }\n            console.log(\"companyTimeZone\", companyTimeZone);\n            console.log(\"userTimeZone\", userTimeZone);\n            convert(userTimeZone);\n        }\n        function convert(timezone) {\n            const date_1 = Context.data.date_1;\n            const date_2 = Context.data.date_2;\n            if (date_1) {\n                console.log(\"date_1 before correct\", date_1.format('DD.MM.YYYY HH:mm'));\n                Context.data.date_1_string = date_1.getDate(timezone).format(\"DD.MM.YYYY\");\n                Context.data.date_1_string_time = `${Context.data.date_1_string} ${date_1.getTime(timezone).format(\"HH:mm\")}`;\n                console.log(\"date_1 after correct\", Context.data.date_1_string_time);\n            }\n            if (date_2) {\n                console.log(\"date_2 before correct\", date_2.format('DD.MM.YYYY HH:mm'));\n                Context.data.date_2_string = date_2.getDate(timezone).format(\"DD.MM.YYYY\");\n                Context.data.date_2_string_time = `${Context.data.date_2_string} ${date_2.getTime(timezone).format(\"HH:mm\")}`;\n                console.log(\"date_2 after correct\", Context.data.date_2_string_time);\n            }\n        }\n        return {\n            onInit,\n            convert\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"},{"name":"convert","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"}]},"__createdAt":"2023-12-20T13:09:23.937037916Z","__createdBy":"7303b866-4220-4086-a09e-348a76b12c73","__updatedAt":"2024-02-14T11:09:37.466725812Z","__updatedBy":"7303b866-4220-4086-a09e-348a76b12c73","__deletedAt":null}
