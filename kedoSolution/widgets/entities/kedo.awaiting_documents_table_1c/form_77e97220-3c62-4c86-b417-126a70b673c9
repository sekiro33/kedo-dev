{"__id":"018ea35b-cad6-73fc-9f31-32e18f90f743","namespace":"kedo.awaiting_documents_table_1c","code":"form_77e97220-3c62-4c86-b417-126a70b673c9","__name":"Форма запуска","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":1,"hidden":true,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"b3338478-f9e6-47a8-a3d0-9d85a1ef328d","descriptor":"item-form-complex-popup","descriptorVersion":2,"values":{"formType":"start-process-form","formGroup":{"path":["context"]},"systemFunctions":{}},"content":{"[footer]":[{"id":"cc734fcd-17d6-4b8c-8529-91a25cc2a94e","descriptor":"buttons-panel","values":{"buttons":{"path":["actionButtons"]}}}],"[content]":[{"id":"c18e9118-cda2-49f4-ae50-5414c9b970b2","descriptor":"modal-body","values":{"shadow":true},"content":{"":[{"id":"32aecd96-ad38-400c-a819-cd461f9334c6","descriptor":"dynamic-form-row","values":{"tooltip":null,"hideEmpty":false,"__readOnly":true,"bindingMode":false,"__relativeURL":"","showDisplayName":true,"control":{"path":["context","staff"]},"__outlet":"","required":false,"__baseURL":"","showCreateItem":false,"__isConstValues":[],"__renderContentOnDemand":false}},{"id":"177f0bc7-1c13-44de-98bd-727d5f16d2e2","descriptor":"dynamic-form-row","values":{"bindingMode":false,"__relativeURL":"","showCreateItem":false,"__renderContentOnDemand":false,"control":{"path":["context","organization"]},"__baseURL":"","__readOnly":null,"hideEmpty":false,"__isConstValues":[],"showDisplayName":true,"tooltip":null,"__outlet":"","required":true}}]}}],"[sidebar]":[{"id":"0ceaa8ec-5cdc-4385-9a6b-b0ae1e04039b","descriptor":"sidebar-widget","content":{"":[{"id":"2c1bfe32-44b9-46d5-bee7-2ed66205f4d6","descriptor":"user-guide","values":{"userGuide":{"path":["instruction"]}}}]}},{"id":"2112f287-a8ad-433c-862d-f9808c2d4f7b","descriptor":"sidebar-widget","content":{"":[{"id":"8900384e-a047-46b0-8ba7-462c23711e72","descriptor":"target-widget","values":{"context":{"path":["context"]}}}]}}],"[headerControls]":[],"[headerCustomization]":[]}},"fieldVisibilityConditions":{},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    const user = await System.users.getCurrentUser();\n\n    const staff = await Context.fields.staff.app.search()\n        .where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.ext_user.eq(user)\n        ))\n        .first();\n\n    if (!staff) {\n        throw new Error(\"Не удалось найти карточку сотрудника для текущего пользователя.\");\n    }\n\n    Context.data.staff = staff;\n\n    const staff_employment_table = staff.data.employment_table;\n\n    if (!staff_employment_table || staff_employment_table.length == 0) {\n        throw new Error(\"У текущего сотрудника не заполнена таблица занятости.\");\n    }\n\n    const organizations = staff_employment_table\n        .filter(r =\u003e r.organization)\n        .map(r =\u003e r.organization);\n\n    if (organizations.length == 0) {\n        throw new Error(\"Не найдены организации в таблице занятости сотрудника.\");\n    }\n\n    Context.fields.organization.data.setFilter((f, c, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.__id.in(organizations.map(o =\u003e o.id))\n    ))\n\n    Context.data.organization = organizations[0];\n}","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{},"dataFieldCode":"context"},"dataNamespace":"kedo.awaiting_documents_table_1c","dataCode":"_process_document_handling_1c","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function onInit() {\n            const user = await System.users.getCurrentUser();\n            const staff = await Context.fields.staff.app.search()\n                .where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.ext_user.eq(user)))\n                .first();\n            if (!staff) {\n                throw new Error(\"Не удалось найти карточку сотрудника для текущего пользователя.\");\n            }\n            Context.data.staff = staff;\n            const staff_employment_table = staff.data.employment_table;\n            if (!staff_employment_table || staff_employment_table.length == 0) {\n                throw new Error(\"У текущего сотрудника не заполнена таблица занятости.\");\n            }\n            const organizations = staff_employment_table\n                .filter(r =\u003e r.organization)\n                .map(r =\u003e r.organization);\n            if (organizations.length == 0) {\n                throw new Error(\"Не найдены организации в таблице занятости сотрудника.\");\n            }\n            Context.fields.organization.data.setFilter((f, c, g) =\u003e g.and(f.__deletedAt.eq(null), f.__id.in(organizations.map(o =\u003e o.id))));\n            Context.data.organization = organizations[0];\n        }\n        return {\n            onInit\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"}],"clientDependencies":{"applications":[],"collections":[{"namespace":"kedo","code":"staff"}],"pages":[]}},"__createdAt":"2024-04-03T09:48:05.718214436Z","__createdBy":"8c6e1940-a6f3-4603-aff7-7cdf41cc9799","__updatedAt":"2024-04-03T09:53:44.01586158Z","__updatedBy":"8c6e1940-a6f3-4603-aff7-7cdf41cc9799","__deletedAt":null}
