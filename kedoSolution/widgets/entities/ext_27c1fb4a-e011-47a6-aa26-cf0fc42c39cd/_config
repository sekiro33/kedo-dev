{"__id":"018c8758-614d-7fe9-bf12-bea00c8f7fa9","namespace":"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd","code":"_config","__name":"Виджет пользовательских настроек","description":"Данный виджет будет отображаться на странице модуля","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":4,"hidden":false,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"f8ce65bf-bbfc-488a-b630-cff52041f805","descriptor":"component","content":{"":[{"id":"7d7bd35a-d521-4c08-9d55-d7c3a74932cc","descriptor":"modal-body","content":{"":[{"id":"3f076108-4a64-460c-bd0e-b546b562a3a3","descriptor":"groupbox","values":{"styleEnum":[{"code":"default","name":"Default"}],"collapsible":true,"__isConstValues":[],"__renderContentAsync":false,"title":"Контур","expanded":true},"content":{"":[{"id":"6674cc5b-8a30-4ff4-85fe-b75900366830","descriptor":"dynamic-form-row","values":{"required":false,"__baseURL":"","hideEmpty":false,"bindingMode":false,"__isConstValues":[],"control":{"path":["item","file_upload_type"]},"__outlet":"","__readOnly":null,"__relativeURL":"","showDisplayName":true,"tooltip":null}},{"id":"834585e3-1787-4e6f-a62f-40ec3e41e1be","descriptor":"dynamic-form-row","values":{"required":false,"hideEmpty":false,"onChangeValue":{"kind":"Function","name":"changeKonturServer","type":"client"},"showDisplayName":true,"control":{"path":["item","kontur_server"]},"tooltip":null,"__isConstValues":[],"__readOnly":null,"bindingMode":false}},{"id":"a3ec27e7-507c-4ff3-9d88-76cad18284b8","descriptor":"dynamic-form-row","values":{"__readOnly":true,"displayName":"Адрес сервера выдачи сертификатов","hideEmpty":false,"tooltip":null,"required":false,"bindingMode":false,"__isConstValues":[],"showDisplayName":true,"control":{"path":["item","kontur_server_address"]}}},{"id":"49430c0f-6107-4caa-9829-6cd123c88d2e","descriptor":"dynamic-form-row","values":{"showDisplayName":true,"hideEmpty":false,"bindingMode":false,"__isConstValues":[],"__readOnly":true,"displayName":"Адрес сервера подписания","control":{"path":["item","kontur_sign_server"]},"tooltip":null,"required":false}}]}},{"id":"843c459e-100d-4960-ba64-526f6002f219","descriptor":"groupbox","values":{"__isConstValues":[],"__renderContentAsync":false,"title":"Sign.me","expanded":false,"styleEnum":[{"code":"default","name":"Default"}],"collapsible":true},"content":{"":[{"id":"7d5d5deb-b65b-45ce-9750-31b963f5836c","descriptor":"dynamic-form-row","values":{"__readOnly":null,"onChangeValue":{"kind":"Function","name":"changeSignMeServer","type":"client"},"__isConstValues":[],"showDisplayName":true,"control":{"path":["item","sign_me_server"]},"tooltip":null,"required":false,"hideEmpty":false,"bindingMode":false}},{"id":"9c5af16b-987e-441d-8c24-c2f0a54c0c54","descriptor":"dynamic-form-row","values":{"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":true,"bindingMode":false,"__isConstValues":[],"showDisplayName":true,"control":{"path":["item","sign_me_server_address"]}}}]}}]}}]}},"fieldVisibilityConditions":{},"scriptOptions":{},"clientScripts":"declare const console: any;\ndeclare const window: any;\n\nconst prodKonturCerts = \"https://api.kontur.ru/kcr\";\nconst testKonturCerts = \"https://api.kontur.ru/kcr\";\nconst testKonturSigns = \"http://cloudtest.kontur-ca.ru/v3\";\nconst prodKonturSigns = \"https://gost-tls-kontur.elma-bpm.com/v3\";\nconst prodSignMe = \"https://gost-tls-signme.elma-bpm.com\";\nconst testSignMe = \"https://gost-tls-signme-test.elma-bpm.com\";\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    let templates: FetchResponse | undefined = undefined;\n    try {\n        templates = await fetch(`https://${window.location.host}/api/worker/query/system/bp_templates/search`, {\n            method: \"PUT\",\n            body: JSON.stringify({\n                offset: 0,\n                limit: 100,\n                order: [],\n                filter: {\n                    and: [\n                        {\n                            eq :[\n                                {field: \"namespace\" },\n                                {const: \"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd\"}\n                            ]\n                        }\n                    ]\n                }\n            })\n        });\n    } catch {\n        templates = await fetch(`http://${window.location.host}/api/worker/query/system/bp_templates/search`, {\n            method: \"PUT\",\n            body: JSON.stringify({\n                offset: 0,\n                limit: 100,\n                order: [],\n                filter: {\n                    and: [\n                        {\n                            eq :[\n                                {field: \"namespace\" },\n                                {const: \"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd\"}\n                            ]\n                        }\n                    ]\n                }\n            })\n        });\n        \n    }\n    console.log(await templates.json())\n}\n\nasync function changeKonturServer(): Promise\u003cvoid\u003e {\n    let serverCode = Context.data.kontur_server!.code;\n    if (serverCode == \"production\") {\n        Context.data.kontur_server_address = prodKonturCerts;\n        Context.data.kontur_sign_server = prodKonturSigns;\n    } else {\n        Context.data.kontur_server_address = testKonturCerts;\n        Context.data.kontur_sign_server = testKonturSigns;\n    };\n    console.log(Context.data.kontur_sign_server)\n};\n\nasync function changeSignMeServer(): Promise\u003cvoid\u003e {\n    let serverCode = Context.data.sign_me_server!.code;\n    if (serverCode == \"production\") {\n        Context.data.sign_me_server_address = prodSignMe;\n    } else {\n        Context.data.sign_me_server_address = testSignMe;\n    };\n};","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{},"dataFieldCode":"item"},"dataNamespace":"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd","dataCode":"","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        const prodKonturCerts = \"https://api.kontur.ru/kcr\";\n        const testKonturCerts = \"https://api.kontur.ru/kcr\";\n        const testKonturSigns = \"http://cloudtest.kontur-ca.ru/v3\";\n        const prodKonturSigns = \"https://gost-tls-kontur.elma-bpm.com/v3\";\n        const prodSignMe = \"https://gost-tls-signme.elma-bpm.com\";\n        const testSignMe = \"https://gost-tls-signme-test.elma-bpm.com\";\n        async function onInit() {\n            let templates = undefined;\n            try {\n                templates = await fetch(`https://${window.location.host}/api/worker/query/system/bp_templates/search`, {\n                    method: \"PUT\",\n                    body: JSON.stringify({\n                        offset: 0,\n                        limit: 100,\n                        order: [],\n                        filter: {\n                            and: [\n                                {\n                                    eq: [\n                                        { field: \"namespace\" },\n                                        { const: \"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd\" }\n                                    ]\n                                }\n                            ]\n                        }\n                    })\n                });\n            }\n            catch (_a) {\n                templates = await fetch(`http://${window.location.host}/api/worker/query/system/bp_templates/search`, {\n                    method: \"PUT\",\n                    body: JSON.stringify({\n                        offset: 0,\n                        limit: 100,\n                        order: [],\n                        filter: {\n                            and: [\n                                {\n                                    eq: [\n                                        { field: \"namespace\" },\n                                        { const: \"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd\" }\n                                    ]\n                                }\n                            ]\n                        }\n                    })\n                });\n            }\n            console.log(await templates.json());\n        }\n        async function changeKonturServer() {\n            let serverCode = Context.data.kontur_server.code;\n            if (serverCode == \"production\") {\n                Context.data.kontur_server_address = prodKonturCerts;\n                Context.data.kontur_sign_server = prodKonturSigns;\n            }\n            else {\n                Context.data.kontur_server_address = testKonturCerts;\n                Context.data.kontur_sign_server = testKonturSigns;\n            }\n            ;\n            console.log(Context.data.kontur_sign_server);\n        }\n        ;\n        async function changeSignMeServer() {\n            let serverCode = Context.data.sign_me_server.code;\n            if (serverCode == \"production\") {\n                Context.data.sign_me_server_address = prodSignMe;\n            }\n            else {\n                Context.data.sign_me_server_address = testSignMe;\n            }\n            ;\n        }\n        ;\n        return {\n            onInit,\n            changeKonturServer,\n            changeSignMeServer\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"},{"name":"changeKonturServer","parameters":[],"type":"[object Object]"},{"name":"changeSignMeServer","parameters":[],"type":"[object Object]"}]},"__createdAt":"2023-12-20T13:09:25.452274659Z","__createdBy":"7303b866-4220-4086-a09e-348a76b12c73","__updatedAt":"2024-02-14T11:09:43.24297253Z","__updatedBy":"7303b866-4220-4086-a09e-348a76b12c73","__deletedAt":null}
