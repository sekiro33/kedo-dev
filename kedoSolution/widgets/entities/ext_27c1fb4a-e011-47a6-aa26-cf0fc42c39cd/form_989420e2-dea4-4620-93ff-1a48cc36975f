{"__id":"018c8758-61a5-7fee-8ada-87a2c172b6d4","namespace":"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd","code":"form_989420e2-dea4-4620-93ff-1a48cc36975f","__name":"Ознакомиться с заявкой","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":3,"hidden":true,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"19253227-5121-4674-9db1-c5d0592bc5a0","descriptor":"item-form-complex-popup","descriptorVersion":2,"values":{"formType":"task-form","formGroup":{"path":["context"]}},"content":{"[footer]":[{"id":"31979bac-00bd-4123-a901-9d14190c8dde","descriptor":"buttons-panel","values":{"buttons":{"path":["actionButtons"]}}}],"[content]":[{"id":"c18e9118-cda2-49f4-ae50-5414c9b970b2","descriptor":"modal-body","values":{"shadow":true},"content":{"":[{"id":"928d702a-360e-4205-8f1c-fc572faead08","descriptor":"file-preview","values":{"__isConstValues":[],"fieldFormControl":{"path":["context","release_statement"]}}},{"id":"28d28c0b-f633-441e-99c1-3c6656f562c2","descriptor":"button","values":{"runActionEnum":[{"code":"undefined","name":"shared.common.button@widget-runAction-none","translate":true}],"__isConstValues":[],"processPopoverSize":[{"code":"default","name":"shared.common.button@widget-process-popover-size-default","translate":true}],"view":"default","label":"Отправить код","action":null,"onClick":{"kind":"Function","name":"getSecretCode","type":"server"},"runInPopover":null,"createAppItemSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}},"runProcessSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}}}},{"id":"e492de1a-ad3f-4b50-941c-43699bfc17dd","descriptor":"dynamic-form-row","values":{"__isConstValues":[],"showDisplayName":true,"control":{"path":["sms_code"]},"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":null,"bindingMode":false}},{"id":"cd1d2f62-2940-4712-979b-0e07d898608e","descriptor":"button","values":{"view":"default","action":null,"runInPopover":null,"__isConstValues":[],"runProcessSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}},"createAppItemSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}},"label":"Подтвердить","onClick":{"kind":"Function","name":"confirmSecret","type":"server"},"runActionEnum":[{"code":"undefined","name":"shared.common.button@widget-runAction-none","translate":true}],"processPopoverSize":[{"code":"default","name":"shared.common.button@widget-process-popover-size-default","translate":true}]}},{"id":"8de21bc9-be73-4091-9cfd-061cd28b792a","descriptor":"elma-info-block","values":{"text":"Заявка успешно подтверждена.","__hidden":{"path":["request_confirmed"],"modifier":"not"},"typeEnum":[{"code":"success","name":"Положительный результат (зеленый)"}],"__isConstValues":[],"__renderContentAsync":false},"content":{"":[]}},{"id":"a4e7540a-05a6-4715-8192-6838bbedbfd5","descriptor":"elma-info-block","values":{"text":{"path":["error"]},"__hidden":{"path":["error_exists"],"modifier":"not"},"typeEnum":[{"code":"danger","name":"Ошибка (красный)"}],"__isConstValues":[],"__renderContentAsync":false},"content":{"":[]}}]}}],"[sidebar]":[{"id":"39d7757a-529f-4526-98f3-fddc66becf85","descriptor":"sidebar-widget","content":{"":[{"id":"abe4b782-6e2d-49cc-a57e-81b636422ee5","descriptor":"target-widget","values":{"context":{"path":["context"]}}}]}},{"id":"231b371a-64ae-4b61-8014-cba6da318ac9","descriptor":"sidebar-widget","content":{"":[{"id":"5e39b91d-aea4-467e-862f-0f8766eb44df","descriptor":"linked-item","values":{"context":{"path":["context"]}}}]}},{"id":"a4469de0-d7f3-11ec-9d64-0242ac120002","descriptor":"sidebar-widget","content":{"":[{"id":"3ead7c41-6dfa-4144-80da-2bfb5f0ccf59","descriptor":"item-reminder","values":{"formGroup":{"path":["context"]}}}]}},{"id":"56d1d0e8-aa83-4cdd-ae43-294b26ad4d04","descriptor":"sidebar-widget","content":{"":[{"id":"e1525e34-14ba-456b-b703-f407945c01e0","descriptor":"item-tasks","descriptorVersion":4,"values":{"formGroup":{"path":["context"]},"itemModel":{"path":["itemModel"]}}}]}},{"id":"eef018f2-1d3a-4600-a19d-791733b28b5e","descriptor":"sidebar-widget","content":{"":[{"id":"e0a17dec-603a-461a-becf-861637630584","descriptor":"messages-target","values":{"target":{"path":["target"]}}}]}}],"[formInfoPanel]":[{"id":"dcc1dbeb-8e2d-4b3b-86a3-66151d00e82e","descriptor":"validation-info-block","values":{"__validateResult":{"path":["context","__validateResult"]}}}],"[headerControls]":[{"id":"475aa008-aaff-402f-8de2-408bae1f1928","descriptor":"task-percent-widget","values":{"task":{"path":["task"]}}},{"id":"702d9c59-77ae-4dd5-b71a-a5fe7b58858f","descriptor":"extension-zone-toolbar-widget","values":{"item":{"path":["__itemRef"]}}},{"id":"f7b11c79-4267-4f5b-a002-dd629d549682","descriptor":"process-item-map","values":{"skipRulesCheck":true,"task":{"path":["task"]}}},{"id":"ff2500ee-6573-49cd-a9e8-2d5c93350f26","descriptor":"button","values":{"icon":"menu_vertical","view":"icon","label":"bpm.tasks.item@menu","action":{"path":["menuAction"]},"runProcessSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}},"createAppItemSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}}}}],"[headerCustomization]":[]}},"fields":[{"code":"request_confirmed","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Заявка успешно подписана","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"error","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Ошибка при подтверждении заявки","data":{"additionalType":"string"}}},{"code":"error_exists","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Есть ошибка?","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"sms_code","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Код из смс","data":{"additionalType":"string"}}},{"code":"wrong_code","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Неверный код","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}}],"fieldVisibilityConditions":{"error":{"enabled":false,"conditions":[]},"sms_code":{"enabled":false,"conditions":[]},"wrong_code":{"enabled":false,"conditions":[]},"error_exists":{"enabled":false,"conditions":[]},"request_confirmed":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n","clientScriptOptions":{"allowServer":true},"serverScripts":"const apiKey = Context.data.api_key!;\nconst headers: Record\u003cstring, string\u003e = {\n    \"X-KONTUR-APIKEY\": apiKey,\n    \"Content-Type\": \"application/json\"\n};\nconst baseUrl = `${Namespace.params.data.kontur_server_address}/v1/issues`;\nconst requestId = Context.data.request_id;\n\nasync function getSecretCode(): Promise\u003cvoid\u003e {\n    let response = await fetch(`${baseUrl}/${requestId}/confirmation-requests`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n            \"operationToConfirm\": \"signingReleaseStatement\"\n        })\n    });\n    \n    if (!response.ok) {\n        let responseJson = await response.json();\n        ViewContext.data.error_exists = true;\n        let errorMessage = responseJson.error.message;\n        ViewContext.data.error = `${response.status}: ${errorMessage}`;\n        return;\n    };\n};\n\nasync function confirmSecret(): Promise\u003cvoid\u003e {\n    ViewContext.data.wrong_code = false;\n    let response = await fetch(`${baseUrl}/${requestId}/documents/releaseStatement/sign`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n            confirmationInfo: {\n                smsCode: ViewContext.data.sms_code!\n            }\n        })\n    });\n    if (!response.ok) {\n        let responseJson = await response.json();\n        let errorCode = responseJson.error.code;\n        ViewContext.data.error_exists = true;\n        switch (errorCode) {\n            case \"WrongConfirmationCode\":\n                ViewContext.data.error = \"Неверный код, попробуйте еще раз.\";\n                break;\n            case \"ConfirmationCodeExpired\":\n                ViewContext.data.error = \"Срок действия кода истёк, запросите новый.\";\n                break;\n            default:\n                ViewContext.data.error = responseJson.error.message;\n                break;\n        };\n        return;\n    };\n    ViewContext.data.request_confirmed = true;\n};","serverScriptOptions":{},"dataFieldCode":"context"},"dataNamespace":"ext_27c1fb4a-e011-47a6-aa26-cf0fc42c39cd","dataCode":"_process_unep_issue_request","runtime":{"version":1,"serverScripts":"const apiKey = Context.data.api_key;\nconst headers = {\n    \"X-KONTUR-APIKEY\": apiKey,\n    \"Content-Type\": \"application/json\"\n};\nconst baseUrl = `${Namespace.params.data.kontur_server_address}/v1/issues`;\nconst requestId = Context.data.request_id;\nasync function getSecretCode() {\n    let response = await fetch(`${baseUrl}/${requestId}/confirmation-requests`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n            \"operationToConfirm\": \"signingReleaseStatement\"\n        })\n    });\n    if (!response.ok) {\n        let responseJson = await response.json();\n        ViewContext.data.error_exists = true;\n        let errorMessage = responseJson.error.message;\n        ViewContext.data.error = `${response.status}: ${errorMessage}`;\n        return;\n    }\n    ;\n}\n;\nasync function confirmSecret() {\n    ViewContext.data.wrong_code = false;\n    let response = await fetch(`${baseUrl}/${requestId}/documents/releaseStatement/sign`, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify({\n            confirmationInfo: {\n                smsCode: ViewContext.data.sms_code\n            }\n        })\n    });\n    if (!response.ok) {\n        let responseJson = await response.json();\n        let errorCode = responseJson.error.code;\n        ViewContext.data.error_exists = true;\n        switch (errorCode) {\n            case \"WrongConfirmationCode\":\n                ViewContext.data.error = \"Неверный код, попробуйте еще раз.\";\n                break;\n            case \"ConfirmationCodeExpired\":\n                ViewContext.data.error = \"Срок действия кода истёк, запросите новый.\";\n                break;\n            default:\n                ViewContext.data.error = responseJson.error.message;\n                break;\n        }\n        ;\n        return;\n    }\n    ;\n    ViewContext.data.request_confirmed = true;\n}\n;\n","serverFnDeclarations":[{"name":"getSecretCode","parameters":[],"type":"[object Object]"},{"name":"confirmSecret","parameters":[],"type":"[object Object]"}]},"__createdAt":"2023-12-20T13:09:25.539629286Z","__createdBy":"7303b866-4220-4086-a09e-348a76b12c73","__updatedAt":"2024-02-14T11:09:43.945614613Z","__updatedBy":"7303b866-4220-4086-a09e-348a76b12c73","__deletedAt":null}
