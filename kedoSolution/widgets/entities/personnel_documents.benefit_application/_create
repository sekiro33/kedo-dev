{"__id":"018fb8c3-3101-72e3-a0ae-53ffc5fdb8d8","namespace":"personnel_documents.benefit_application","code":"_create","__name":"Форма создания","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":5,"hidden":false,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"274f146c-b3c9-4d48-b051-8185052c85f6","descriptor":"item-form-complex-popup","descriptorVersion":2,"values":{"systemFunctions":{},"formGroup":{"path":["item"]}},"content":{"[footer]":[{"id":"5537c112-b8a9-425c-90eb-27036a4c926c","descriptor":"zone-content","values":{"zoneCode":"[footer]"}}],"[content]":[{"id":"7d7bd35a-d521-4c08-9d55-d7c3a74932cc","descriptor":"modal-body","content":{"":[{"id":"21ca50cb-fa67-4187-b6e8-73255e1dffbe","descriptor":"kedo@forget_me_not_widget","descriptorVersion":1,"values":{"element_name":"заявления на выплату пособия","__relativeURL":"","__isConstValues":[],"__renderContentOnDemand":false,"__outlet":"","__baseURL":""}},{"id":"4a03022f-f386-4ac1-a233-4e9385344eac","descriptor":"dynamic-form-row","values":{"tooltip":null,"__hidden":{"path":["staff_hide"]},"required":false,"__readOnly":null,"bindingMode":false,"showCreateItem":false,"showDisplayName":true,"control":{"path":["item","staff"]}}},{"id":"5aeb8346-9418-4cc8-85cb-aa3374bf6eb9","descriptor":"kedo.employment_directory@employments_list_widget","descriptorVersion":1,"values":{"__isConstValues":[],"__renderContentOnDemand":false,"__styles":"width: 100%","__baseURL":"","__relativeURL":"","employment_placement":{"path":["item","employment_placement"]},"employment_placement_required":true,"employment_placement_name_visible":true,"staff":{"path":["item","staff"]},"__outlet":""}},{"id":"6010c816-137a-4ee2-b25a-05ab205df9b9","descriptor":"dynamic-form-row","values":{"control":{"path":["item","type_of_allowance"]},"tooltip":null,"__isConstValues":["tooltip","displayName","tooltip","displayName"],"showDisplayName":true,"__outlet":"","__baseURL":"","hideEmpty":false,"showCreateItem":false,"__renderContentOnDemand":false,"required":true,"__readOnly":null,"bindingMode":false,"__relativeURL":"","onChangeValue":{"kind":"Function","name":"allowanceTypeOnChange","type":"client"}}},{"id":"20f1eb2c-0c41-4cdc-8e03-941df7b6758b","descriptor":"dynamic-form-row","values":{"__readOnly":null,"bindingMode":false,"showDisplayName":true,"control":{"path":["item","employee_comment"]},"tooltip":null,"required":false}},{"id":"a502bfc6-0d86-4c72-9f66-3a6176d64947","descriptor":"groupbox","values":{"__hidden":{"path":["code_2_hide"]},"expanded":true,"styleEnum":[{"code":"default","name":"Default"}],"collapsible":false,"__isConstValues":[],"__renderContentAsync":false,"title":"Дополнительные поля"},"content":{"":[{"id":"129764a9-1010-447c-813e-5cddb6a5399d","descriptor":"dynamic-form-row","values":{"control":{"path":["item","start_date"]},"tooltip":null,"required":{"path":["code_2_need"]},"__readOnly":null,"bindingMode":false,"showDisplayName":true}},{"id":"2adbce31-2de5-4ef8-8ff4-c3fd1b2a23c3","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","expiration_date"]},"tooltip":null,"required":{"path":["code_2_need"]},"__readOnly":null}}]}},{"id":"1e3174c5-8bc6-4a8d-b49e-81a34f95d7f4","descriptor":"groupbox","values":{"__isConstValues":[],"__renderContentAsync":false,"title":"Дополнительные поля","__hidden":{"path":["code_3_hide"]},"expanded":true,"styleEnum":[{"code":"default","name":"Default"}],"collapsible":false},"content":{"":[{"id":"fc5d7cc7-f3ed-4dfa-b4cc-c2acad2b43de","descriptor":"dynamic-form-row","values":{"control":{"path":["item","childs_name"]},"tooltip":null,"required":{"path":["code_3_need"]},"__readOnly":null,"bindingMode":false,"showDisplayName":true}},{"id":"d54ebe28-b11b-4b7b-b62c-a088a63d657f","descriptor":"dynamic-form-row","values":{"control":{"path":["item","date_of_birth"]},"tooltip":null,"required":{"path":["code_3_need"]},"__readOnly":null,"bindingMode":false,"showDisplayName":true}}]}},{"id":"bc023985-d413-4857-b6d6-6755cb573fc2","descriptor":"groupbox","values":{"title":"Дополнительные поля","__hidden":{"path":["code_5_hide"]},"expanded":true,"styleEnum":[{"code":"default","name":"Default"}],"collapsible":false,"__renderContentAsync":false},"content":{"":[{"id":"730317e1-8062-461e-86b3-d3587b769bb5","descriptor":"dynamic-form-row","values":{"bindingMode":false,"showDisplayName":true,"control":{"path":["item","date_of_accident"]},"tooltip":null,"required":{"path":["code_5_need"]},"__readOnly":null}}]}},{"id":"83abfa01-89b8-4f86-8513-169c6a98d9fe","descriptor":"groupbox","values":{"expanded":true,"styleEnum":[{"code":"default","name":"Default"}],"collapsible":false,"__renderContentAsync":false,"title":"Дополнительные поля","__hidden":{"path":["code_6_hide"]}},"content":{"":[{"id":"e6fc8d16-e05a-44ed-977b-76b03350d5ac","descriptor":"dynamic-form-row","values":{"control":{"path":["item","name_of_the_deceased"]},"tooltip":null,"required":{"path":["code_6_need"]},"__readOnly":null,"bindingMode":false,"showDisplayName":true}}]}},{"id":"f8748640-ee1e-439a-b43f-0bb86df684bf","descriptor":"dynamic-form-row","values":{"__hidden":{"path":["hide_file"]},"hideEmpty":false,"bindingMode":false,"__isConstValues":["showCreateItem","tooltip","displayName","showCreateItem","tooltip","displayName","showCreateItem","tooltip","displayName","showCreateItem","tooltip","displayName","showCreateItem","tooltip","displayName","showCreateItem","tooltip","displayName","showCreateItem","tooltip","displayName"],"control":{"path":["item","required_files"]},"tooltip":null,"required":{"path":["is_file_need"]},"__readOnly":null,"showDisplayName":true}}]}}],"[sidebar]":[{"id":"d66aba74-334f-4f04-b5d9-b0dc06e96ac0","descriptor":"sidebar-widget","content":{"":[{"id":"d5e76f29-e820-414a-b254-a7cf0b2d951b","descriptor":"user-guide","values":{"userGuide":{"path":["required_files"]}}}]}}],"[headerControls]":[],"[headerCustomization]":[]}},"fields":[{"code":"required_files","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":"Выберите вид пособия","calcByFormula":false,"formula":"","data":{},"view":{"name":"Обязательные файлы","data":{"additionalType":"string"}}},{"code":"is_file_need","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"is_file_need","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"hide_file","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":true,"calcByFormula":false,"formula":"","data":{},"view":{"name":"hide_file","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_2_need","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_2_need","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_2_hide","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":true,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_2_hide","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_3_need","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_3_need","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_3_hide","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":true,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_3_hide","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_5_need","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_5_need","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_5_hide","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":true,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_5_hide","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_6_need","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_6_need","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"code_6_hide","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":true,"calcByFormula":false,"formula":"","data":{},"view":{"name":"code_6_hide","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"staff_hide","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"staff_hide","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}}],"fieldVisibilityConditions":{"code":{"enabled":false,"conditions":[]},"hide_file":{"enabled":false,"conditions":[]},"staff_hide":{"enabled":false,"conditions":[]},"code_2_hide":{"enabled":false,"conditions":[]},"code_2_need":{"enabled":false,"conditions":[]},"code_3_hide":{"enabled":false,"conditions":[]},"code_3_need":{"enabled":false,"conditions":[]},"code_5_hide":{"enabled":false,"conditions":[]},"code_5_need":{"enabled":false,"conditions":[]},"code_6_hide":{"enabled":false,"conditions":[]},"code_6_need":{"enabled":false,"conditions":[]},"code_8_hide":{"enabled":false,"conditions":[]},"code_8_need":{"enabled":false,"conditions":[]},"code_9_hide":{"enabled":false,"conditions":[]},"code_9_need":{"enabled":false,"conditions":[]},"is_file_need":{"enabled":false,"conditions":[]},"required_files":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\ntype StaffApp = TApplication\u003cApplication$kedo$staff$Data, any, Application$kedo$staff$Processes\u003e;\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    ViewContext.data.is_file_need = false;\n    ViewContext.data.hide_file = true;\n    ViewContext.data.staff_hide = true;\n\n    const initiators_vairiants = Context.fields.type_of_allowance.app.fields.initiators.variants;\n\n    const user = await System.users.getCurrentUser();\n\n    const staff = await Context.fields.staff.app.search()\n        .where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.ext_user.eq(user)\n        ))\n        .first();\n\n    if (!staff) {\n        throw new Error(\"Для текущего пользователя не найдена карточка сотрудника\");\n    }\n\n    Context.data.staff = staff;\n\n    const is_hr_staff = await isHrStaff(staff);\n\n    if (is_hr_staff == true) {\n        ViewContext.data.staff_hide = false;\n        Context.fields.type_of_allowance.data.setFilter((f, c, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            g.or(\n                f.initiators.has(initiators_vairiants.staff),\n                f.initiators.has(initiators_vairiants.personnel_staff)\n            )\n        ))\n    } else {\n        Context.fields.type_of_allowance.data.setFilter((f, c, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.initiators.has(initiators_vairiants.staff),\n        ))\n    }\n}\n\nasync function isHrStaff(staff: StaffApp): Promise\u003cboolean\u003e {\n    const staff_employments = await Context.fields.employment_placement.app.search()\n        .where((f, g) =\u003e g.and(\n            f.__deletedAt.eq(null),\n            f.staff.link(staff),\n            f.__status.eq(Context.fields.employment_placement.app.fields.__status.variants.actual)\n        ))\n        .size(1000)\n        .all();\n\n    const organizations = await Promise.all(staff_employments\n        .filter(f =\u003e f.data.organization != undefined)\n        .map(f =\u003e f.data.organization!.fetch())\n    );\n\n    const hr_dep = organizations.reduce((prVal, curVal) =\u003e prVal.concat(curVal.data.hr_department ?? []), [] as StaffApp[]);\n\n    return hr_dep.some(s =\u003e s.id == staff.id);\n}\n\nasync function allowanceTypeOnChange(): Promise\u003cvoid\u003e {\n    clearFields();\n\n    ViewContext.data.required_files = 'Выберите вид пособия';\n    ViewContext.data.is_file_need = false;\n    ViewContext.data.hide_file = true;\n\n    if (!Context.data.type_of_allowance) {\n        return;\n    }\n\n    const type_of_allowance = await Context.data.type_of_allowance.fetch();\n    const required_files = type_of_allowance.data.list_of_required_documents;\n\n    ViewContext.data.required_files = required_files;\n\n    if (required_files \u0026\u0026 required_files.length \u003e 0) {\n        ViewContext.data.is_file_need = true;\n        ViewContext.data.hide_file = false;\n    }\n\n    switch (type_of_allowance.data.__name) {\n        case \"Беременность и роды - Пособие по беременности и родам\": {\n            ViewContext.data.code_2_hide = false;\n            ViewContext.data.code_2_need = true;\n            break;\n        }\n\n        case \"Уход за ребенком - Ежемесячное пособие по уходу за ребенком\":\n        case \"Рождение ребенка - Единовременное пособие при рождении  ребенка\": {\n            ViewContext.data.code_3_hide = false;\n            ViewContext.data.code_3_need = true;\n            break;\n        }\n\n        case \"Проф. травма - Пособие по временной нетрудоспособности\": {\n            ViewContext.data.code_5_hide = false;\n            ViewContext.data.code_5_need = true;\n            break;\n        }\n\n        case \"Погребение - Социальное пособие на погребение\": {\n            ViewContext.data.code_6_hide = false;\n            ViewContext.data.code_6_need = true;\n            break;\n        }\n\n        default: {\n            break;\n        }\n    }\n}\n\nfunction clearFields(): void {\n    ViewContext.data.code_2_need = false;\n    ViewContext.data.code_2_hide = true;\n    ViewContext.data.code_3_need = false;\n    ViewContext.data.code_3_hide = true;\n    ViewContext.data.code_5_need = false;\n    ViewContext.data.code_5_hide = true;\n    ViewContext.data.code_6_need = false;\n    ViewContext.data.code_6_hide = true;\n}    \n","clientScriptOptions":{"allowNamespace":true,"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{"allowNamespace":true},"widgetZones":[{"code":"[footer]"}],"dataFieldCode":"item"},"dataNamespace":"personnel_documents","dataCode":"benefit_application","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function onInit() {\n            ViewContext.data.is_file_need = false;\n            ViewContext.data.hide_file = true;\n            ViewContext.data.staff_hide = true;\n            const initiators_vairiants = Context.fields.type_of_allowance.app.fields.initiators.variants;\n            const user = await System.users.getCurrentUser();\n            const staff = await Context.fields.staff.app.search()\n                .where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.ext_user.eq(user)))\n                .first();\n            if (!staff) {\n                throw new Error(\"Для текущего пользователя не найдена карточка сотрудника\");\n            }\n            Context.data.staff = staff;\n            const is_hr_staff = await isHrStaff(staff);\n            if (is_hr_staff == true) {\n                ViewContext.data.staff_hide = false;\n                Context.fields.type_of_allowance.data.setFilter((f, c, g) =\u003e g.and(f.__deletedAt.eq(null), g.or(f.initiators.has(initiators_vairiants.staff), f.initiators.has(initiators_vairiants.personnel_staff))));\n            }\n            else {\n                Context.fields.type_of_allowance.data.setFilter((f, c, g) =\u003e g.and(f.__deletedAt.eq(null), f.initiators.has(initiators_vairiants.staff)));\n            }\n        }\n        async function isHrStaff(staff) {\n            const staff_employments = await Context.fields.employment_placement.app.search()\n                .where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.staff.link(staff), f.__status.eq(Context.fields.employment_placement.app.fields.__status.variants.actual)))\n                .size(1000)\n                .all();\n            const organizations = await Promise.all(staff_employments\n                .filter(f =\u003e f.data.organization != undefined)\n                .map(f =\u003e f.data.organization.fetch()));\n            const hr_dep = organizations.reduce((prVal, curVal) =\u003e { var _a; return prVal.concat((_a = curVal.data.hr_department) !== null \u0026\u0026 _a !== void 0 ? _a : []); }, []);\n            return hr_dep.some(s =\u003e s.id == staff.id);\n        }\n        async function allowanceTypeOnChange() {\n            clearFields();\n            ViewContext.data.required_files = 'Выберите вид пособия';\n            ViewContext.data.is_file_need = false;\n            ViewContext.data.hide_file = true;\n            if (!Context.data.type_of_allowance) {\n                return;\n            }\n            const type_of_allowance = await Context.data.type_of_allowance.fetch();\n            const required_files = type_of_allowance.data.list_of_required_documents;\n            ViewContext.data.required_files = required_files;\n            if (required_files \u0026\u0026 required_files.length \u003e 0) {\n                ViewContext.data.is_file_need = true;\n                ViewContext.data.hide_file = false;\n            }\n            switch (type_of_allowance.data.__name) {\n                case \"Беременность и роды - Пособие по беременности и родам\": {\n                    ViewContext.data.code_2_hide = false;\n                    ViewContext.data.code_2_need = true;\n                    break;\n                }\n                case \"Уход за ребенком - Ежемесячное пособие по уходу за ребенком\":\n                case \"Рождение ребенка - Единовременное пособие при рождении  ребенка\": {\n                    ViewContext.data.code_3_hide = false;\n                    ViewContext.data.code_3_need = true;\n                    break;\n                }\n                case \"Проф. травма - Пособие по временной нетрудоспособности\": {\n                    ViewContext.data.code_5_hide = false;\n                    ViewContext.data.code_5_need = true;\n                    break;\n                }\n                case \"Погребение - Социальное пособие на погребение\": {\n                    ViewContext.data.code_6_hide = false;\n                    ViewContext.data.code_6_need = true;\n                    break;\n                }\n                default: {\n                    break;\n                }\n            }\n        }\n        function clearFields() {\n            ViewContext.data.code_2_need = false;\n            ViewContext.data.code_2_hide = true;\n            ViewContext.data.code_3_need = false;\n            ViewContext.data.code_3_hide = true;\n            ViewContext.data.code_5_need = false;\n            ViewContext.data.code_5_hide = true;\n            ViewContext.data.code_6_need = false;\n            ViewContext.data.code_6_hide = true;\n        }\n        return {\n            onInit,\n            isHrStaff,\n            allowanceTypeOnChange,\n            clearFields\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"},{"name":"isHrStaff","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"},{"name":"allowanceTypeOnChange","parameters":[],"type":"[object Object]"},{"name":"clearFields","parameters":[],"type":"[object Object]"}]},"__createdAt":"2024-05-27T06:35:50.909988433Z","__createdBy":"59e0911f-230a-4b6d-becf-6b302a91977a","__updatedAt":"2024-06-05T06:55:58.714848048Z","__updatedBy":"59e0911f-230a-4b6d-becf-6b302a91977a","__deletedAt":null}
