{"__id":"018fc96f-7b5d-7325-908f-dfcaa5a0d7fd","namespace":"kedo.statuses","code":"kedo_status_widget","__name":"Статус КЭДО","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":1,"hidden":false,"draft":false,"readonly":false,"descriptor":{"icon":"tool_pen","template":{"id":"e99baa60-f24f-44a5-ae49-743369c453d1","descriptor":"component","values":{"systemFunctions":{}},"content":{"":[{"id":"67392ce5-459b-43a5-9ebc-99fe54ec24c1","descriptor":"code","values":{"html":"\u003cdiv class=\"kedo-status kedo-status__ext\"\u003e\n    \u003c% if (Context.data.status_data) { %\u003e\n        \u003cspan class=\"kedo-status__text kedo-status__text__ext\"\u003e\u003c%= Context.data.status_data.name %\u003e\u003c/span\u003e\n    \u003c% } else { %\u003e\n        \u003cspan class=\"kedo-status__text\"\u003eНе определен\u003c/span\u003e\n    \u003c% } %\u003e\n\u003c/div\u003e\n\n\u003cstyle\u003e\n    .kedo-status {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 8px 12px;\n        border: 1px solid #9b9b9b;\n        border-radius: 4px;\n    }\n\n    .kedo-status__text {\n        color: #9b9b9b;\n        font-size: 1em;\n        line-height: 12px;\n        text-align: center;\n    }\n\n    \u003c% if (Context.data.status_data) { %\u003e\n        .kedo-status__ext {\n            background-color : \u003c%=Context.data.status_data.background_color%\u003e;\n            border: 1px solid \u003c%=Context.data.status_data.border_color%\u003e;\n        }\n\n        .kedo-status__text__ext {\n            color : \u003c%=Context.data.status_data.text_color%\u003e;\n        }\n    \u003c% } %\u003e\n\u003c/style\u003e","hideContent":false,"contentPlaceholder":""}}]}},"fields":[{"code":"app","type":"REF_ITEM","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Приложение","data":{},"input":true,"output":false}},{"code":"kedo_status","type":"SYS_COLLECTION","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{"code":"statuses","filter":{"value":{"tf":{}},"enabled":false},"namespace":"kedo"},"view":{"name":"Статус КЭДО","data":{},"input":true,"output":false}},{"code":"status_data","type":"JSON","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Данные статуса","data":{},"input":false,"output":false}}],"fieldVisibilityConditions":{"app":{"enabled":false,"conditions":[]},"kedo_status":{"enabled":false,"conditions":[]},"status_data":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    getKedoStatus();\n\n    if (!Context.data.app) {\n        return;\n    }\n\n    const app = await Context.data.app.fetch();\n\n    // Подписка на изменение элемента приложения.\n    // При изменении элемента обновляем статус КЭДО.\n    // await System.events.subscribe().onAppItemUpdate(app, getKedoStatus).all();\n}\n\nasync function getKedoStatus(): Promise\u003cvoid\u003e {\n    if (!Context.data.kedo_status) {\n        Context.data.status_data = undefined;\n        return;\n    }\n\n    const status = await Context.data.kedo_status.fetch();\n    const status_style = getStatusStyle(status.data.code ?? \"\");\n\n    Context.data.status_data = {\n        name: status.data.name,\n        code: status.data.code,\n        ...status_style,\n    };\n}\n\n/** Временное решение по стилям для статусов */\ninterface IStatusStyle {\n    text_color: string,\n    background_color: string,\n    border_color: string,\n}\n\nfunction getStatusStyle(status_code: string): IStatusStyle {\n    const status_style: IStatusStyle = {\n        background_color: \"#F0F0F0\",\n        text_color: \"#B0B7BD\",\n        border_color: \"#B0B7BD\",\n    }\n\n    switch (status_code) {\n        case \"new\":\n        case \"signing_application\":\n        case \"at_look\":\n        case \"approval\":\n        case \"additional_signing\":\n        case \"need_decision\":\n        case \"signing_consent\":\n        case \"order_prepare\":\n        case \"submit_document\":\n        case \"paper_prepare\":\n        case \"in_progress\":\n        case \"pending\":\n        case \"on_prepare\":\n        case \"signing\":\n        case \"prepare_report\":\n        case \"waiting_confirm\":\n        case \"payment_money\":\n        case \"doc_issuance\":\n        case \"vacation_pay_calculation\":\n        case \"familiarization_local_regulations\":\n        case \"vacation_pay_payment\":\n        case \"staff_doc_signing\":\n        case \"chief_doc_signing\":\n        case \"chief_order_signing\":\n        case \"staff_order_signing\": {\n            // Желтый статус.\n            status_style.background_color = \"#FFF1C6\";\n            status_style.text_color = \"#BA8F06\";\n            status_style.border_color = \"#BA8F06\";\n            break;\n        }\n\n        case \"making_cancellation\":\n        case \"transfer\":\n        case \"waiting_start\":\n        case \"correction\":\n        case \"at_work\":\n        case \"order_correction\": {\n            // Синий статус.\n            status_style.background_color = \"#EDF2FC\";\n            status_style.text_color = \"#5581E4\";\n            status_style.border_color = \"#5581E4\";\n            break;\n        }\n\n        case \"withdrawal\":\n        case \"cancelled\":\n        case \"staff_cancelled\": {\n            // Красный статус.\n            status_style.background_color = \"#FCEAEA\";\n            status_style.text_color = \"#F88688\";\n            status_style.border_color = \"#F88688\";\n            break;\n        }\n\n        case \"paper_signed\":\n        case \"signed\":\n        case \"order_signed\":\n        case \"agreed_signed\":\n        case \"introduction\":\n        case \"completed\":\n        case \"issued\": {\n            // Зеленый статус.\n            status_style.background_color = \"#EEF8EF\";\n            status_style.text_color = \"#6BBF7B\";\n            status_style.border_color = \"#6BBF7B\";\n            break;\n        }\n\n        default:\n            break;\n    }\n\n    return status_style;\n}","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{}},"dataNamespace":"","dataCode":"","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function onInit() {\n            getKedoStatus();\n            if (!Context.data.app) {\n                return;\n            }\n            const app = await Context.data.app.fetch();\n        }\n        async function getKedoStatus() {\n            var _a;\n            if (!Context.data.kedo_status) {\n                Context.data.status_data = undefined;\n                return;\n            }\n            const status = await Context.data.kedo_status.fetch();\n            const status_style = getStatusStyle((_a = status.data.code) !== null \u0026\u0026 _a !== void 0 ? _a : \"\");\n            Context.data.status_data = Object.assign({ name: status.data.name, code: status.data.code }, status_style);\n        }\n        function getStatusStyle(status_code) {\n            const status_style = {\n                background_color: \"#F0F0F0\",\n                text_color: \"#B0B7BD\",\n                border_color: \"#B0B7BD\",\n            };\n            switch (status_code) {\n                case \"new\":\n                case \"signing_application\":\n                case \"at_look\":\n                case \"approval\":\n                case \"additional_signing\":\n                case \"need_decision\":\n                case \"signing_consent\":\n                case \"order_prepare\":\n                case \"submit_document\":\n                case \"paper_prepare\":\n                case \"in_progress\":\n                case \"pending\":\n                case \"on_prepare\":\n                case \"signing\":\n                case \"prepare_report\":\n                case \"waiting_confirm\":\n                case \"payment_money\":\n                case \"doc_issuance\":\n                case \"vacation_pay_calculation\":\n                case \"familiarization_local_regulations\":\n                case \"vacation_pay_payment\":\n                case \"staff_doc_signing\":\n                case \"chief_doc_signing\":\n                case \"chief_order_signing\":\n                case \"staff_order_signing\": {\n                    status_style.background_color = \"#FFF1C6\";\n                    status_style.text_color = \"#BA8F06\";\n                    status_style.border_color = \"#BA8F06\";\n                    break;\n                }\n                case \"making_cancellation\":\n                case \"transfer\":\n                case \"waiting_start\":\n                case \"correction\":\n                case \"at_work\":\n                case \"order_correction\": {\n                    status_style.background_color = \"#EDF2FC\";\n                    status_style.text_color = \"#5581E4\";\n                    status_style.border_color = \"#5581E4\";\n                    break;\n                }\n                case \"withdrawal\":\n                case \"cancelled\":\n                case \"staff_cancelled\": {\n                    status_style.background_color = \"#FCEAEA\";\n                    status_style.text_color = \"#F88688\";\n                    status_style.border_color = \"#F88688\";\n                    break;\n                }\n                case \"paper_signed\":\n                case \"signed\":\n                case \"order_signed\":\n                case \"agreed_signed\":\n                case \"introduction\":\n                case \"completed\":\n                case \"issued\": {\n                    status_style.background_color = \"#EEF8EF\";\n                    status_style.text_color = \"#6BBF7B\";\n                    status_style.border_color = \"#6BBF7B\";\n                    break;\n                }\n                default:\n                    break;\n            }\n            return status_style;\n        }\n        return {\n            onInit,\n            getKedoStatus,\n            getStatusStyle\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"},{"name":"getKedoStatus","parameters":[],"type":"[object Object]"},{"name":"getStatusStyle","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"}]},"__createdAt":"2024-05-30T12:17:57.597938871Z","__createdBy":"59e0911f-230a-4b6d-becf-6b302a91977a","__updatedAt":"2024-05-30T12:20:33.372152419Z","__updatedBy":"59e0911f-230a-4b6d-becf-6b302a91977a","__deletedAt":null}
