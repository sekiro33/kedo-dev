{
  "__id": "018f9ed6-d55d-74d6-9f94-dad74a4c8293",
  "namespace": "kedo_ext.vacations_page_kedo",
  "code": "_page",
  "__name": "Отпуска",
  "description": "",
  "extensionZoneCode": "",
  "sort": 0,
  "category": "00000000-0000-0000-0000-000000000000",
  "version": 21,
  "hidden": true,
  "draft": false,
  "readonly": false,
  "descriptor": {
    "types": ["page"],
    "template": {
      "id": "50869ac1-0f39-48ac-a2f3-0965606eca42",
      "descriptor": "portal-page",
      "values": {
        "systemFunctions": {}
      },
      "content": {
        "": [
          {
            "id": "e42f644d-146f-4f47-b552-023a25b5fde0",
            "descriptor": "portal-page-header",
            "values": {
              "__canRender": false
            },
            "content": {
              "[title]": []
            }
          },
          {
            "id": "03814ba6-be86-4f0d-9da5-f4d9f8efe950",
            "descriptor": "portal-page-body",
            "content": {
              "": [
                {
                  "id": "47ad58ce-56d7-40e8-b52f-afc887c655b4",
                  "descriptor": "portal-left-page-sidebar",
                  "values": {
                    "__canRender": false
                  },
                  "content": {
                    "": []
                  }
                },
                {
                  "id": "6a313ea0-4d34-47fd-a80a-ff806c3ee7c7",
                  "descriptor": "portal-page-content",
                  "values": {
                    "__outlet": "",
                    "__styles": "display: flex; flex-direction: column; gap: 2rem;",
                    "__baseURL": "",
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false
                  },
                  "content": {
                    "": [
                      {
                        "id": "5366c7dd-b0e8-468e-88cf-3fcb8f265687",
                        "descriptor": "kedo_ext@last_vacations_widget",
                        "descriptorVersion": 22,
                        "values": {
                          "kedo_statuses": {
                            "path": ["all_statuses"]
                          },
                          "__isConstValues": [],
                          "closest_vacations": {
                            "path": ["vacations_app"]
                          },
                          "__renderContentOnDemand": true,
                          "__outlet": "",
                          "__styles": "margin-bottom: 2rem;",
                          "__baseURL": "",
                          "__relativeURL": ""
                        }
                      },
                      {
                        "id": "a046e16e-991e-47a5-a73c-48769f89d4a1",
                        "descriptor": "kedo_ext@vacations_widget",
                        "descriptorVersion": 2,
                        "values": {
                          "all_statuses": {
                            "path": ["all_statuses"]
                          },
                          "__relativeURL": "",
                          "all_vacations": {
                            "path": ["all_vacations"]
                          },
                          "__isConstValues": [],
                          "__renderContentOnDemand": true,
                          "__outlet": "",
                          "__baseURL": ""
                        }
                      }
                    ]
                  }
                },
                {
                  "id": "cd0182a5-5cc6-47b4-8ca2-c77ec6eb27fd",
                  "descriptor": "portal-right-page-sidebar",
                  "values": {
                    "__canRender": false
                  },
                  "content": {
                    "": []
                  }
                }
              ]
            }
          },
          {
            "id": "2a72ef2d-7bae-4208-86b6-13c42a9049c3",
            "descriptor": "portal-page-footer",
            "values": {
              "__canRender": false
            },
            "content": {
              "": []
            }
          }
        ]
      }
    },
    "fields": [
      {
        "code": "staff_app",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "staff",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Приложение Сотрудники",
          "data": {},
          "input": true,
          "output": true
        }
      },
      {
        "code": "vacations_app",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "holidays",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Ближайшие отпуска",
          "data": {},
          "input": true,
          "output": true
        }
      },
      {
        "code": "all_statuses",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "statuses",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Все статусы КЭДО",
          "data": {},
          "input": true,
          "output": true
        }
      },
      {
        "code": "all_vacations",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "holidays",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Все отпуска",
          "data": {},
          "input": true,
          "output": true
        }
      }
    ],
    "fieldVisibilityConditions": {
      "staff_app": {
        "enabled": false,
        "conditions": []
      },
      "all_statuses": {
        "enabled": false,
        "conditions": []
      },
      "all_vacations": {
        "enabled": false,
        "conditions": []
      },
      "vacations_app": {
        "enabled": false,
        "conditions": []
      }
    },
    "scriptOptions": {},
    "clientScripts": "declare const console: any;\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    console.log(\"vacation init\")\n    const user = await System.users.getCurrentUser();\n    const staff = await Context.fields.staff_app.app.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.ext_user.eq(user)\n    )).first();\n\n    if (!staff) {\n        return;\n    };\n\n    const allVacation = await Context.fields.vacations_app.app.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.kedo_staff.link(staff)\n    )).count().then(async count =\u003e await Context.fields.vacations_app.app.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.kedo_staff.link(staff)\n    )).size(count).all());\n\n    Context.data.vacations_app = allVacation.slice(0, 2);\n    Context.data.all_vacations = allVacation;\n    Context.data.all_statuses = await Context.fields.all_statuses.app.search().where(f =\u003e f.__deletedAt.eq(null)).size(100).all();\n};",
    "clientScriptOptions": {
      "allowServer": true
    },
    "serverScripts": "/* Server scripts module */\n",
    "serverScriptOptions": {}
  },
  "dataNamespace": "",
  "dataCode": "",
  "runtime": {
    "version": 1,
    "clientScripts": "System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function onInit() {\n            console.log(\"vacation init\");\n            const user = await System.users.getCurrentUser();\n            const staff = await Context.fields.staff_app.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.ext_user.eq(user))).first();\n            if (!staff) {\n                return;\n            }\n            ;\n            const allVacation = await Context.fields.vacations_app.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.kedo_staff.link(staff))).count().then(async (count) =\u003e await Context.fields.vacations_app.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.kedo_staff.link(staff))).size(count).all());\n            Context.data.vacations_app = allVacation.slice(0, 2);\n            Context.data.all_vacations = allVacation;\n            Context.data.all_statuses = await Context.fields.all_statuses.app.search().where(f =\u003e f.__deletedAt.eq(null)).size(100).all();\n        }\n        ;\n        return {\n            onInit\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n",
    "clientFnDeclarations": [
      {
        "name": "onInit",
        "parameters": [],
        "type": "[object Object]"
      }
    ],
    "clientDependencies": {
      "applications": [],
      "collections": [
        {
          "namespace": "kedo",
          "code": "staff"
        },
        {
          "namespace": "kedo",
          "code": "holidays"
        },
        {
          "namespace": "kedo",
          "code": "statuses"
        }
      ],
      "pages": [],
      "extensions": []
    }
  },
  "__createdAt": "2024-05-22T05:47:10.557892798Z",
  "__createdBy": "5ba349d5-c2ab-4d83-b564-c7faf9af9bea",
  "__updatedAt": "2024-05-28T08:20:25.836555541Z",
  "__updatedBy": "aa2cd599-b254-4c40-9629-e6d45b96202e",
  "__deletedAt": null
}
