{"__id":"018c8758-29d7-7c3a-842d-d0fa01e87561","namespace":"kedo.staff","code":"form_0efdf6a4-6a7a-4265-80b5-18c65ddc872c","__name":"Проверить ПДн сотрудника","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":3,"hidden":true,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"d6c9a8a4-57db-4ced-ad2a-e87c2feb6a5c","descriptor":"item-form-complex-popup","descriptorVersion":2,"values":{"formType":"task-form","formGroup":{"path":["context"]},"systemFunctions":{"onInit":{"kind":"Function","name":"onInit","type":"client"}}},"content":{"[footer]":[{"id":"31979bac-00bd-4123-a901-9d14190c8dde","descriptor":"buttons-panel","values":{"buttons":{"path":["actionButtons"]}}}],"[content]":[{"id":"c18e9118-cda2-49f4-ae50-5414c9b970b2","descriptor":"modal-body","values":{"shadow":true},"content":{"":[{"id":"639554fd-eea4-4f20-b645-52aadf163d33","descriptor":"tabset","values":{"__renderContentAsync":false},"content":{"":[{"id":"2de3fa06-8903-4586-903a-3daed59e323f","descriptor":"tab","values":{"title":"Основная информация","__renderContentAsync":false,"__renderContentOnDemand":false},"content":{"":[{"id":"03734616-ab0b-401e-b8dc-a993a7afc58d","descriptor":"modal-body","content":{"":[{"id":"9dc24ad8-3717-402a-be7f-79868c80eece","descriptor":"elma-info-block","values":{"__styles":"margin-bottom: 10px","typeEnum":[{"code":"warning","name":"Предупреждение (оранжевый)"}],"__isConstValues":[],"__renderContentAsync":false,"text":"Сотрудник с такими СНИЛС/ИНН существует в системе. Если не изменить значения полей, то далее в процессе будет использоваться ранее созданный Сотрудник.","__hidden":{"path":["view_double"],"modifier":"not"}},"content":{"":[{"id":"fe200ac4-1ca8-46b7-a28a-2e21e0401c00","descriptor":"dynamic-form-row","values":{"__isConstValues":[],"showDisplayName":true,"control":{"path":["context","staff_double"]},"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":true,"bindingMode":false}}]}},{"id":"06efbb5b-508c-4864-8777-52e0c46351b1","descriptor":"elma-info-block","values":{"__renderContentAsync":false,"text":"Сотрудник с таким номером телефона уже существует.","__hidden":{"path":["view_doublephone"],"modifier":"not"},"typeEnum":[{"code":"warning","name":"Предупреждение (оранжевый)"}],"__isConstValues":[]},"content":{"":[{"id":"d4b018fd-6711-4cc9-8040-70cb7999c268","descriptor":"row-layout","values":{"__isConstValues":[],"elementsAlignEnum":[{"code":"left","name":"shared.common.row-layout@widget-elements-align-left"}],"__renderContentAsync":false},"content":{"":[{"id":"f81f7ac5-257e-4872-8820-93f9d54db4f9","descriptor":"dynamic-form-row","values":{"tooltip":null,"required":false,"showCreateItem":false,"showDisplayName":true,"control":{"path":["staff"]},"hideEmpty":false,"__readOnly":true,"bindingMode":false,"__isConstValues":[]}}]}}]}},{"id":"cd150e3a-e366-4100-9361-a4680fa9245f","descriptor":"dynamic-form","values":{"form":{"path":["context"]},"fields":{"path":["fields"]}}}]}}]}},{"id":"5734d16f-4d16-49bf-972d-5add36cfbfac","descriptor":"tab","values":{"__renderContentAsync":false,"__renderContentOnDemand":false,"title":"Сканы документов"},"content":{"":[{"id":"1e0ce853-3e5d-4db9-8c13-99ea2cfa2820","descriptor":"modal-body","content":{"":[{"id":"1398f23c-0604-42d7-bdc8-ed3f67082df9","descriptor":"dynamic-form-row","values":{"showDisplayName":true,"control":{"path":["context","docs_for_employment"]},"tooltip":null,"required":false,"hideEmpty":false,"__readOnly":true,"bindingMode":false,"__isConstValues":[]}}]}}]}}]}}]}}],"[sidebar]":[{"id":"c20778f8-2b07-4076-a22d-d22fa36cfd0c","descriptor":"sidebar-widget","values":{"title":"Инструкция","__renderContentAsync":false},"content":{"":[{"id":"23a83044-655e-481d-81f0-6721417d28b3","descriptor":"user-guide","values":{"userGuide":" \u003cp\u003eПроверьте корректность заполнения персональных данных сотрудника, а также соответствие данных приложенным документам. \u003c/p\u003e \u003cp\u003eУбедитесь, что приложенные документы в хорошем качестве и  информация в них разборчива. \u003c/p\u003e "}}]}},{"id":"39d7757a-529f-4526-98f3-fddc66becf85","descriptor":"sidebar-widget","content":{"":[{"id":"abe4b782-6e2d-49cc-a57e-81b636422ee5","descriptor":"target-widget","values":{"context":{"path":["context"]}}}]}},{"id":"231b371a-64ae-4b61-8014-cba6da318ac9","descriptor":"sidebar-widget","content":{"":[{"id":"5e39b91d-aea4-467e-862f-0f8766eb44df","descriptor":"linked-item","values":{"context":{"path":["context"]}}}]}},{"id":"1329b569-8a72-4c2d-8737-3f5cf4ed84e1","descriptor":"sidebar-widget","content":{"":[{"id":"e1525e34-14ba-456b-b703-f407945c01e0","descriptor":"item-tasks","descriptorVersion":4,"values":{"formGroup":{"path":["context"]},"itemModel":{"path":["itemModel"]}}}]}},{"id":"eef018f2-1d3a-4600-a19d-791733b28b5e","descriptor":"sidebar-widget","content":{"":[{"id":"e0a17dec-603a-461a-becf-861637630584","descriptor":"messages-target","values":{"target":{"path":["target"]}}}]}}],"[headerControls]":[{"id":"475aa008-aaff-402f-8de2-408bae1f1928","descriptor":"task-percent-widget","values":{"task":{"path":["task"]}}},{"id":"702d9c59-77ae-4dd5-b71a-a5fe7b58858f","descriptor":"extension-zone-toolbar-widget","values":{"item":{"path":["__itemRef"]}}},{"id":"f7b11c79-4267-4f5b-a002-dd629d549682","descriptor":"process-item-map","values":{"task":{"path":["task"]},"skipRulesCheck":true}},{"id":"ff2500ee-6573-49cd-a9e8-2d5c93350f26","descriptor":"button","values":{"createAppItemSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}},"icon":"menu_vertical","view":"icon","label":"bpm.tasks.item@menu","action":{"path":["menuAction"]},"runProcessSettings":{"kind":"","settings":{"code":"","field":"","binding":null,"namespace":""}}}}],"[headerCustomization]":[]}},"fields":[{"code":"view_double","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"view_double","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"view_doublephone","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"view_doublephone","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"}}},{"code":"staff","type":"SYS_COLLECTION","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{"code":"staff","filter":{"value":{"tf":{}},"enabled":false},"bindings":null,"namespace":"kedo","isDependent":false,"linkedFieldCode":""},"view":{"name":"Сотрудник","data":{}}}],"fieldVisibilityConditions":{"staff":{"enabled":false,"conditions":[]},"view_double":{"enabled":false,"conditions":[]},"view_doublephone":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    if (Context.data.staff_double)\n        ViewContext.data.view_double = true\n    await checkPhone();\n}\n\nasync function checkPhone(): Promise\u003cvoid\u003e {\n    if (!Context.data.staff) {\n        return;\n    }\n\n    const staff = await Context.data.staff.fetch();\n    \n    if (staff.data.phone \u0026\u0026 staff.data.phone.tel.length \u003e= 10) {\n        const double = await Application.search()\n            .where((f, g) =\u003e g.and(\n                f.__deletedAt.eq(null),\n                f.phone.eq(staff.data.phone!),\n                f.__id.neq(staff.data.__id)\n            ))\n            .first()\n        if (double) {\n            ViewContext.data.staff = double;\n            ViewContext.data.view_doublephone = true;\n        } else {\n            ViewContext.data.staff = undefined;\n            ViewContext.data.view_doublephone = false;\n        }\n\n    } else {\n        ViewContext.data.staff = undefined;\n        ViewContext.data.view_doublephone = false;\n    }\n}","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{},"dataFieldCode":"context"},"dataNamespace":"kedo.staff","dataCode":"_process_Employment","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server) {\n        async function onInit() {\n            if (Context.data.staff_double)\n                ViewContext.data.view_double = true;\n            await checkPhone();\n        }\n        async function checkPhone() {\n            if (!Context.data.staff) {\n                return;\n            }\n            const staff = await Context.data.staff.fetch();\n            if (staff.data.phone \u0026\u0026 staff.data.phone.tel.length \u003e= 10) {\n                const double = await Application.search()\n                    .where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.phone.eq(staff.data.phone), f.__id.neq(staff.data.__id)))\n                    .first();\n                if (double) {\n                    ViewContext.data.staff = double;\n                    ViewContext.data.view_doublephone = true;\n                }\n                else {\n                    ViewContext.data.staff = undefined;\n                    ViewContext.data.view_doublephone = false;\n                }\n            }\n            else {\n                ViewContext.data.staff = undefined;\n                ViewContext.data.view_doublephone = false;\n            }\n        }\n        return {\n            onInit,\n            checkPhone\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"},{"name":"checkPhone","parameters":[],"type":"[object Object]"}]},"__createdAt":"2023-12-20T13:09:11.253949369Z","__createdBy":"7303b866-4220-4086-a09e-348a76b12c73","__updatedAt":"2024-02-14T11:08:32.369857517Z","__updatedBy":"7303b866-4220-4086-a09e-348a76b12c73","__deletedAt":null}
