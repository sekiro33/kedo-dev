{"__id":"018fb8c3-2d60-71f7-84dd-12beb7640173","namespace":"ext_3c26e96d-9ba5-486d-a26e-47918e61fad3","code":"_config","__name":"Виджет пользовательских настроек","description":"Данный виджет будет отображаться на странице модуля","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":22,"hidden":false,"draft":false,"readonly":false,"descriptor":{"types":["form"],"template":{"id":"1eabb59d-f252-49a2-9228-2fd3b71d91a8","descriptor":"component","values":{"systemFunctions":{}},"content":{"":[{"id":"7d7bd35a-d521-4c08-9d55-d7c3a74932cc","descriptor":"modal-body","values":{"__outlet":"","__styles":"margin: 0; padding: 0;","__baseURL":"","__relativeURL":"","__isConstValues":[],"__renderContentAsync":false,"__renderContentOnDemand":false},"content":{"":[{"id":"cc9d8756-ab74-43ef-91ab-98f573dc898e","descriptor":"dynamic-form-row","values":{"hideEmpty":false,"__readOnly":null,"onChangeValue":{"kind":"Function","name":"connectionListOnChange","type":"client"},"showDisplayName":true,"tooltip":null,"required":false,"bindingMode":false,"__relativeURL":"","__isConstValues":[],"__hidden":true,"__outlet":"","__baseURL":"","__renderContentOnDemand":false,"control":{"path":["item","connection_list_1c"]}}},{"id":"780d80b3-f67b-47fe-a956-7c5cc7dc2832","descriptor":"groupbox","values":{"__isConstValues":[],"__renderContentAsync":false,"__outlet":"","styleEnum":[{"code":"default","name":"Default"}],"__relativeURL":"","__baseURL":"","collapsible":false,"__renderContentOnDemand":false,"title":"Список подключений 1С","__styles":"","expanded":true},"content":{"":[{"id":"5bd8b039-3014-4343-999e-32e7f26befcb","descriptor":"code","values":{"hideContent":true,"contentPlaceholder":"PLACEHOLDER","html":"\u003c% if (!ViewContext.data.connection_list || ViewContext.data.connection_list.length == 0) { %\u003e\n    \u003cdiv class=\"kedo-add-area\"\u003e\n        \u003cdiv class=\"content-container\"\u003e\n            \u003cdiv class=\"button-container\" onclick=\"\u003c%-Scripts%\u003e.openAddBaseModal()\"\u003eДобавить базу\u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c% } %\u003e\n\n\u003cstyle\u003e\n    .button-container {\n        border: 1px solid #1e6599;\n        border-radius : .4rem;\n        padding: 7px 14px;\n        color: #1e6599;\n        transition: background .15s linear,box-shadow .15s linear;\n    }\n\n    .button-container:hover {\n        cursor: pointer;\n        border-color: #367eb2;\n        color: #367eb2;\n        text-decoration: none;\n        transition: none;\n    }\n\n    .kedo-add-area {\n        display: flex;\n        align-items: center;\n        border-radius: 0.6rem;\n        border: 2px dashed #f0f0f0;\n        justify-content: center;\n\n        min-height: 120px;\n\n        margin: 0;\n        padding: 0;\n    }\n\u003c/style\u003e"}},{"id":"a3ec1ea7-3f0c-4aae-8962-8126dd4efe88","descriptor":"code","values":{"html":"\u003c% if (ViewContext.data.connection_list \u0026\u0026 ViewContext.data.connection_list.length \u003e 0) { %\u003e\n\n\u003ctable class=\"table\"\u003e\n    \u003cthead\u003e\n        \u003cth\u003eНазвание\u003c/th\u003e\n        \u003cth\u003eURL\u003c/th\u003e\n        \u003cth\u003eЛогин\u003c/th\u003e\n        \u003cth\u003e\u003c/th\u003e\n    \u003c/thead\u003e\n\n    \u003ctbody\u003e\n        \u003c% for (const connection of ViewContext.data.connection_list) { %\u003e\n            \u003c%= rowContent(connection) %\u003e\n        \u003c% } %\u003e\n    \u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cdiv\u003e\n    \u003cbutton onclick=\"\u003c%-Scripts%\u003e.openAddBaseModal()\"\u003e+ Добавить базу\u003c/button\u003e\n\u003c/div\u003e\n\n\u003c% } %\u003e\n\n\u003c% $template rowContent(connection) %\u003e\n    \u003ctr\u003e\n        \u003ctd\u003e\u003c%= connection.name %\u003e\u003c/td\u003e\n        \u003ctd\u003e\u003c%= connection.url %\u003e\u003c/td\u003e\n        \u003ctd\u003e\u003c%= connection.login %\u003e\u003c/td\u003e\n        \u003ctd\u003e\n            \u003cdiv class=\"kedo-module__item-control-icons kedo-module__item-delete-icon\" onclick=\"\u003c%-Scripts%\u003e.removeConnectionOnClick('\u003c%= connection.url%\u003e')\"\u003e\n                \u003csvg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n              viewBox=\"0 0 512 512\" xml:space=\"preserve\"\u003e\n                \u003cg\u003e\n                \u003cpath d=\"M85.3,106.7V128h320v341.3H106.7l0-362.7H85.3V128V106.7H64V512h384V85.3H64v21.3H85.3z M21.3,128h469.3V85.3H21.3V128z\n                    M192,21.3v21.3h106.7v42.7h-85.3l0-64H192v21.3V21.3h-21.3V128h170.7V0H170.7v21.3H192z M192,21.3v21.3h106.7v42.7h-85.3l0-64H192\n                    v21.3V21.3h-21.3V128h170.7V0H170.7v21.3H192z M298.7,192v213.3h42.7V192H298.7z M170.7,192v213.3h42.7V192H170.7z\"/\u003e\n                \u003c/g\u003e\n                \u003c/svg\u003e\n            \u003c/div\u003e\n        \u003c/td\u003e\n    \u003c/tr\u003e\n\u003c% $endtemplate %\u003e \n\n\u003cstyle\u003e\n    .kedo-module__item-delete-icon {\n        width: 20px;\n        height: 20px;\n        margin-bottom: 5px;\n    }\n\n    .kedo-module__item-control-icons {\n        height: 20px;\n        width: 20px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n\n        border-radius: 4px;\n        cursor: pointer;\n    }\n\n    .kedo-module__item-control-icons:hover, \n    .kedo-module__item-control-icons:focus,\n    .kedo-module__item-control-icons:active {\n        background-color: rgba(35, 49, 84, 0.2);\n    }\n    .kedo-module__item-delete-icon path {\n        color: #D4380D;\n    }\n\u003c/style\u003e","hideContent":true,"contentPlaceholder":"Список подключений"}}]}},{"id":"aa2cc24b-c9a9-42c3-b1a5-2bbf3cdb3300","descriptor":"complex-popup","values":{"sidebarAvailable":false,"__renderContentAsync":false,"__outlet":"","__styles":"","modalSize":[{"code":"modal-sm","name":"Маленький"}],"__relativeURL":"","__classes":"","__isConstValues":[],"__renderContentOnDemand":false,"title":"Добавить базу 1С","visible":{"path":["add_base_modal_visible"]},"__hidden":false,"__baseURL":""},"content":{"[popup-upper-header]":[],"[popup-footer]":[{"id":"1c939f19-47de-404b-834f-ecbeb03784db","descriptor":"row-layout","content":{"":[{"id":"836d0251-6002-4f4f-a747-b39269ed7987","descriptor":"button","values":{"__isConstValues":[],"view":"primary","action":null,"onClick":{"kind":"Function","name":"addNewBaseButtonOnClick","type":"client"},"runInPopover":null,"__relativeURL":"","runActionEnum":[{"code":"undefined","name":"shared.common.button@widget-runAction-none","translate":true}],"label":"Добавить","__outlet":"","__baseURL":"","processPopoverSize":[{"code":"default","name":"shared.common.button@widget-process-popover-size-default","translate":true}],"__renderContentOnDemand":false}},{"id":"77cb411d-5a97-4b9a-9b99-973d82c37506","descriptor":"button","values":{"onClick":{"kind":"Function","name":"cancelButtonOnClick","type":"client"},"__baseURL":"","runInPopover":null,"runActionEnum":[{"code":"undefined","name":"shared.common.button@widget-runAction-none","translate":true}],"processPopoverSize":[{"code":"default","name":"shared.common.button@widget-process-popover-size-default","translate":true}],"__renderContentOnDemand":false,"view":"danger","label":"Отмена","action":null,"__outlet":"","__relativeURL":"","__isConstValues":[]}}]}}],"[popup-header]":[],"[popup-content]":[{"id":"467b1aa9-9d83-489e-8852-de6e06d76102","descriptor":"modal-body","content":{"":[{"id":"a0aabccb-966c-4376-8996-02b287e9d7d5","descriptor":"elma-info-block","values":{"__hidden":{"path":["add_base_error_visible"],"modifier":"not"},"__outlet":"","typeEnum":[{"code":"danger","name":"Ошибка (красный)"}],"__baseURL":"","__renderContentOnDemand":false,"text":{"path":["add_base_error_text"]},"__relativeURL":"","__isConstValues":[],"__renderContentAsync":false},"content":{"":[]}},{"id":"f415c5d2-db13-4b9b-acc4-b2d0289ad5f3","descriptor":"dynamic-form-row","values":{"control":{"path":["url_1c_odata"]},"__outlet":"","required":{"path":["add_base_modal_visible"]},"__baseURL":"","hideEmpty":false,"bindingMode":false,"showDisplayName":true,"tooltip":null,"__readOnly":null,"__relativeURL":"","__isConstValues":[],"__renderContentOnDemand":false}},{"id":"7d0ead27-c949-4ea4-a49c-db9914c250aa","descriptor":"dynamic-form-row","values":{"required":{"path":["add_base_modal_visible"]},"__readOnly":null,"bindingMode":false,"__relativeURL":"","__isConstValues":[],"showDisplayName":true,"tooltip":null,"__outlet":"","hideEmpty":false,"__renderContentOnDemand":false,"control":{"path":["login"]},"__baseURL":""}},{"id":"b5cab448-e56e-471d-97f8-13b817a8db61","descriptor":"dynamic-form-row","values":{"tooltip":null,"__outlet":"","hideEmpty":false,"bindingMode":false,"__relativeURL":"","showDisplayName":true,"__renderContentOnDemand":false,"control":{"path":["password"]},"required":{"path":["add_base_modal_visible"]},"__baseURL":"","__readOnly":null,"__isConstValues":[]}}]}}],"[popup-sidebar]":[],"[popup-controls]":[]}}]}}]}},"fields":[{"code":"url_1c_odata","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"URL 1C odata","data":{"additionalType":"string"},"input":true,"output":true}},{"code":"login","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Логин","data":{"additionalType":"string"},"input":true,"output":true}},{"code":"password","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Пароль","data":{"additionalType":"string"},"input":true,"output":true}},{"code":"connection_list","type":"JSON","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Список подключений","data":{},"input":true,"output":true}},{"code":"add_base_modal_visible","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Отобразить модальное окно добавления базы?","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"},"input":true,"output":true}},{"code":"add_base_error_visible","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Показать ошибку?","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"},"input":true,"output":true}},{"code":"add_base_error_text","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Текст ошибки","data":{"additionalType":"string"},"input":true,"output":true}}],"fieldVisibilityConditions":{"login":{"enabled":false,"conditions":[]},"password":{"enabled":false,"conditions":[]},"url_1c_odata":{"enabled":false,"conditions":[]},"connection_list":{"enabled":false,"conditions":[]},"add_base_error_text":{"enabled":false,"conditions":[]},"add_base_error_visible":{"enabled":false,"conditions":[]},"add_base_modal_visible":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\n\ninterface ConnectionData {\n    name: string,\n    url: string,\n    password: string,\n    login: string,\n}\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    const connection_list = getConnectionList();\n    ViewContext.data.connection_list = connection_list;\n}\n\n/** Получить список баз */\nfunction getConnectionList(): ConnectionData[] {\n    const connection_list = Context.data.connection_list_1c;\n    const connections: ConnectionData[] = connection_list ? JSON.parse(connection_list) : [];\n\n    return connections;\n}\n\n/** Добавить новую базу */\nfunction addConnection(connection: ConnectionData): void {\n    const connection_list = getConnectionList();\n    connection_list.push(connection);\n    Context.data.connection_list_1c = JSON.stringify(connection_list);\n}\n\n/** Удалить базу */\nfunction removeConnection(connection: ConnectionData): void {\n    let connection_list = getConnectionList();\n    connection_list = connection_list.filter(f =\u003e f.url !== connection.url);\n    Context.data.connection_list_1c = JSON.stringify(connection_list);\n}\n\nasync function openAddBaseModal(): Promise\u003cvoid\u003e {\n    ViewContext.data.url_1c_odata = \"\";\n    ViewContext.data.login = \"\";\n    ViewContext.data.password = \"\";\n\n    ViewContext.data.add_base_modal_visible = true;\n}\n\nasync function hideAddBaseModal(): Promise\u003cvoid\u003e {\n    ViewContext.data.url_1c_odata = \"\";\n    ViewContext.data.login = \"\";\n    ViewContext.data.password = \"\";\n\n    ViewContext.data.add_base_modal_visible = false;\n}\n\nasync function addNewBaseButtonOnClick(): Promise\u003cvoid\u003e {\n    ViewContext.data.add_base_error_visible = false;\n\n    const url = ViewContext.data.url_1c_odata?.trim();\n    const login = ViewContext.data.login;\n    const password = ViewContext.data.password;\n\n    if (!url || !login || !password) {\n        ViewContext.data.add_base_error_text = `Заполните обязательные поля`;\n        ViewContext.data.add_base_error_visible = true;\n\n        return;\n    }\n\n    const base_name = getConnectionName(url);\n\n    const new_connection: ConnectionData = {\n        name: base_name,\n        url: url,\n        login: login,\n        password: password,\n    };\n\n    const connection_list = getConnectionList();\n\n    const connection_exist = connection_list.find(f =\u003e f.url === url);\n\n    if (connection_exist) {\n        ViewContext.data.add_base_error_text = `База с указанным URL уже есть в списке`;\n        ViewContext.data.add_base_error_visible = true;\n        \n        return;\n    }\n\n    addConnection(new_connection);\n\n    await hideAddBaseModal();\n}\n\nasync function removeConnectionOnClick(url: string): Promise\u003cvoid\u003e {\n    const connection_list = getConnectionList();\n    const connection = connection_list.find(f =\u003e f.url === url);\n\n    if (!connection) {\n        return;\n    }\n\n    removeConnection(connection);\n}\n\nfunction getConnectionName(url: string): string {\n    const searchTerm = 'odata/standard.odata';\n    const indexOfFirst = url.indexOf(searchTerm);\n    const splitLink = url.slice(0, indexOfFirst - 1).split('/')\n\n    if (splitLink.length) {\n        return splitLink[splitLink.length - 1]\n    }\n\n    return url;\n}\n\nasync function cancelButtonOnClick(): Promise\u003cvoid\u003e {\n    await hideAddBaseModal();\n}\n\nasync function connectionListOnChange(): Promise\u003cvoid\u003e {\n    const connection_list = getConnectionList();\n    ViewContext.data.connection_list = connection_list;\n}\n","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{},"dataFieldCode":"item"},"dataNamespace":"ext_3c26e96d-9ba5-486d-a26e-47918e61fad3","dataCode":"_extension-settings_3c26e96d-9ba5-486d-a26e-47918e61fad3","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function onInit() {\n            const connection_list = getConnectionList();\n            ViewContext.data.connection_list = connection_list;\n        }\n        function getConnectionList() {\n            const connection_list = Context.data.connection_list_1c;\n            const connections = connection_list ? JSON.parse(connection_list) : [];\n            return connections;\n        }\n        function addConnection(connection) {\n            const connection_list = getConnectionList();\n            connection_list.push(connection);\n            Context.data.connection_list_1c = JSON.stringify(connection_list);\n        }\n        function removeConnection(connection) {\n            let connection_list = getConnectionList();\n            connection_list = connection_list.filter(f =\u003e f.url !== connection.url);\n            Context.data.connection_list_1c = JSON.stringify(connection_list);\n        }\n        async function openAddBaseModal() {\n            ViewContext.data.url_1c_odata = \"\";\n            ViewContext.data.login = \"\";\n            ViewContext.data.password = \"\";\n            ViewContext.data.add_base_modal_visible = true;\n        }\n        async function hideAddBaseModal() {\n            ViewContext.data.url_1c_odata = \"\";\n            ViewContext.data.login = \"\";\n            ViewContext.data.password = \"\";\n            ViewContext.data.add_base_modal_visible = false;\n        }\n        async function addNewBaseButtonOnClick() {\n            var _a;\n            ViewContext.data.add_base_error_visible = false;\n            const url = (_a = ViewContext.data.url_1c_odata) === null || _a === void 0 ? void 0 : _a.trim();\n            const login = ViewContext.data.login;\n            const password = ViewContext.data.password;\n            if (!url || !login || !password) {\n                ViewContext.data.add_base_error_text = `Заполните обязательные поля`;\n                ViewContext.data.add_base_error_visible = true;\n                return;\n            }\n            const base_name = getConnectionName(url);\n            const new_connection = {\n                name: base_name,\n                url: url,\n                login: login,\n                password: password,\n            };\n            const connection_list = getConnectionList();\n            const connection_exist = connection_list.find(f =\u003e f.url === url);\n            if (connection_exist) {\n                ViewContext.data.add_base_error_text = `База с указанным URL уже есть в списке`;\n                ViewContext.data.add_base_error_visible = true;\n                return;\n            }\n            addConnection(new_connection);\n            await hideAddBaseModal();\n        }\n        async function removeConnectionOnClick(url) {\n            const connection_list = getConnectionList();\n            const connection = connection_list.find(f =\u003e f.url === url);\n            if (!connection) {\n                return;\n            }\n            removeConnection(connection);\n        }\n        function getConnectionName(url) {\n            const searchTerm = 'odata/standard.odata';\n            const indexOfFirst = url.indexOf(searchTerm);\n            const splitLink = url.slice(0, indexOfFirst - 1).split('/');\n            if (splitLink.length) {\n                return splitLink[splitLink.length - 1];\n            }\n            return url;\n        }\n        async function cancelButtonOnClick() {\n            await hideAddBaseModal();\n        }\n        async function connectionListOnChange() {\n            const connection_list = getConnectionList();\n            ViewContext.data.connection_list = connection_list;\n        }\n        return {\n            onInit,\n            getConnectionList,\n            addConnection,\n            removeConnection,\n            openAddBaseModal,\n            hideAddBaseModal,\n            addNewBaseButtonOnClick,\n            removeConnectionOnClick,\n            getConnectionName,\n            cancelButtonOnClick,\n            connectionListOnChange\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"onInit","parameters":[],"type":"[object Object]"},{"name":"getConnectionList","parameters":[],"type":"[object Object]"},{"name":"addConnection","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"},{"name":"removeConnection","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"},{"name":"openAddBaseModal","parameters":[],"type":"[object Object]"},{"name":"hideAddBaseModal","parameters":[],"type":"[object Object]"},{"name":"addNewBaseButtonOnClick","parameters":[],"type":"[object Object]"},{"name":"removeConnectionOnClick","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"},{"name":"getConnectionName","parameters":[{"name":"[object Object]","type":"[object Object]"}],"type":"[object Object]"},{"name":"cancelButtonOnClick","parameters":[],"type":"[object Object]"},{"name":"connectionListOnChange","parameters":[],"type":"[object Object]"}]},"__createdAt":"2024-05-27T06:35:49.983769498Z","__createdBy":"59e0911f-230a-4b6d-becf-6b302a91977a","__updatedAt":"2024-06-01T10:47:09.901162597Z","__updatedBy":"59e0911f-230a-4b6d-becf-6b302a91977a","__deletedAt":null}
