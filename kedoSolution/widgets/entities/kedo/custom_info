{"__id":"018c8757-feab-7a65-a5f2-2bf360a0038a","namespace":"kedo","code":"custom_info","__name":"Кастомный инфоблок","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":3,"hidden":false,"draft":false,"readonly":false,"descriptor":{"template":{"id":"637f67fa-bc3d-4b58-b10f-4facfb57655d","descriptor":"component","content":{"":[{"id":"662e1d41-1275-45e1-95d8-82cdec6dc5a6","descriptor":"code","values":{"html":"\u003cdiv class=\"main-container-info \u003c%= Context.data.info_type.code %\u003e\"\u003e\n    \u003cdiv class=\"holidays-info__container \u003c%= Context.data.info_type.code %\u003e \u003c%= Scripts.getWrapperClass() %\u003e\"\u003e\n        \u003cdiv class=\"holidays-info__icon-warning \u003c%= Context.data.info_type.code %\u003e\"\u003e\n\n        \u003c/div\u003e\n        \u003cp class=\"holidays-info__container-content\"\u003e\n            \u003c%= Context.data.info_string %\u003e\n        \u003c/p\u003e\n        \u003cdiv class=\"holidays-info__popup-wrapper holidays-info__popup-wrapper--hidden\"\u003e\n            \u003cp class=\"holidays-info__popup-text\"\u003e\n                \u003c%= Context.data.hover_text %\u003e\n            \u003c/p\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n    \u003c!-- \u003c% if (Context.data.user) { %\u003e\n        \u003ca href=\"\u003c%= Context.data.user_link %\u003e\"\u003e\u003c%= Context.data.user_name %\u003e\u003c/a\u003e\n    \u003c% } %\u003e\n    \u003c% if (Context.data.staff_app) { %\u003e\n        \u003ca href=\"\u003c%= Context.data.staff_link %\u003e\"\u003e\u003c%= Context.data.staff_name %\u003e\u003c/a\u003e\n    \u003c% } %\u003e --\u003e\n\u003c/div\u003e","hideContent":true,"contentPlaceholder":"info_container"}},{"id":"0dbe2aa5-6812-4e0b-9048-f6e8c9f17173","descriptor":"code","values":{"html":"\u003cstyle\u003e\n    .user-link {\n        font-weight: 600;\n    }\n\n    .user-link.info {\n        color: #6770e6;\n    }\n\n    .user-link.warning {\n        color: #FABE00;\n    }\n\n    .user-link.danger {\n        color: #E62D31;\n    }\n\n    .main-container-info {\n        display: flex;\n        flex-direction: column;\n        margin-left: 1rem;\n        border-radius: 5px;\n    }\n\n    .holidays-info__container {\n        color: #000000;\n\n        /* margin: 6px 0 6px 8px; */\n        min-width: 250px;\n        padding: 0.4rem 0.6rem;\n        border-radius: 3px;\n\n        display: flex;\n        align-items: start;\n        position: relative;\n        z-index: 100;\n    }\n\n    .main-container-info.info {\n        background-color: #6fadd6;\n        border: 1px solid #6770e6;\n    }\n\n    .main-container-info.warning {\n        background-color: #FFF8E6;\n        border: 1px solid #FABE00;\n    }\n\n    .main-container-info.danger {\n        background-color: #FCEAEA;\n        border: 1px solid #E62D31;\n    }\n\n    .holidays-info__container.info {\n        background-color: #6fadd6;\n    }\n\n    .holidays-info__container.warning {\n        background-color: #FFF8E6;\n    }\n\n    .holidays-info__container.danger {\n        background-color: #FCEAEA;\n    }\n\n    .holidays-info__container-content {\n        margin: 0;\n        font-size: 15px;\n        line-height: 22px;\n    }\n\n    .holidays-info-cell {\n        vertical-align: middle;\n    }\n\n    .holidays-info__icon-warning {\n        min-width: 16px;\n        min-height: 16px;\n        margin-right: 7px;\n        margin-top: 0.4rem;\n        background-repeat: no-repeat;\n    }\n\n    .holidays-info__icon-warning.info {\n\t    background-image: url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 0.25C3.72009 0.25 0.25 3.72134 0.25 8C0.25 12.2812 3.72009 15.75 8 15.75C12.2799 15.75 15.75 12.2812 15.75 8C15.75 3.72134 12.2799 0.25 8 0.25ZM8 14.25C4.54588 14.25 1.75 11.4553 1.75 8C1.75 4.54703 4.546 1.75 8 1.75C11.4528 1.75 14.25 4.54597 14.25 8C14.25 11.4541 11.4553 14.25 8 14.25ZM9.3125 11C9.3125 11.7237 8.72372 12.3125 8 12.3125C7.27628 12.3125 6.6875 11.7237 6.6875 11C6.6875 10.2763 7.27628 9.6875 8 9.6875C8.72372 9.6875 9.3125 10.2763 9.3125 11ZM6.76969 4.39372L6.98219 8.64372C6.99216 8.84331 7.15691 9 7.35672 9H8.64328C8.84309 9 9.00784 8.84331 9.01781 8.64372L9.23031 4.39372C9.24103 4.17953 9.07025 4 8.85578 4H7.14422C6.92975 4 6.75897 4.17953 6.76969 4.39372Z' fill='%231E6599'/%3E%3C/svg%3E\");\n    }\n\n    .holidays-info__icon-warning.warning {\n\t    background-image: url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 0.25C3.72009 0.25 0.25 3.72134 0.25 8C0.25 12.2812 3.72009 15.75 8 15.75C12.2799 15.75 15.75 12.2812 15.75 8C15.75 3.72134 12.2799 0.25 8 0.25ZM8 14.25C4.54588 14.25 1.75 11.4553 1.75 8C1.75 4.54703 4.546 1.75 8 1.75C11.4528 1.75 14.25 4.54597 14.25 8C14.25 11.4541 11.4553 14.25 8 14.25ZM9.3125 11C9.3125 11.7237 8.72372 12.3125 8 12.3125C7.27628 12.3125 6.6875 11.7237 6.6875 11C6.6875 10.2763 7.27628 9.6875 8 9.6875C8.72372 9.6875 9.3125 10.2763 9.3125 11ZM6.76969 4.39372L6.98219 8.64372C6.99216 8.84331 7.15691 9 7.35672 9H8.64328C8.84309 9 9.00784 8.84331 9.01781 8.64372L9.23031 4.39372C9.24103 4.17953 9.07025 4 8.85578 4H7.14422C6.92975 4 6.75897 4.17953 6.76969 4.39372Z' fill='%23FABE00'/%3E%3C/svg%3E\");\n    }\n\n    .holidays-info__icon-warning.danger {\n        background-image: url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8.16016 0.25C3.87891 0.25 0.410156 3.71875 0.410156 8C0.410156 12.2812 3.87891 15.75 8.16016 15.75C12.4414 15.75 15.9102 12.2812 15.9102 8C15.9102 3.71875 12.4414 0.25 8.16016 0.25ZM8.16016 14.25C4.70703 14.25 1.91016 11.4531 1.91016 8C1.91016 4.54688 4.70703 1.75 8.16016 1.75C11.6133 1.75 14.4102 4.54688 14.4102 8C14.4102 11.4531 11.6133 14.25 8.16016 14.25ZM11.3414 6.05625L9.39766 8L11.3414 9.94375C11.4883 10.0906 11.4883 10.3281 11.3414 10.475L10.6352 11.1812C10.4883 11.3281 10.2508 11.3281 10.1039 11.1812L8.16016 9.2375L6.21641 11.1812C6.06953 11.3281 5.83203 11.3281 5.68516 11.1812L4.97891 10.475C4.83203 10.3281 4.83203 10.0906 4.97891 9.94375L6.92266 8L4.97891 6.05625C4.83203 5.90938 4.83203 5.67188 4.97891 5.525L5.68516 4.81875C5.83203 4.67188 6.06953 4.67188 6.21641 4.81875L8.16016 6.7625L10.1039 4.81875C10.2508 4.67188 10.4883 4.67188 10.6352 4.81875L11.3414 5.525C11.4883 5.67188 11.4883 5.90938 11.3414 6.05625Z' fill='%23E62D31'/%3E%3C/svg%3E\");\n    }\n\n    .elma-info-block {\n        color: #000 !important;\n        border: none !important;\n        border-radius: 3px !important;\n        padding: 4px 6px !important;\n        font-weight: 400 !important;\n        margin: 4px 6px !important;\n    }\n\n    .elma-info-block.alert.danger .elma-info-block__text {\n        margin-left: 22px;\n    }\n\n    .elma-info-block.alert.danger .elma-info-block__text::before {\n        content: \"\";\n        position: absolute;\n        margin-top: 2px;\n        transform: translate(-22px, 0px);\n        min-width: 16px;\n        min-height: 16px;\n\t    background-image: url(\"data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8.16016 0.25C3.87891 0.25 0.410156 3.71875 0.410156 8C0.410156 12.2812 3.87891 15.75 8.16016 15.75C12.4414 15.75 15.9102 12.2812 15.9102 8C15.9102 3.71875 12.4414 0.25 8.16016 0.25ZM8.16016 14.25C4.70703 14.25 1.91016 11.4531 1.91016 8C1.91016 4.54688 4.70703 1.75 8.16016 1.75C11.6133 1.75 14.4102 4.54688 14.4102 8C14.4102 11.4531 11.6133 14.25 8.16016 14.25ZM11.3414 6.05625L9.39766 8L11.3414 9.94375C11.4883 10.0906 11.4883 10.3281 11.3414 10.475L10.6352 11.1812C10.4883 11.3281 10.2508 11.3281 10.1039 11.1812L8.16016 9.2375L6.21641 11.1812C6.06953 11.3281 5.83203 11.3281 5.68516 11.1812L4.97891 10.475C4.83203 10.3281 4.83203 10.0906 4.97891 9.94375L6.92266 8L4.97891 6.05625C4.83203 5.90938 4.83203 5.67188 4.97891 5.525L5.68516 4.81875C5.83203 4.67188 6.06953 4.67188 6.21641 4.81875L8.16016 6.7625L10.1039 4.81875C10.2508 4.67188 10.4883 4.67188 10.6352 4.81875L11.3414 5.525C11.4883 5.67188 11.4883 5.90938 11.3414 6.05625Z' fill='%23E62D31'/%3E%3C/svg%3E\");\n        background-repeat: no-repeat;\n    }\n\n    .holidays-info__popup-wrapper {\n        position: absolute;\n        top: 130%;\n        left: 50%;\n        transform: translate(-50%, 0);\n        z-index: 50;\n        background-color: white;\n        width: 100%;\n\n        border-radius: 3px;\n        padding: 0.3rem 1rem;\n\n        pointer-events: none;\n\n        transition: .3s\n    }\n\n    .holidays-info__popup-wrapper--disabled {\n        display: none;\n    }\n\n    .holidays-info__popup-wrapper--hidden {\n        opacity: 0;\n    }\n\n    .holidays-info__popup-wrapper:after {\n        content: '';\n        position: absolute;\n        width: 0;\n        height: 0;\n        border-bottom: 8px solid #fff;\n        border-left: 11px solid transparent;\n        border-right: 11px solid transparent;\n        top: 0;\n        left: 50%;\n        transform: translate(-50%, -7px);\n    }\n\n    .holidays-info__popup-wrapper:before {\n        content: '';\n        position: absolute;\n        width: 0;\n        height: 0;\n        border-bottom: 9px solid #97C6E3;\n        border-left: 12px solid transparent;\n        border-right: 12px solid transparent;\n        left: 50%;\n        transform: translate(-50%, -11px);\n    }\n\n    .holidays-info__container.info .holidays-info__popup-wrapper {\n        border: 1px solid #6fadd6;\n    }\n\n    .holidays-info__container.warning .holidays-info__popup-wrapper {\n        border: 1px solid #FFF8E6;\n    }\n\n    .holidays-info__container.danger .holidays-info__popup-wrapper {\n        border: 1px solid #FCEAEA;\n    }\n\n    .holidays-info__container.info .holidays-info__popup-wrapper:before {\n        content: '';\n        border-bottom: 9px solid #6fadd6;\n    }\n\n    .holidays-info__container.warning .holidays-info__popup-wrapper:before {\n        content: '';\n        border-bottom: 9px solid #FFF8E6;\n    }\n\n    .holidays-info__container.danger .holidays-info__popup-wrapper:before {\n        content: '';\n        border-bottom: 9px solid #FCEAEA;\n    }\n\n    .holidays-info__popup-text {\n        font-size: 15px;\n        line-height: 22px;\n        word-wrap: breal-word;\n        margin-bottom: 0;\n    }\n\n\u003c/style\u003e\n\n","hideContent":true,"contentPlaceholder":"css"}},{"id":"47b5cf98-44da-4dbb-b93a-aa00e76750e0","descriptor":"code","values":{"html":"\u003c%= Scripts.hoverInit() %\u003e\n","hideContent":true,"contentPlaceholder":"hover event init"}},{"id":"c3846f0c-0f24-4648-af8a-5c37f7abeee8","descriptor":"dynamic-form-row","values":{"showDisplayName":true,"control":{"path":["staff_app"]},"tooltip":null,"__hidden":true,"__readOnly":null,"bindingMode":false,"onChangeValue":{"kind":"Function","name":"handleContextChange","type":"client"},"required":false,"hideEmpty":false,"__isConstValues":[]}},{"id":"0291f828-3fcc-43cf-8227-bfdcc171d139","descriptor":"dynamic-form-row","values":{"control":{"path":["user"]},"tooltip":null,"__readOnly":null,"__isConstValues":[],"showDisplayName":true,"__hidden":true,"required":false,"hideEmpty":false,"bindingMode":false,"onChangeValue":{"kind":"Function","name":"handleContextChange","type":"client"}}}]}},"fields":[{"code":"info_string","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Информационная строка","data":{"additionalType":"markdown"},"output":false}},{"code":"info_type","type":"ENUM","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{"enumItems":[{"code":"info","name":"Информация","checked":false},{"code":"warning","name":"Предупреждение","checked":false},{"code":"danger","name":"Ошибка","checked":false}]},"view":{"name":"Тип информации","data":{},"output":false}},{"code":"hover_text","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Информационный текст при наведении","data":{"additionalType":"markdown"},"output":false}},{"code":"staff_app","type":"SYS_COLLECTION","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{"code":"staff","filter":{"value":{"tf":{}},"enabled":false},"bindings":null,"namespace":"kedo","isDependent":false,"linkedFieldCode":""},"view":{"name":"Приложение Сотрудники","data":{},"output":false}},{"code":"user","type":"SYS_USER","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{"filter":{"value":{"tf":{}},"enabled":false}},"view":{"name":"Пользователь","data":{},"output":false}},{"code":"user_link","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Ссылка на пользователя","data":{"additionalType":"string"},"input":false,"output":false}},{"code":"staff_link","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Ссылка на сотрудника","data":{"additionalType":"string"},"input":false,"output":false}},{"code":"user_name","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Имя пользователя","data":{"additionalType":"string"},"input":false,"output":false}},{"code":"staff_name","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Имя сотрудника","data":{"additionalType":"string"},"input":false,"output":false}}],"fieldVisibilityConditions":{"user":{"enabled":false,"conditions":[]},"__hidden":{"enabled":false,"conditions":[]},"__styles":{"enabled":false,"conditions":[]},"__classes":{"enabled":false,"conditions":[]},"info_type":{"enabled":false,"conditions":[]},"staff_app":{"enabled":false,"conditions":[]},"user_link":{"enabled":false,"conditions":[]},"user_name":{"enabled":false,"conditions":[]},"__readOnly":{"enabled":false,"conditions":[]},"hover_text":{"enabled":false,"conditions":[]},"staff_link":{"enabled":false,"conditions":[]},"staff_name":{"enabled":false,"conditions":[]},"info_string":{"enabled":false,"conditions":[]},"__onMouseEnter":{"enabled":false,"conditions":[]},"__onMouseLeave":{"enabled":false,"conditions":[]},"__isConstValues":{"enabled":false,"conditions":[]},"__renderContentAsync":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"/* Client scripts module */\ndeclare const console: any, document: any, window: any;\n\nasync function handleContextChange(): Promise\u003cvoid\u003e {\n    const blockType = getWrapperClass();\n    if (Context.data.user) {\n        const user = await Context.data.user.fetch();\n        const userName = user.data.__name;\n        const userLink = `./(p:user/${user.id})`;\n        Context.data.info_string = Context.data.info_string!.replace(\"link\", `\u003ca class='user-link ${blockType}' href=${userLink}\u003e${userName}\u003c/a\u003e`)\n        Context.data.user_name = userName;\n        Context.data.user_link = userLink;\n        console.log(Context.data.user_link)\n        console.log(Context.data.user_name)\n    };\n\n    if (Context.data.staff_app) {\n        const staff = await Context.data.staff_app.fetch();\n        const staffName = staff.data.__name;\n        const staffLink = `./(p:item/kedo/staff/${staff.id})`;\n        Context.data.info_string = Context.data.info_string!.replace(\"link\", `\u003ca class='user-link ${blockType}' href=${staffLink}\u003e${staffName}\u003c/a\u003e`)\n        Context.data.staff_name = staffName;\n        Context.data.staff_link = staffLink;\n        console.log(Context.data.staff_link)\n        console.log(Context.data.staff_name)\n    };\n};\n\nfunction hoverInit(): void {\n    const popupContainer = document.querySelector(`.${getWrapperClass()} .holidays-info__popup-wrapper`);\n    if (!Context.data.hover_text) {\n        popupContainer.classList.add('holidays-info__popup-wrapper--disabled');\n        return;\n    }\n\n    const container = document.querySelector(`.${getWrapperClass()}.holidays-info__container`);\n\n    container.addEventListener('mouseover', () =\u003e {\n        popupContainer.classList.remove('holidays-info__popup-wrapper--hidden');\n    })\n\n    container.addEventListener('mouseout', () =\u003e {\n        popupContainer.classList.add('holidays-info__popup-wrapper--hidden');\n    })\n}\n\n// Предыдущая версия функции. Если изначально не указана информационная строка - упадёт с ошибкой и виджет не будет отображаться.\n/* function getWrapperClass(): string {\n    const infoType = Context.data.info_type!.code;\n    const controlNumber = Context.data.info_string!.charCodeAt(0) +\n        Context.data.info_string!.charCodeAt(1) +\n        Context.data.info_string!.charCodeAt(2) +\n        Context.data.info_string!.charCodeAt(Context.data.info_string!.length - 1)\n    return infoType + controlNumber\n} */\n\nfunction getWrapperClass(): string {\n    return Context.data.info_type!.code;\n};\n","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{}},"dataNamespace":"","dataCode":"","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server) {\n        async function handleContextChange() {\n            const blockType = getWrapperClass();\n            if (Context.data.user) {\n                const user = await Context.data.user.fetch();\n                const userName = user.data.__name;\n                const userLink = `./(p:user/${user.id})`;\n                Context.data.info_string = Context.data.info_string.replace(\"link\", `\u003ca class='user-link ${blockType}' href=${userLink}\u003e${userName}\u003c/a\u003e`);\n                Context.data.user_name = userName;\n                Context.data.user_link = userLink;\n                console.log(Context.data.user_link);\n                console.log(Context.data.user_name);\n            }\n            ;\n            if (Context.data.staff_app) {\n                const staff = await Context.data.staff_app.fetch();\n                const staffName = staff.data.__name;\n                const staffLink = `./(p:item/kedo/staff/${staff.id})`;\n                Context.data.info_string = Context.data.info_string.replace(\"link\", `\u003ca class='user-link ${blockType}' href=${staffLink}\u003e${staffName}\u003c/a\u003e`);\n                Context.data.staff_name = staffName;\n                Context.data.staff_link = staffLink;\n                console.log(Context.data.staff_link);\n                console.log(Context.data.staff_name);\n            }\n            ;\n        }\n        ;\n        function hoverInit() {\n            const popupContainer = document.querySelector(`.${getWrapperClass()} .holidays-info__popup-wrapper`);\n            if (!Context.data.hover_text) {\n                popupContainer.classList.add('holidays-info__popup-wrapper--disabled');\n                return;\n            }\n            const container = document.querySelector(`.${getWrapperClass()}.holidays-info__container`);\n            container.addEventListener('mouseover', () =\u003e {\n                popupContainer.classList.remove('holidays-info__popup-wrapper--hidden');\n            });\n            container.addEventListener('mouseout', () =\u003e {\n                popupContainer.classList.add('holidays-info__popup-wrapper--hidden');\n            });\n        }\n        function getWrapperClass() {\n            return Context.data.info_type.code;\n        }\n        ;\n        return {\n            handleContextChange,\n            hoverInit,\n            getWrapperClass\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"handleContextChange","parameters":[],"type":"[object Object]"},{"name":"hoverInit","parameters":[],"type":"[object Object]"},{"name":"getWrapperClass","parameters":[],"type":"[object Object]"}]},"__createdAt":"2023-12-20T13:09:00.19980611Z","__createdBy":"7303b866-4220-4086-a09e-348a76b12c73","__updatedAt":"2024-02-14T11:07:37.883970915Z","__updatedBy":"7303b866-4220-4086-a09e-348a76b12c73","__deletedAt":null}
