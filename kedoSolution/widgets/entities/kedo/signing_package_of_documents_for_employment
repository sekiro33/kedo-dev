{"__id":"018c8758-00e1-7a6f-ae70-c0270a45db6a","namespace":"kedo","code":"signing_package_of_documents_for_employment","__name":"Подписание документов трудоустройства","description":"","extensionZoneCode":"","sort":0,"category":"00000000-0000-0000-0000-000000000000","version":4,"hidden":false,"draft":false,"readonly":false,"descriptor":{"icon":"text_align_justify","template":{"id":"441e4d14-15e5-4b1f-a040-4e484c6f9f37","descriptor":"component","content":{"":[{"id":"89d4d367-b19a-440b-944b-c120fb84a711","descriptor":"code","values":{"html":"\u003cdiv class=\"kedo__step3-content-files-wrapper\"\u003e\n    \u003cul class=\"kedo__step3-content-files-list\"\u003e\n    \u003c/ul\u003e\n\u003c/div\u003e\n\n\u003cdiv class=\"kedo-loader-wrapper_docs\"\u003e\n  \u003cdiv class=\"kedo-loader-img\"\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\n      \n\u003ctemplate class=\"kedo__step3-content-files-list-item-template\"\u003e\n    \u003cli class=\"kedo__step3-content-files-list-item\"\u003e\n        \u003cdiv class=\"kedo__step3-content-files-list-item-img doc-img\"\u003e\u003c/div\u003e\n        \u003ca href=\"\" class=\"kedo__step3-content-files-list-item-link\"\u003e\u003c/a\u003e\n        \u003ca href=\"\" class=\"kedo__step3-content-files-list-item-btn\"\u003e\u003c/a\u003e\n    \u003c/li\u003e\n\u003c/template\u003e\n\n\u003cstyle\u003e\n  \n.text-underline {\n  position: relative;\n}\n.text-underline::after{\n  position: absolute;\n  bottom: 2px;\n  left: 0;\n  content: \"\";\n  width: 100%;\n  height: 1px;\n  background: #1E6599;\n  opacity: 0;\n  visibility: hidden;\n  transition: 0.3s;\n}\n.text-underline:hover{\n  cursor: pointer;\n}\n.text-underline:hover::after{\n  opacity: 1;\n  visibility: visible;\n}\n.doc-img{\n  flex-shrink: 0;\n} \n.doc-img_doc{\n  background: url(data:image/svg+xml;charset=utf-8,%3Csvg%20width%3D%2214%22%20height%3D%2216%22%20viewBox%3D%220%200%2014%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M3%200C2.45%200%202%200.45%202%201V15C2%2015.55%202.45%2016%203%2016H13C13.55%2016%2014%2015.55%2014%2015V4L10%200H3Z%22%20fill%3D%22%23E2E5E7%22%2F%3E%0A%3Cpath%20d%3D%22M11%204H14L10%200V3C10%203.55%2010.45%204%2011%204Z%22%20fill%3D%22%23B0B7BD%22%2F%3E%0A%3Cpath%20d%3D%22M14%207L11%204H14V7Z%22%20fill%3D%22%23CAD1D8%22%2F%3E%0A%3Cpath%20d%3D%22M12%2013C12%2013.275%2011.775%2013.5%2011.5%2013.5H0.5C0.225%2013.5%200%2013.275%200%2013V8C0%207.725%200.225%207.5%200.5%207.5H11.5C11.775%207.5%2012%207.725%2012%208V13Z%22%20fill%3D%22%231E6599%22%2F%3E%0A%3Cpath%20d%3D%22M1.89319%2012.0001C1.76119%2012.0001%201.61719%2011.9276%201.61719%2011.7521V9.48164C1.61719%209.33764%201.76119%209.23364%201.89319%209.23364H2.80869C4.63569%209.23364%204.59519%2012.0001%202.84419%2012.0001H1.89319ZM2.14519%209.72114V11.5121H2.80869C3.88819%2011.5121%203.93569%209.72114%202.80869%209.72114H2.14519Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20d%3D%22M6.12469%2012.04C5.38519%2012.072%204.61719%2011.58%204.61719%2010.6005C4.61719%209.61705%205.38469%209.13354%206.12469%209.13354C6.82419%209.16904%207.55569%209.65305%207.55569%2010.6005C7.55569%2011.5485%206.82419%2012.04%206.12469%2012.04ZM6.08069%209.65354C5.63269%209.65354%205.14519%209.96954%205.14519%2010.601C5.14519%2011.229%205.63319%2011.549%206.08069%2011.549C6.54069%2011.549%207.03219%2011.229%207.03219%2010.601C7.03219%209.96904%206.54069%209.65354%206.08069%209.65354Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20d%3D%22M8.02734%2010.5964C8.02734%209.82488%208.51134%209.16138%209.43084%209.16138C9.77884%209.16138%2010.0548%209.26538%2010.3463%209.51738C10.4543%209.61688%2010.4663%209.79288%2010.3583%209.90488C10.2503%2010.0004%2010.0863%209.98888%209.99034%209.89288C9.82684%209.72088%209.65884%209.67338%209.43084%209.67338C8.81534%209.67338%208.51984%2010.1094%208.51984%2010.5969C8.51984%2011.0929%208.81134%2011.5484%209.43084%2011.5484C9.65884%2011.5484%209.87084%2011.4559%2010.0548%2011.2924C10.1783%2011.1964%2010.3503%2011.2439%2010.4223%2011.3404C10.4863%2011.4284%2010.5178%2011.5764%2010.3783%2011.7159C10.0983%2011.9764%209.76284%2012.0284%209.43034%2012.0284C8.46334%2012.0284%208.02734%2011.3679%208.02734%2010.5964Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20d%3D%22M11.5%2013.5H2V14H11.5C11.775%2014%2012%2013.775%2012%2013.5V13C12%2013.275%2011.775%2013.5%2011.5%2013.5Z%22%20fill%3D%22%23CAD1D8%22%2F%3E%0A%3C%2Fsvg%3E%0A) no-repeat center;\n}\n.doc-img_pdf{\n  background: url(data:image/svg+xml;charset=utf-8,%3Csvg%20width%3D%2214%22%20height%3D%2216%22%20viewBox%3D%220%200%2014%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M3%200C2.45%200%202%200.45%202%201V15C2%2015.55%202.45%2016%203%2016H13C13.55%2016%2014%2015.55%2014%2015V4L10%200H3Z%22%20fill%3D%22%23E2E5E7%22%2F%3E%0A%3Cpath%20d%3D%22M11%204H14L10%200V3C10%203.55%2010.45%204%2011%204Z%22%20fill%3D%22%23B0B7BD%22%2F%3E%0A%3Cpath%20d%3D%22M14%207L11%204H14V7Z%22%20fill%3D%22%23CAD1D8%22%2F%3E%0A%3Cpath%20d%3D%22M12%2013C12%2013.275%2011.775%2013.5%2011.5%2013.5H0.5C0.225%2013.5%200%2013.275%200%2013V8C0%207.725%200.225%207.5%200.5%207.5H11.5C11.775%207.5%2012%207.725%2012%208V13Z%22%20fill%3D%22%23E62D32%22%2F%3E%0A%3Cpath%20d%3D%22M2.17969%209.47327C2.17969%209.34127%202.28369%209.19727%202.45119%209.19727H3.37469C3.89469%209.19727%204.36269%209.54526%204.36269%2010.2123C4.36269%2010.8443%203.89469%2011.1963%203.37469%2011.1963H2.70719V11.7243C2.70719%2011.9003%202.59519%2011.9998%202.45119%2011.9998C2.31919%2011.9998%202.17969%2011.9003%202.17969%2011.7243V9.47327ZM2.70719%209.70077V10.6968H3.37469C3.64269%2010.6968%203.85469%2010.4603%203.85469%2010.2123C3.85469%209.93276%203.64269%209.70077%203.37469%209.70077H2.70719Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20d%3D%22M5.14514%2011.9997C5.01314%2011.9997%204.86914%2011.9277%204.86914%2011.7522V9.48115C4.86914%209.33765%205.01314%209.23315%205.14514%209.23315H6.06064C7.88764%209.23315%207.84764%2011.9997%206.09664%2011.9997H5.14514ZM5.39714%209.72116V11.5122H6.06064C7.14014%2011.5122%207.18814%209.72116%206.06064%209.72116H5.39714Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20d%3D%22M8.49566%209.75317V10.3887H9.51516C9.65916%2010.3887%209.80316%2010.5327%209.80316%2010.6722C9.80316%2010.8042%209.65916%2010.9122%209.51516%2010.9122H8.49566V11.7517C8.49566%2011.8917%208.39616%2011.9992%208.25616%2011.9992C8.08016%2011.9992%207.97266%2011.8917%207.97266%2011.7517V9.48067C7.97266%209.33717%208.08066%209.23267%208.25616%209.23267H9.65966C9.83566%209.23267%209.93966%209.33717%209.93966%209.48067C9.93966%209.60867%209.83566%209.75267%209.65966%209.75267H8.49566V9.75317Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20d%3D%22M11.5%2013.5H2V14H11.5C11.775%2014%2012%2013.775%2012%2013.5V13C12%2013.275%2011.775%2013.5%2011.5%2013.5Z%22%20fill%3D%22%23CAD1D8%22%2F%3E%0A%3C%2Fsvg%3E%0A) no-repeat center;\n}\n\n.kedo__step3-content-files-wrapper {\n  width: 100%;\n  min-height: 293px;\n  margin-bottom: 32px;\n  position: relative;\n}\n.kedo__step3-content-files-list {\n  margin: 0;\n  padding: 5px 24px;\n  list-style: none;\n}\n\n.kedo__step3-content-files-list-item {\n  min-height: 45px;\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n  border-bottom: 1px solid #CAD1D8;\n  margin-bottom: 1rem;\n}\n.kedo__step3-content-files-list-item:last-child {\n  border-bottom: none;\n}\n.kedo__step3-content-files-list-item-img{\n  width: 14px;\n  height: 16px;\n  margin-right: 8px;\n}\n.kedo__step3-content-files-list-item-link {\n  position: relative;\n  padding: 5px 0;\n  font-style: normal;\n  font-weight: normal;\n  font-size: 14px;\n  line-height: 22px;\n  color: #1E6599;\n  text-decoration: none;\n  transition: 0.3s;\n  margin-right: 10px;\n  overflow: hidden;\n  min-height: 22px;\n}\n.kedo__step3-content-files-list-item-link.disabled { \n  pointer-events: none;\n  color: #BFBFBF;\n  background: none;\n  border: none;\n}\n.kedo__step3-content-files-list-item-link:hover{\n  text-decoration: underline;\n  color: #1E6599;\n}\n.kedo__step3-content-files-list-item-btn {\n  margin-left: auto;\n  font-style: normal;\n  font-weight: 600;\n  font-size: 13px;\n  line-height: 20px;\n  color: #1E6599;\n  border-radius: 4px;\n  border: 1px solid #1E6599;\n  padding: 2px 10px;\n  transition: 0.3s;\n}\n\n.kedo__step3-content-files-list-item-btn--disabled {\n  pointer-events: none;\n  color: #BFBFBF;\n  border: 1px solid #BFBFBF;\n  background: #F5F5F5;\n  padding-left: 26px;\n  position: relative;\n}\n\n.kedo__step3-content-files-list-item-btn--disabled::before {\n  content: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTExLjUyMjEgMS43MjU4M0wxMC4yNTk3IDAuNDYzOTc2QzkuNjQxNDggLTAuMTU0MjgyIDguNjQwNzcgLTAuMTU0Mzc2IDguMDIyMzcgMC40NjM5NTJMMC41ODM4MjUgNy44NTM4OUwwLjAwNzcwODEgMTEuMzQ2Qy0wLjA1NDk4NzIgMTEuNzI2IDAuMjc0MTQ2IDEyLjA1NTIgMC42NTQyNzkgMTEuOTkyNkw0LjE0NjM1IDExLjQxNjRMMTEuNTM2OCAzLjk3Nzg3QzEyLjE1MzkgMy4zNjA3MyAxMi4xNTk4IDIuMzYzNTEgMTEuNTIyMSAxLjcyNTgzWk00LjY5Nzg4IDcuMzAyMzZDNC43OTg1NyA3LjQwMzA1IDQuOTMwNTQgNy40NTMzNyA1LjA2MjUgNy40NTMzN0M1LjE5NDQ1IDcuNDUzMzcgNS4zMjY0MyA3LjQwMzA1IDUuNDI3MTEgNy4zMDIzNkw4LjIxNjg2IDQuNTEyNTlMOC44ODY0NCA1LjE4MjE4TDQuOTIxODcgOS4xNzI2MlY4LjIwMzM3SDMuNzk2ODdWNy4wNzgzN0gyLjgyNzU5TDYuODE4MDQgMy4xMTM4TDcuNDg3NjIgMy43ODMzOEw0LjY5Nzg2IDYuNTczMTJDNC40OTY1NSA2Ljc3NDUgNC40OTY1NSA3LjEwMDk4IDQuNjk3ODggNy4zMDIzNlpNMS45MjQ5NyAxMC43Mzc3TDEuMjYyNTUgMTAuMDc1M0wxLjU0NzA4IDguMzUwNkwxLjk3ODMzIDcuOTIyMTJIMi45NTMxMlY5LjA0NzEySDQuMDc4MTJWMTAuMDIxOUwzLjY0OTY0IDEwLjQ1MzJMMS45MjQ5NyAxMC43Mzc3Wk0xMC44MDc0IDMuMjQ4NjZMMTAuODA2MiAzLjI0OTg1TDEwLjgwNSAzLjI1MTA1TDkuNjc5MzMgNC4zODQxMUw3LjYxNjEzIDIuMzIwOTFMOC43NDkxOSAxLjE5NTJMOC43NTAzNyAxLjE5NDAzTDguNzUxNTQgMS4xOTI4NkM4Ljk2NTkyIDAuOTc4NDk5IDkuMzEzNTIgMC45NzU4NTEgOS41MzA1MSAxLjE5MjgzTDEwLjc5MjcgMi40NTUwNEMxMS4wMjQyIDIuNjg2NTMgMTEuMDI1NyAzLjAzMDQxIDEwLjgwNzQgMy4yNDg2NloiIGZpbGw9IiNCRkJGQkYiLz4KPC9zdmc+Cg==\");\n  position: absolute;\n  left: 10%;\n  top: 4px;\n}\n\n.kedo__step3-content-files-list-item-btn:hover {\n  color: #fff;\n  background: #1E6599;\n  cursor: pointer;\n  text-decoration: none;\n}\n\n\n.kedo-loader-wrapper_docs {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  opacity: 0;\n  visibility: hidden;\n  justify-content: center;\n  align-items: center;\n  transition: 0.5s;\n}\n.kedo-loader-wrapper_docs_active{\n  opacity: 1;\n  visibility: visible;\n  background: rgba(0, 0, 0, 0.2);\n}\n.kedo-loader-img {\n  width: 200px;\n  height: 200px;\n  background: url(data:image/svg+xml;charset=utf-8,%3Csvg%20version%3D%221.1%22%20id%3D%22L9%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20x%3D%220px%22%20y%3D%220px%22%0A%20%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%200%200%22%20xml%3Aspace%3D%22preserve%22%3E%0A%20%20%20%20%3Cpath%20fill%3D%22%23fff%22%20d%3D%22M73%2C50c0-12.7-10.3-23-23-23S27%2C37.3%2C27%2C50%20M30.9%2C50c0-10.5%2C8.5-19.1%2C19.1-19.1S69.1%2C39.5%2C69.1%2C50%22%3E%0A%20%20%20%20%20%20%3CanimateTransform%20%0A%20%20%20%20%20%20%20%20%20attributeName%3D%22transform%22%20%0A%20%20%20%20%20%20%20%20%20attributeType%3D%22XML%22%20%0A%20%20%20%20%20%20%20%20%20type%3D%22rotate%22%0A%20%20%20%20%20%20%20%20%20dur%3D%221s%22%20%0A%20%20%20%20%20%20%20%20%20from%3D%220%2050%2050%22%0A%20%20%20%20%20%20%20%20%20to%3D%22360%2050%2050%22%20%0A%20%20%20%20%20%20%20%20%20repeatCount%3D%22indefinite%22%20%2F%3E%0A%20%20%3C%2Fpath%3E%0A%3C%2Fsvg%3E) no-repeat center / contain;\n}\n.disabled {\n  pointer-events: none;\n  color: #BFBFBF;\n  border: 1px solid #BFBFBF;\n  background: #F5F5F5;\n}\n.btn-glow {\n  animation: glowing 1.5s ease-in-out infinite;\n}\n\n@keyframes glowing {\n  0% {\n    box-shadow: 0px 0px 0px 0px rgba(40, 137, 207, 0.2);\n  } \n  50% {\n    box-shadow: 0px 0px 20px 1px rgba(40, 137, 207, 0.2);\n  }\n  100% {\n    box-shadow: 0px 0px 0px 0px rgba(40, 137, 207, 0.2);\n  }\n}\n\n@media (max-width: 530px) {\n  .kedo__step3-content-files-list-item-img {\n    margin-right: auto;\n  }\n  .kedo__step3-content-files-list-item-link {\n    margin-right: auto;\n  }\n  .kedo__step3-content-files-list-item-btn {\n    margin-left: 0;\n    margin-right: auto;\n  }\n\n}\n\u003c/style\u003e\n","hideContent":true,"contentPlaceholder":"Files HTML CSS"}},{"id":"7dad2f84-073a-4f7f-b699-ddfac372fd77","descriptor":"code","values":{"html":"\n\u003c% Scripts.renderFiles() %\u003e","hideContent":true,"contentPlaceholder":"renderFiles"}}]}},"fields":[{"code":"validation_string","type":"STRING","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Строка валидации","data":{"additionalType":"string"},"input":false,"output":false}},{"code":"staff","type":"SYS_COLLECTION","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":true,"defaultValue":null,"calcByFormula":false,"formula":"","data":{"code":"staff","filter":{"value":{"tf":{}},"enabled":false},"bindings":null,"namespace":"kedo","isDependent":false,"linkedFieldCode":""},"view":{"name":"Карточка сотрудника","data":{},"output":false}},{"code":"all_docs_signed","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Документы подписаны","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"},"input":false}},{"code":"all_documents_loaded","type":"BOOLEAN","searchable":false,"indexed":false,"deleted":false,"array":false,"required":false,"single":true,"defaultValue":false,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Все документы загружены","data":{"additionalType":"radio","noValue":"Нет","yesValue":"Да"},"input":false,"output":false}},{"code":"docs_for_sign","type":"REF_ITEM","searchable":false,"indexed":false,"deleted":false,"array":true,"required":false,"single":false,"defaultValue":null,"calcByFormula":false,"formula":"","data":{},"view":{"name":"Документы для подписания","data":{},"output":false}}],"fieldVisibilityConditions":{"staff":{"enabled":false,"conditions":[]},"__hidden":{"enabled":false,"conditions":[]},"__styles":{"enabled":false,"conditions":[]},"__classes":{"enabled":false,"conditions":[]},"__readOnly":{"enabled":false,"conditions":[]},"docs_for_sign":{"enabled":false,"conditions":[]},"__onMouseEnter":{"enabled":false,"conditions":[]},"__onMouseLeave":{"enabled":false,"conditions":[]},"__isConstValues":{"enabled":false,"conditions":[]},"all_docs_signed":{"enabled":false,"conditions":[]},"validation_string":{"enabled":false,"conditions":[]},"__renderContentAsync":{"enabled":false,"conditions":[]},"all_documents_loaded":{"enabled":false,"conditions":[]},"alternative_integration":{"enabled":false,"conditions":[]}},"scriptOptions":{},"clientScripts":"//7.07 anchor (new entitySign model)\ndeclare const console: any;\ndeclare const window: any;\ndeclare const document: any;\n\n// let userFilesIdArr: any[] = [];\nlet filesArr: any[] = [];\nlet origin = window.location.origin;\nlet href = window.location.href;\nlet currentUser: any;\nlet numberOfDocs: number;\nlet numberOfSignedDocs = 0;\n\nlet loaderEl: any;\n\nasync function renderFiles(){    \n    if (href.includes(\"portal\")) {\n        origin += \"/_portal/kedo_ext/_start_page\";\n    };\n    const fileLinkTempl = document.querySelector('.kedo__step3-content-files-list-item-template');\n    const filesWrapper = document.querySelector('.kedo__step3-content-files-list');\n    let laborContractSigned: boolean = false;\n    currentUser = await System.users.getCurrentUser();\n\n    loaderEl = document.querySelector('.kedo-loader-wrapper_docs');\n    \n    function handleButtonsBlock() {\n        let buttons: any\n        let links: any;\n        let laborContractButton: any\n        let findButtonsAndLinks = window.setInterval(() =\u003e {\n            laborContractButton = document.querySelector(\".kedo__step3-content-files-list-item-btn:not(disabled)\");\n            buttons = document.querySelectorAll(\".kedo__step3-content-files-list-item-btn.disabled\");\n            links = document.querySelectorAll(\".kedo__step3-content-files-list-item-link.disabled\");\n            if (!laborContractButton || buttons.length != numberOfDocs - 1) {\n                return;\n            };\n            laborContractButton.classList.remove(\"btn-glow\");\n            buttons.forEach((button: any) =\u003e button.classList.remove(\"disabled\"));\n            links.forEach((link: any) =\u003e link.classList.remove(\"disabled\"));\n            window.clearInterval(findButtonsAndLinks);\n        }, 400)\n    };\n\n    async function renderStep3String(fileApp: any, isSigned: boolean){\n        let itemRef: any;\n        try {\n            itemRef = fileApp.data.__sourceRef ? await fileApp.data.__sourceRef.fetch() : fileApp;\n        } catch(err) {\n            console.error(err)\n        }\n        const docIsLaborContract = laborContractExists \u0026\u0026 itemRef.code == \"labor_contract\";\n        const onCheckSignStatus = () =\u003e {\n            let checkInterval:any;\n            let isSigned = false;\n            let step = 0;\n            checkInterval = window.setInterval(async () =\u003e {\n                let signHistory: any;\n                try {\n                    itemRef = fileApp.data.__sourceRef ? await fileApp.data.__sourceRef.fetch() : fileApp;\n                    signHistory = await itemRef.getSignHistory();\n                } catch(err) {\n                    console.log(err)\n                }\n                if (signHistory) {\n                    const fileSign = signHistory.filter((sign: any) =\u003e {\n                            return sign.type === \"file\"\n                    })\n                    if (fileSign) {\n                        let dataSigns = await fileApp.getDataSigns()\n                        let sign = dataSigns.find((s: any) =\u003e s.type === \"file\");\n                        let hash = sign.hash;\n                        for (let i = 0; i \u003c fileSign.length; i++) {\n                            const signCheck = fileSign[i].signs.find((digitalSign: any) =\u003e \n                                (digitalSign.data.__userID === currentUser.data.__id || digitalSign.__userID === currentUser.data.__id)\n                                \u0026\u0026 (!!digitalSign.data.sign || !!digitalSign.sign)\n                                \u0026\u0026 (digitalSign.data.hash === hash || digitalSign.content === hash)\n                            );\n                            if (signCheck) {\n                                console.log(\"signed\")\n                                isSigned = true;\n                                break;\n                            }\n                        }\n                    } else {\n                        isSigned = false;\n                    }\n                }\n\n                if(isSigned \u0026\u0026 step === 0) {\n                    window.clearInterval(checkInterval);\n                    return;\n                }\n\n                if (isSigned) {\n                    window.clearInterval(checkInterval);\n                    numberOfSignedDocs++;\n                    const modalList = document.querySelectorAll(\".complex-popup-outer:not([hidden])\")\n                    let currentModal = modalList.item(1)\n                    if (!currentModal) {\n                        currentModal = modalList.item(0);\n                    };\n                    let findCloseButton = window.setInterval(() =\u003e {\n                        let  closeButton = currentModal.querySelector(\".modal-header__controls .close.btn\") || currentModal.querySelector(\"header button span\")\n                        if (!closeButton) {\n                            return;\n                        }\n                        console.log(closeButton)\n                        closeButton.click();\n                        window.clearInterval(findCloseButton)\n                    }, 500)\n                    // if (!!closeButton) {\n\n                    // }\n                    // const btn = document.querySelector(`[data-guid='${fileId}']`);\n\n                    btn.textContent = 'Подписано';\n                    btn.disabled = true;\n                    btn.classList.add(\"kedo__step3-content-files-list-item-btn--disabled\");\n                    \n                    if (docIsLaborContract) {\n                        laborContractSigned = true;\n                        handleButtonsBlock();\n                    };\n\n                    if (numberOfSignedDocs === numberOfDocs) {\n                        Context.data.all_docs_signed = true;\n                        Context.data.validation_string = \"true\"\n                    }\n                }\n\n                step++;\n            }, 1000)\n        }\n\n        const fileLink = fileLinkTempl.content.cloneNode(true);\n        let fileName = 'Файл';\n\n        let fileCode: string = '';\n        let fileNamespace: string = '';\n        let fileId: string = '';\n        \n        if(itemRef){\n            fileCode = itemRef.code;\n            fileNamespace = itemRef.namespace;\n            fileId = itemRef.id;\n        }\n       \n        if (itemRef){\n            fileName = fileApp.data.__name;\n        }\n\n        const img = fileLink.querySelector('.kedo__step3-content-files-list-item-img');\n        const link = fileLink.querySelector('.kedo__step3-content-files-list-item-link');\n        const btn = fileLink.querySelector('.kedo__step3-content-files-list-item-btn');\n\n        btn.addEventListener(\"click\", () =\u003e {\n            const loadInterval = window.setInterval(() =\u003e {\n                const modalList = document.querySelectorAll(\".complex-popup-outer:not([hidden])\")\n                let currentModal = modalList.item(1)\n                if (!currentModal) {\n                    currentModal = modalList.item(0);\n                };\n                const signButton = currentModal.querySelector(\".btn-group app-sign-app .btn.btn-link\")\n                if (!signButton) {\n                    return;\n                }\n                window.clearInterval(loadInterval)\n                // const button = currentModal.querySelector('.btn.btn-link')\n                signButton.click();\n            }, 1000)\n            onCheckSignStatus();\n        })\n\n        // fileType\n        let fileItem: any = undefined;\n\n        try{\n            fileItem = await itemRef.data.__file.fetch();\n        }\n        catch(err){\n            console.error(`itemRef.data.__file.fetch error: ${err}`);\n        }\n\n        let fileTypeText: string = ''; \n        if(fileItem){\n            const fileItemArr = fileItem.data.__name.split('.');\n            if (fileItemArr.length \u003e 1){\n                fileTypeText = fileItemArr[fileItemArr.length - 1];\n            }\n        }\n\n        img.classList.add('doc-img_pdf');\n\n\n        link.textContent = fileName;\n        if(fileNamespace \u0026\u0026 fileCode \u0026\u0026 fileId){\n            link.href = `./(p:item/${fileNamespace}/${fileCode}/${fileId})`;\n        }\n        if (!docIsLaborContract \u0026\u0026 laborContractExists) {\n            btn.disabled = true;\n            btn.classList.add(\"disabled\");\n            link.classList.add(\"disabled\")\n        };\n\n        if (docIsLaborContract \u0026\u0026 !isSigned) {\n            btn.disabled = false;\n            btn.classList.remove(\"disabled\");\n            link.classList.remove(\"disabled\")\n            btn.classList.add(\"btn-glow\");\n        } else if (docIsLaborContract \u0026\u0026 isSigned) {\n            laborContractSigned = true;\n            handleButtonsBlock();\n        };\n        if(isSigned) {\n            btn.textContent = 'Подписано';\n            btn.disabled = true;\n            btn.classList.add(\"kedo__step3-content-files-list-item-btn--disabled\");\n        } else {\n            btn.textContent = 'Подписать';\n            btn.href = `./(p:item/${fileNamespace}/${fileCode}/${fileId})`;\n        }\n\n        filesWrapper.append(fileLink);\n    }\n\n    showLoader();\n\n    if (Context.data.docs_for_sign \u0026\u0026 Context.data.docs_for_sign.length \u003e 0) {\n        filesArr = await Promise.all(Context.data.docs_for_sign.map(doc =\u003e doc.fetch()));\n        if (filesArr.some(doc =\u003e doc.code === \"labor_contract\")) {\n            console.log(\"labor contract exists\")\n            const laborContract = filesArr.find(doc =\u003e doc.code === \"labor_contract\");\n            filesArr = filesArr.filter(doc =\u003e doc.code != \"labor_contract\");\n            filesArr.unshift(laborContract)\n        }\n    } else {\n        try {\n            await Namespace.app.documents_for_employment.search()\n                .where(item =\u003e item.staff.link(Context.data.staff!))\n                .size(100)\n                .all()\n                .then((items) =\u003e {\n                    if(items){\n                        filesArr.push(...items)\n                    }\n                })\n                .catch(err =\u003e {\n                    console.error(`fileApp = items.find error: ${err}`);\n                })\n        } catch (e) {\n            console.error(`fileApp = items.find error: ${e}`);\n            return;\n        }\n        filesArr = filesArr ? filesArr.filter((file:any) =\u003e {\n            return file.data.__sourceRef.code !== 'order_for_transfer'\n                \u0026\u0026 file.data.__sourceRef.code !== 'transfer_application'\n                \u0026\u0026 file.data.__sourceRef.code !== 'letter_of_resignation'\n                \u0026\u0026 file.data.__sourceRef.code !== 'dismissal_order'\n                \u0026\u0026 file.data.__sourceRef.code !== 'job_application'\n                \u0026\u0026 file.data.__sourceRef.code !== 'information_about_labor_activity'\n                \u0026\u0026 file.data.__sourceRef.code !== 'electronic_interaction_agreement'\n        }) : []\n\n        \n        filesArr = filesArr.sort((item1, item2) =\u003e {\n            if(item2.data.__createdAt.after(item1.data.__createdAt)){\n                return -1;\n            } else {\n                return 1\n            }\n        })\n    }\n    let laborContractExists: boolean = false;\n    for (let file of filesArr) {\n        let fileRef = file.data.__sourceRef ? await file.data.__sourceRef.fetch() : file; \n        laborContractExists = fileRef.code === \"labor_contract\"\n        if (laborContractExists) {\n            break;\n        };\n    };\n\n    if(filesArr \u0026\u0026 filesArr.length \u003e 0){\n        numberOfDocs = filesArr.length;\n        for(let i = 0; i \u003c filesArr.length; i++){\n            const fileApp = filesArr[i];\n            let isSigned = false;\n            \n            if (fileApp) {\n                try {\n                    let itemRef = fileApp.data.__sourceRef ? await fileApp.data.__sourceRef : fileApp;\n                    const signHistory = await itemRef.getSignHistory();\n                    if (signHistory) {\n                        let dataSigns = await fileApp.getDataSigns()\n                        let sign = dataSigns.find((s: any) =\u003e s.type === \"file\");\n                        let hash = sign.hash;\n                        const fileSign = signHistory.filter((sign: any) =\u003e {\n                            return sign.type === \"file\"\n                        });\n                        if (!!fileSign) {\n                            for (let i = 0; i \u003c fileSign.length; i++) {\n                                const signCheck = fileSign[i].signs.find((digitalSign: any) =\u003e \n                                    (digitalSign.data.__userID === currentUser.data.__id || digitalSign.__userID === currentUser.data.__id)\n                                    \u0026\u0026 (digitalSign.data.sign || digitalSign.sign)\n                                    \u0026\u0026 (digitalSign.data.hash === hash || digitalSign.content === hash)\n                                );\n                                if (!!signCheck) {\n                                    isSigned = true;\n                                    numberOfSignedDocs++;\n                                    break;\n                                }\n                            }\n                        } else {\n                            isSigned = false;\n                        }\n                    }\n                } catch (e) {\n                    isSigned = false\n                }\n            }\n            await renderStep3String(fileApp, isSigned);\n        }\n        if (numberOfSignedDocs === numberOfDocs) {\n            Context.data.all_docs_signed = true;\n            Context.data.validation_string = \"true\"\n        }\n    } else {\n        filesWrapper.textContent = 'Файлы отсутствуют'\n    }\n    \n    hideLoader();\n    Context.data.all_documents_loaded = true;\n};\n\n\nfunction showLoader(){\n    loaderEl.classList.add('kedo-loader-wrapper_active')\n}\nfunction hideLoader(){\n    loaderEl.classList.remove('kedo-loader-wrapper_active')\n}\n\n","clientScriptOptions":{"allowServer":true},"serverScripts":"/* Server scripts module */\n","serverScriptOptions":{}},"dataNamespace":"","dataCode":"","runtime":{"version":1,"clientScripts":"System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        let filesArr = [];\n        let origin = window.location.origin;\n        let href = window.location.href;\n        let currentUser;\n        let numberOfDocs;\n        let numberOfSignedDocs = 0;\n        let loaderEl;\n        async function renderFiles() {\n            if (href.includes(\"portal\")) {\n                origin += \"/_portal/kedo_ext/_start_page\";\n            }\n            ;\n            const fileLinkTempl = document.querySelector('.kedo__step3-content-files-list-item-template');\n            const filesWrapper = document.querySelector('.kedo__step3-content-files-list');\n            let laborContractSigned = false;\n            currentUser = await System.users.getCurrentUser();\n            loaderEl = document.querySelector('.kedo-loader-wrapper_docs');\n            function handleButtonsBlock() {\n                let buttons;\n                let links;\n                let laborContractButton;\n                let findButtonsAndLinks = window.setInterval(() =\u003e {\n                    laborContractButton = document.querySelector(\".kedo__step3-content-files-list-item-btn:not(disabled)\");\n                    buttons = document.querySelectorAll(\".kedo__step3-content-files-list-item-btn.disabled\");\n                    links = document.querySelectorAll(\".kedo__step3-content-files-list-item-link.disabled\");\n                    if (!laborContractButton || buttons.length != numberOfDocs - 1) {\n                        return;\n                    }\n                    ;\n                    laborContractButton.classList.remove(\"btn-glow\");\n                    buttons.forEach((button) =\u003e button.classList.remove(\"disabled\"));\n                    links.forEach((link) =\u003e link.classList.remove(\"disabled\"));\n                    window.clearInterval(findButtonsAndLinks);\n                }, 400);\n            }\n            ;\n            async function renderStep3String(fileApp, isSigned) {\n                let itemRef;\n                try {\n                    itemRef = fileApp.data.__sourceRef ? await fileApp.data.__sourceRef.fetch() : fileApp;\n                }\n                catch (err) {\n                    console.error(err);\n                }\n                const docIsLaborContract = laborContractExists \u0026\u0026 itemRef.code == \"labor_contract\";\n                const onCheckSignStatus = () =\u003e {\n                    let checkInterval;\n                    let isSigned = false;\n                    let step = 0;\n                    checkInterval = window.setInterval(async () =\u003e {\n                        let signHistory;\n                        try {\n                            itemRef = fileApp.data.__sourceRef ? await fileApp.data.__sourceRef.fetch() : fileApp;\n                            signHistory = await itemRef.getSignHistory();\n                        }\n                        catch (err) {\n                            console.log(err);\n                        }\n                        if (signHistory) {\n                            const fileSign = signHistory.filter((sign) =\u003e {\n                                return sign.type === \"file\";\n                            });\n                            if (fileSign) {\n                                let dataSigns = await fileApp.getDataSigns();\n                                let sign = dataSigns.find((s) =\u003e s.type === \"file\");\n                                let hash = sign.hash;\n                                for (let i = 0; i \u003c fileSign.length; i++) {\n                                    const signCheck = fileSign[i].signs.find((digitalSign) =\u003e (digitalSign.data.__userID === currentUser.data.__id || digitalSign.__userID === currentUser.data.__id)\n                                        \u0026\u0026 (!!digitalSign.data.sign || !!digitalSign.sign)\n                                        \u0026\u0026 (digitalSign.data.hash === hash || digitalSign.content === hash));\n                                    if (signCheck) {\n                                        console.log(\"signed\");\n                                        isSigned = true;\n                                        break;\n                                    }\n                                }\n                            }\n                            else {\n                                isSigned = false;\n                            }\n                        }\n                        if (isSigned \u0026\u0026 step === 0) {\n                            window.clearInterval(checkInterval);\n                            return;\n                        }\n                        if (isSigned) {\n                            window.clearInterval(checkInterval);\n                            numberOfSignedDocs++;\n                            const modalList = document.querySelectorAll(\".complex-popup-outer:not([hidden])\");\n                            let currentModal = modalList.item(1);\n                            if (!currentModal) {\n                                currentModal = modalList.item(0);\n                            }\n                            ;\n                            let findCloseButton = window.setInterval(() =\u003e {\n                                let closeButton = currentModal.querySelector(\".modal-header__controls .close.btn\") || currentModal.querySelector(\"header button span\");\n                                if (!closeButton) {\n                                    return;\n                                }\n                                console.log(closeButton);\n                                closeButton.click();\n                                window.clearInterval(findCloseButton);\n                            }, 500);\n                            btn.textContent = 'Подписано';\n                            btn.disabled = true;\n                            btn.classList.add(\"kedo__step3-content-files-list-item-btn--disabled\");\n                            if (docIsLaborContract) {\n                                laborContractSigned = true;\n                                handleButtonsBlock();\n                            }\n                            ;\n                            if (numberOfSignedDocs === numberOfDocs) {\n                                Context.data.all_docs_signed = true;\n                                Context.data.validation_string = \"true\";\n                            }\n                        }\n                        step++;\n                    }, 1000);\n                };\n                const fileLink = fileLinkTempl.content.cloneNode(true);\n                let fileName = 'Файл';\n                let fileCode = '';\n                let fileNamespace = '';\n                let fileId = '';\n                if (itemRef) {\n                    fileCode = itemRef.code;\n                    fileNamespace = itemRef.namespace;\n                    fileId = itemRef.id;\n                }\n                if (itemRef) {\n                    fileName = fileApp.data.__name;\n                }\n                const img = fileLink.querySelector('.kedo__step3-content-files-list-item-img');\n                const link = fileLink.querySelector('.kedo__step3-content-files-list-item-link');\n                const btn = fileLink.querySelector('.kedo__step3-content-files-list-item-btn');\n                btn.addEventListener(\"click\", () =\u003e {\n                    const loadInterval = window.setInterval(() =\u003e {\n                        const modalList = document.querySelectorAll(\".complex-popup-outer:not([hidden])\");\n                        let currentModal = modalList.item(1);\n                        if (!currentModal) {\n                            currentModal = modalList.item(0);\n                        }\n                        ;\n                        const signButton = currentModal.querySelector(\".btn-group app-sign-app .btn.btn-link\");\n                        if (!signButton) {\n                            return;\n                        }\n                        window.clearInterval(loadInterval);\n                        signButton.click();\n                    }, 1000);\n                    onCheckSignStatus();\n                });\n                let fileItem = undefined;\n                try {\n                    fileItem = await itemRef.data.__file.fetch();\n                }\n                catch (err) {\n                    console.error(`itemRef.data.__file.fetch error: ${err}`);\n                }\n                let fileTypeText = '';\n                if (fileItem) {\n                    const fileItemArr = fileItem.data.__name.split('.');\n                    if (fileItemArr.length \u003e 1) {\n                        fileTypeText = fileItemArr[fileItemArr.length - 1];\n                    }\n                }\n                img.classList.add('doc-img_pdf');\n                link.textContent = fileName;\n                if (fileNamespace \u0026\u0026 fileCode \u0026\u0026 fileId) {\n                    link.href = `./(p:item/${fileNamespace}/${fileCode}/${fileId})`;\n                }\n                if (!docIsLaborContract \u0026\u0026 laborContractExists) {\n                    btn.disabled = true;\n                    btn.classList.add(\"disabled\");\n                    link.classList.add(\"disabled\");\n                }\n                ;\n                if (docIsLaborContract \u0026\u0026 !isSigned) {\n                    btn.disabled = false;\n                    btn.classList.remove(\"disabled\");\n                    link.classList.remove(\"disabled\");\n                    btn.classList.add(\"btn-glow\");\n                }\n                else if (docIsLaborContract \u0026\u0026 isSigned) {\n                    laborContractSigned = true;\n                    handleButtonsBlock();\n                }\n                ;\n                if (isSigned) {\n                    btn.textContent = 'Подписано';\n                    btn.disabled = true;\n                    btn.classList.add(\"kedo__step3-content-files-list-item-btn--disabled\");\n                }\n                else {\n                    btn.textContent = 'Подписать';\n                    btn.href = `./(p:item/${fileNamespace}/${fileCode}/${fileId})`;\n                }\n                filesWrapper.append(fileLink);\n            }\n            showLoader();\n            if (Context.data.docs_for_sign \u0026\u0026 Context.data.docs_for_sign.length \u003e 0) {\n                filesArr = await Promise.all(Context.data.docs_for_sign.map(doc =\u003e doc.fetch()));\n                if (filesArr.some(doc =\u003e doc.code === \"labor_contract\")) {\n                    console.log(\"labor contract exists\");\n                    const laborContract = filesArr.find(doc =\u003e doc.code === \"labor_contract\");\n                    filesArr = filesArr.filter(doc =\u003e doc.code != \"labor_contract\");\n                    filesArr.unshift(laborContract);\n                }\n            }\n            else {\n                try {\n                    await Namespace.app.documents_for_employment.search()\n                        .where(item =\u003e item.staff.link(Context.data.staff))\n                        .size(100)\n                        .all()\n                        .then((items) =\u003e {\n                        if (items) {\n                            filesArr.push(...items);\n                        }\n                    })\n                        .catch(err =\u003e {\n                        console.error(`fileApp = items.find error: ${err}`);\n                    });\n                }\n                catch (e) {\n                    console.error(`fileApp = items.find error: ${e}`);\n                    return;\n                }\n                filesArr = filesArr ? filesArr.filter((file) =\u003e {\n                    return file.data.__sourceRef.code !== 'order_for_transfer'\n                        \u0026\u0026 file.data.__sourceRef.code !== 'transfer_application'\n                        \u0026\u0026 file.data.__sourceRef.code !== 'letter_of_resignation'\n                        \u0026\u0026 file.data.__sourceRef.code !== 'dismissal_order'\n                        \u0026\u0026 file.data.__sourceRef.code !== 'job_application'\n                        \u0026\u0026 file.data.__sourceRef.code !== 'information_about_labor_activity'\n                        \u0026\u0026 file.data.__sourceRef.code !== 'electronic_interaction_agreement';\n                }) : [];\n                filesArr = filesArr.sort((item1, item2) =\u003e {\n                    if (item2.data.__createdAt.after(item1.data.__createdAt)) {\n                        return -1;\n                    }\n                    else {\n                        return 1;\n                    }\n                });\n            }\n            let laborContractExists = false;\n            for (let file of filesArr) {\n                let fileRef = file.data.__sourceRef ? await file.data.__sourceRef.fetch() : file;\n                laborContractExists = fileRef.code === \"labor_contract\";\n                if (laborContractExists) {\n                    break;\n                }\n                ;\n            }\n            ;\n            if (filesArr \u0026\u0026 filesArr.length \u003e 0) {\n                numberOfDocs = filesArr.length;\n                for (let i = 0; i \u003c filesArr.length; i++) {\n                    const fileApp = filesArr[i];\n                    let isSigned = false;\n                    if (fileApp) {\n                        try {\n                            let itemRef = fileApp.data.__sourceRef ? await fileApp.data.__sourceRef : fileApp;\n                            const signHistory = await itemRef.getSignHistory();\n                            if (signHistory) {\n                                let dataSigns = await fileApp.getDataSigns();\n                                let sign = dataSigns.find((s) =\u003e s.type === \"file\");\n                                let hash = sign.hash;\n                                const fileSign = signHistory.filter((sign) =\u003e {\n                                    return sign.type === \"file\";\n                                });\n                                if (!!fileSign) {\n                                    for (let i = 0; i \u003c fileSign.length; i++) {\n                                        const signCheck = fileSign[i].signs.find((digitalSign) =\u003e (digitalSign.data.__userID === currentUser.data.__id || digitalSign.__userID === currentUser.data.__id)\n                                            \u0026\u0026 (digitalSign.data.sign || digitalSign.sign)\n                                            \u0026\u0026 (digitalSign.data.hash === hash || digitalSign.content === hash));\n                                        if (!!signCheck) {\n                                            isSigned = true;\n                                            numberOfSignedDocs++;\n                                            break;\n                                        }\n                                    }\n                                }\n                                else {\n                                    isSigned = false;\n                                }\n                            }\n                        }\n                        catch (e) {\n                            isSigned = false;\n                        }\n                    }\n                    await renderStep3String(fileApp, isSigned);\n                }\n                if (numberOfSignedDocs === numberOfDocs) {\n                    Context.data.all_docs_signed = true;\n                    Context.data.validation_string = \"true\";\n                }\n            }\n            else {\n                filesWrapper.textContent = 'Файлы отсутствуют';\n            }\n            hideLoader();\n            Context.data.all_documents_loaded = true;\n        }\n        ;\n        function showLoader() {\n            loaderEl.classList.add('kedo-loader-wrapper_active');\n        }\n        function hideLoader() {\n            loaderEl.classList.remove('kedo-loader-wrapper_active');\n        }\n        return {\n            renderFiles,\n            showLoader,\n            hideLoader\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n","clientFnDeclarations":[{"name":"renderFiles","parameters":[],"type":""},{"name":"showLoader","parameters":[],"type":""},{"name":"hideLoader","parameters":[],"type":""}]},"__createdAt":"2023-12-20T13:09:00.765822565Z","__createdBy":"7303b866-4220-4086-a09e-348a76b12c73","__updatedAt":"2024-02-26T12:11:32.258423486Z","__updatedBy":"6163c306-9e58-491d-b0e4-407d6cc24727","__deletedAt":null}
