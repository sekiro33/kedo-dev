{
  "__id": "018f9ed7-7e1e-74d6-86b2-60df28b8242c",
  "namespace": "kedo_ext.business_trips_page_kedo",
  "code": "_page",
  "__name": "Командировки",
  "description": "",
  "extensionZoneCode": "",
  "sort": 0,
  "category": "00000000-0000-0000-0000-000000000000",
  "version": 11,
  "hidden": true,
  "draft": false,
  "readonly": false,
  "descriptor": {
    "types": ["page"],
    "template": {
      "id": "0301690d-385a-4efc-8d5c-5920cf70d520",
      "descriptor": "portal-page",
      "content": {
        "": [
          {
            "id": "2c555f29-bdb7-4dfe-82cf-abce1abfde60",
            "descriptor": "portal-page-header",
            "values": {
              "__canRender": false
            },
            "content": {
              "[title]": []
            }
          },
          {
            "id": "974c2ed0-6a75-4c09-971e-eb618f01929d",
            "descriptor": "portal-page-body",
            "content": {
              "": [
                {
                  "id": "366f10e0-e4a1-43ba-b367-4692fc80b9e5",
                  "descriptor": "portal-left-page-sidebar",
                  "values": {
                    "__canRender": false
                  },
                  "content": {
                    "": []
                  }
                },
                {
                  "id": "98856d54-b267-4d9f-a8ae-8d3e28d4f56f",
                  "descriptor": "portal-page-content",
                  "values": {
                    "__baseURL": "",
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false,
                    "__outlet": "",
                    "__styles": "display: flex; flex-direction: column; gap: 2rem;"
                  },
                  "content": {
                    "": [
                      {
                        "id": "0b158698-87fb-4771-b863-50b8cdfcbf60",
                        "descriptor": "kedo_ext@last_business_trips_widget",
                        "descriptorVersion": 42,
                        "values": {
                          "closest_business_trips": {
                            "path": ["business_trips_app"]
                          },
                          "__outlet": "",
                          "__styles": "margin-bottom: 2rem;",
                          "staff_app": {
                            "path": ["staff_app"]
                          },
                          "statuses_app": {
                            "path": ["all_statuses"]
                          },
                          "__isConstValues": [],
                          "__baseURL": "",
                          "__relativeURL": "",
                          "business_trips_app": {
                            "path": ["business_trips_app"]
                          },
                          "__renderContentOnDemand": true
                        }
                      },
                      {
                        "id": "c0005456-22eb-42f9-b63a-035f93b532ef",
                        "descriptor": "kedo_ext@business_trips_widget",
                        "descriptorVersion": 135,
                        "values": {
                          "__baseURL": "",
                          "__isConstValues": [],
                          "all_business_trips": {
                            "path": ["all_business_trips"]
                          },
                          "business_trips_app": {
                            "path": ["business_trips_app"]
                          },
                          "__outlet": "",
                          "staff_app": {
                            "path": ["staff_app"]
                          },
                          "all_statuses": {
                            "path": ["all_statuses"]
                          },
                          "first_render": true,
                          "statuses_app": {
                            "path": ["all_statuses"]
                          },
                          "__relativeURL": "",
                          "__renderContentOnDemand": true
                        }
                      }
                    ]
                  }
                },
                {
                  "id": "0dcb54ef-6d39-4d9d-9b31-daacb28350f9",
                  "descriptor": "portal-right-page-sidebar",
                  "values": {
                    "__canRender": false
                  },
                  "content": {
                    "": []
                  }
                }
              ]
            }
          },
          {
            "id": "5e937856-17d2-4504-8a4d-d384f38b3cd3",
            "descriptor": "portal-page-footer",
            "values": {
              "__canRender": false
            },
            "content": {
              "": []
            }
          }
        ]
      }
    },
    "fields": [
      {
        "code": "business_trips_app",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "business_trips",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Приложение Командировки",
          "data": {},
          "input": true,
          "output": true
        }
      },
      {
        "code": "all_business_trips",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "business_trips",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Все командировки",
          "data": {},
          "input": true,
          "output": true
        }
      },
      {
        "code": "all_statuses",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "statuses",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Все статусы",
          "data": {},
          "input": true,
          "output": true
        }
      },
      {
        "code": "staff_app",
        "type": "SYS_COLLECTION",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {
          "code": "staff",
          "filter": {
            "value": {
              "tf": {}
            },
            "enabled": false
          },
          "namespace": "kedo"
        },
        "view": {
          "name": "Приложение Сотрудники",
          "data": {},
          "input": true,
          "output": true
        }
      }
    ],
    "fieldVisibilityConditions": {
      "staff_app": {
        "enabled": false,
        "conditions": []
      },
      "all_statuses": {
        "enabled": false,
        "conditions": []
      },
      "all_business_trips": {
        "enabled": false,
        "conditions": []
      },
      "business_trips_app": {
        "enabled": false,
        "conditions": []
      }
    },
    "scriptOptions": {},
    "clientScripts": "declare const console: any;\n\nasync function onInit(): Promise\u003cvoid\u003e {\n    const user = await System.users.getCurrentUser();\n    const staff = await Context.fields.staff_app.app.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.ext_user.eq(user)\n    )).first();\n\n    if (!staff) {\n        return;\n    };\n\n    const allBusinessTrip = await Context.fields.business_trips_app.app.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.kedo_staff.link(staff)\n    )).count().then(async count =\u003e await Context.fields.business_trips_app.app.search().where((f, g) =\u003e g.and(\n        f.__deletedAt.eq(null),\n        f.kedo_staff.link(staff)\n    )).size(count).all());\n\n    Context.data.business_trips_app = allBusinessTrip.slice(0, 2);\n    Context.data.all_businessTrips = allBusinessTrip;\n    Context.data.all_statuses = await Context.fields.all_statuses.app.search().where(f =\u003e f.__deletedAt.eq(null)).size(100).all();\n};",
    "clientScriptOptions": {
      "allowServer": true
    },
    "serverScripts": "/* Server scripts module */\n",
    "serverScriptOptions": {}
  },
  "dataNamespace": "",
  "dataCode": "",
  "runtime": {
    "version": 1,
    "clientScripts": "System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function onInit() {\n            const user = await System.users.getCurrentUser();\n            const staff = await Context.fields.staff_app.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.ext_user.eq(user))).first();\n            if (!staff) {\n                return;\n            }\n            ;\n            const allBusinessTrip = await Context.fields.business_trips_app.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.kedo_staff.link(staff))).count().then(async (count) =\u003e await Context.fields.business_trips_app.app.search().where((f, g) =\u003e g.and(f.__deletedAt.eq(null), f.kedo_staff.link(staff))).size(count).all());\n            Context.data.business_trips_app = allBusinessTrip.slice(0, 2);\n            Context.data.all_businessTrips = allBusinessTrip;\n            Context.data.all_statuses = await Context.fields.all_statuses.app.search().where(f =\u003e f.__deletedAt.eq(null)).size(100).all();\n        }\n        ;\n        return {\n            onInit\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n",
    "clientFnDeclarations": [
      {
        "name": "onInit",
        "parameters": [],
        "type": "[object Object]"
      }
    ],
    "clientDependencies": {
      "applications": [],
      "collections": [
        {
          "namespace": "kedo",
          "code": "staff"
        },
        {
          "namespace": "kedo",
          "code": "business_trips"
        },
        {
          "namespace": "kedo",
          "code": "statuses"
        }
      ],
      "pages": [],
      "extensions": []
    }
  },
  "__createdAt": "2024-05-22T05:47:53.758321877Z",
  "__createdBy": "5ba349d5-c2ab-4d83-b564-c7faf9af9bea",
  "__updatedAt": "2024-06-04T07:21:41.547105902Z",
  "__updatedBy": "dbcd4b7e-ff70-40ba-86fd-e93799d90891",
  "__deletedAt": null
}
