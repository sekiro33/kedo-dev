{
  "__id": "018e83e8-2d7c-7d67-a97b-1da4c493af66",
  "namespace": "kedo.document_types",
  "code": "print_form_row_widget",
  "__name": "Строка таблицы неизвестных печатных форм",
  "description": "",
  "extensionZoneCode": "",
  "sort": 0,
  "category": "00000000-0000-0000-0000-000000000000",
  "version": 1,
  "hidden": false,
  "draft": false,
  "readonly": false,
  "descriptor": {
    "icon": "menu_horizontal",
    "template": {
      "id": "538378bd-1808-40fc-b1c4-b2077020ff31",
      "descriptor": "component",
      "values": {
        "systemFunctions": {}
      },
      "content": {
        "": [
          {
            "id": "ba126674-f7e7-4194-9387-58a3ac127e96",
            "descriptor": "row",
            "values": {
              "__baseURL": "",
              "__relativeURL": "",
              "__isConstValues": [],
              "__renderContentAsync": false,
              "__renderContentOnDemand": false,
              "__outlet": "",
              "__styles": "border: 1px solid #D9D9D9; margin: 0; display: flex; flex-wrap: nowrap;"
            },
            "content": {
              "": [
                {
                  "id": "6935197f-58b4-4798-aa46-efbe6816ac4a",
                  "descriptor": "column",
                  "values": {
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false,
                    "__outlet": "",
                    "__styles": "padding: 10px; border-right: 1px solid #D9D9D9;",
                    "__baseURL": ""
                  },
                  "content": {
                    "": [
                      {
                        "id": "287f1caf-bdec-492b-9105-6456317a351e",
                        "descriptor": "dynamic-form-row",
                        "values": {
                          "tooltip": null,
                          "bindingMode": false,
                          "__renderContentOnDemand": false,
                          "__relativeURL": "",
                          "__isConstValues": [],
                          "__outlet": "",
                          "required": true,
                          "hideEmpty": false,
                          "__readOnly": {
                            "path": ["skip_print_form"]
                          },
                          "onChangeDone": {
                            "kind": "Function",
                            "name": "docTypeNameOnChange",
                            "type": "client"
                          },
                          "__baseURL": "",
                          "control": {
                            "path": ["doc_type_name"]
                          },
                          "__styles": "max-width: inherit",
                          "showDisplayName": false
                        }
                      }
                    ]
                  }
                },
                {
                  "id": "7c5f25a1-f100-44cd-b2c1-764c6bf77e65",
                  "descriptor": "column",
                  "values": {
                    "__baseURL": "",
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false,
                    "__outlet": "",
                    "__styles": "padding: 10px; border-right: 1px solid #D9D9D9; overflow: auto;"
                  },
                  "content": {
                    "": [
                      {
                        "id": "12af1c9f-4a96-4e18-a0d3-d5acb834c022",
                        "descriptor": "code",
                        "values": {
                          "contentPlaceholder": "Селектор приложений (Виджет-код)",
                          "html": "\u003c!-- В зависимости от того, было выбрано приложение или нет, будем отображать текст \"Выбрать приложение\" --\u003e\n\u003c!-- или название выбранного приложения. Оба текста кликабельны и открывают модальное окно для выбора приложения. --\u003e\n\n\u003c% if (!Context.data.app_name) { %\u003e\n    \u003c% if (Context.data.skip_print_form == false) { %\u003e\n        \u003cp class=\"custom-p-link\" onclick=\"\u003c%- Scripts%\u003e.openModal()\"\u003eВыбрать приложение\u003c/p\u003e\n    \u003c% } else { %\u003e\n        \u003cp class=\"disabled\"\u003eВыбрать приложение\u003c/p\u003e\n    \u003c% } %\u003e\n\u003c% } else { %\u003e\n    \u003c% if (Context.data.skip_print_form == false) { %\u003e\n        \u003cp class=\"custom-p-link\" onclick=\"\u003c%- Scripts%\u003e.openModal()\"\u003e\u003c%= Context.data.app_name %\u003e\u003c/p\u003e\n    \u003c% } else { %\u003e\n        \u003cp class=\"disabled\"\u003e\u003c%= Context.data.app_name %\u003e\u003c/p\u003e\n    \u003c% } %\u003e\n\u003c% } %\u003e\n\n\u003cstyle\u003e\n    .custom-p-link {\n        cursor: pointer;\n        color: #1e6599;\n    }\n\n    .disabled {\n        color: grey;\n        cursor: cursor;\n    }\n\n    .custom-p-link:hover {\n        cursor: pointer;\n        color: #1e6599;\n        text-decoration: underline;\n    }\n\u003c/style\u003e",
                          "hideContent": true
                        }
                      }
                    ]
                  }
                },
                {
                  "id": "89d3665a-f5d0-4619-a174-263302bdfaae",
                  "descriptor": "column",
                  "values": {
                    "__outlet": "",
                    "__styles": "padding: 10px; border-right: 1px solid #D9D9D9; overflow: auto;",
                    "__baseURL": "",
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false
                  },
                  "content": {
                    "": [
                      {
                        "id": "7aa92d1e-1259-4bea-94a6-b3d7ff1ed905",
                        "descriptor": "dynamic-form-row",
                        "values": {
                          "control": {
                            "path": ["print_form"]
                          },
                          "tooltip": null,
                          "hideEmpty": false,
                          "__readOnly": true,
                          "showDisplayName": false,
                          "__outlet": "",
                          "required": false,
                          "__baseURL": "",
                          "bindingMode": false,
                          "__relativeURL": "",
                          "__isConstValues": []
                        }
                      }
                    ]
                  }
                },
                {
                  "id": "3c20eb69-527e-40e1-ac29-e610d73901fa",
                  "descriptor": "column",
                  "values": {
                    "__styles": "padding: 10px; border-right: 1px solid #D9D9D9; overflow: auto;",
                    "__baseURL": "",
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false,
                    "__outlet": ""
                  },
                  "content": {
                    "": [
                      {
                        "id": "5adc405d-7a0f-400b-938a-ae54532be598",
                        "descriptor": "dynamic-form-row",
                        "values": {
                          "showDisplayName": false,
                          "control": {
                            "path": ["print_form_id"]
                          },
                          "tooltip": null,
                          "required": false,
                          "hideEmpty": false,
                          "__readOnly": true,
                          "bindingMode": false,
                          "__isConstValues": [],
                          "__outlet": "",
                          "__baseURL": "",
                          "__relativeURL": ""
                        }
                      }
                    ]
                  }
                },
                {
                  "id": "8bc84f76-063f-4fdf-b3a7-f2fc6f7d9ac5",
                  "descriptor": "column",
                  "values": {
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": false,
                    "__renderContentOnDemand": false,
                    "__outlet": "",
                    "__styles": "padding: 10px;",
                    "__baseURL": ""
                  },
                  "content": {
                    "": [
                      {
                        "id": "de50f3a2-42b1-4a4e-87ec-2fe3d908eb1e",
                        "descriptor": "dynamic-form-row",
                        "values": {
                          "onChangeValue": {
                            "kind": "Function",
                            "name": "skipPrintFormOnChange",
                            "type": "client"
                          },
                          "__isConstValues": [],
                          "showDisplayName": false,
                          "tooltip": null,
                          "required": false,
                          "__readOnly": null,
                          "bindingMode": false,
                          "control": {
                            "path": ["skip_print_form"]
                          },
                          "__styles": "width: 15px; max-width: 15px; min-width: 15px;",
                          "__renderContentOnDemand": false,
                          "__outlet": "",
                          "__baseURL": "",
                          "hideEmpty": false,
                          "__relativeURL": ""
                        }
                      }
                    ]
                  }
                }
              ]
            }
          },
          {
            "id": "d62952fa-a3b9-4baa-b136-cfc81571328f",
            "descriptor": "complex-popup",
            "values": {
              "__renderContentAsync": false,
              "__hidden": false,
              "__styles": "",
              "__baseURL": "",
              "__classes": "",
              "modalSize": [
                {
                  "code": "modal-sm",
                  "name": "Маленький"
                }
              ],
              "__isConstValues": [],
              "sidebarAvailable": false,
              "title": "Выбор документа ELMA",
              "visible": {
                "path": ["show_modal"]
              },
              "__outlet": "",
              "__relativeURL": ""
            },
            "content": {
              "[popup-footer]": [
                {
                  "id": "61d41833-2408-4594-a007-679225348925",
                  "descriptor": "row-layout",
                  "content": {
                    "": [
                      {
                        "id": "90833457-8c4c-41aa-a4ba-befc74d1a1a8",
                        "descriptor": "button",
                        "values": {
                          "view": "primary",
                          "label": "Выбрать",
                          "onClick": {
                            "kind": "Function",
                            "name": "selectElement",
                            "type": "client"
                          },
                          "__outlet": "",
                          "__baseURL": "",
                          "runInPopover": null,
                          "__isConstValues": [],
                          "runProcessSettings": {
                            "kind": "",
                            "settings": {
                              "code": "",
                              "field": "",
                              "binding": null,
                              "namespace": ""
                            }
                          },
                          "action": null,
                          "__relativeURL": "",
                          "runActionEnum": [
                            {
                              "code": "undefined",
                              "name": "shared.common.button@widget-runAction-none",
                              "translate": true
                            }
                          ],
                          "processPopoverSize": [
                            {
                              "code": "default",
                              "name": "shared.common.button@widget-process-popover-size-default",
                              "translate": true
                            }
                          ],
                          "createAppItemSettings": {
                            "kind": "",
                            "settings": {
                              "code": "",
                              "field": "",
                              "binding": null,
                              "namespace": ""
                            }
                          }
                        }
                      },
                      {
                        "id": "2e5ed26f-6456-4f48-83a5-015661d49306",
                        "descriptor": "button",
                        "values": {
                          "__outlet": "",
                          "__baseURL": "",
                          "runInPopover": null,
                          "__isConstValues": [],
                          "processPopoverSize": [
                            {
                              "code": "default",
                              "name": "shared.common.button@widget-process-popover-size-default",
                              "translate": true
                            }
                          ],
                          "runProcessSettings": {
                            "kind": "",
                            "settings": {
                              "code": "",
                              "field": "",
                              "binding": null,
                              "namespace": ""
                            }
                          },
                          "createAppItemSettings": {
                            "kind": "",
                            "settings": {
                              "code": "",
                              "field": "",
                              "binding": null,
                              "namespace": ""
                            }
                          },
                          "view": "danger",
                          "label": "Отмена",
                          "action": null,
                          "onClick": {
                            "kind": "Function",
                            "name": "closeModal",
                            "type": "client"
                          },
                          "__relativeURL": "",
                          "runActionEnum": [
                            {
                              "code": "undefined",
                              "name": "shared.common.button@widget-runAction-none",
                              "translate": true
                            }
                          ]
                        }
                      }
                    ]
                  }
                }
              ],
              "[popup-header]": [],
              "[popup-content]": [
                {
                  "id": "9849c2ca-118a-4af9-8118-acb821f43037",
                  "descriptor": "modal-body",
                  "values": {
                    "__outlet": "",
                    "__baseURL": "",
                    "__relativeURL": "",
                    "__isConstValues": [],
                    "__renderContentAsync": true
                  },
                  "content": {
                    "": [
                      {
                        "id": "74f097ba-cc9d-4db0-accb-e1e140b68e4c",
                        "descriptor": "kedo.document_types@solution_structure",
                        "descriptorVersion": 39,
                        "values": {
                          "__styles": "width: 100%;",
                          "__baseURL": "",
                          "__relativeURL": "",
                          "__isConstValues": [],
                          "selected_element": {
                            "path": ["selected_element"]
                          },
                          "__outlet": ""
                        }
                      }
                    ]
                  }
                }
              ],
              "[popup-sidebar]": [],
              "[popup-controls]": [],
              "[popup-upper-header]": []
            }
          },
          {
            "id": "e0ab5c25-f8bb-42b9-8b9c-f93d4a5cfedb",
            "descriptor": "dynamic-form-row",
            "values": {
              "tooltip": null,
              "onChangeValue": {
                "kind": "Function",
                "name": "appCodeOnChange",
                "type": "client"
              },
              "displayName": "Код документа (hidden)",
              "__relativeURL": "",
              "required": false,
              "hideEmpty": false,
              "__baseURL": "",
              "bindingMode": false,
              "__isConstValues": [],
              "showDisplayName": true,
              "__hidden": true,
              "__outlet": "",
              "control": {
                "path": ["app_code"]
              },
              "__readOnly": null
            }
          }
        ]
      }
    },
    "fields": [
      {
        "code": "print_form",
        "type": "FILE",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": true,
        "required": false,
        "single": false,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Печатная форма",
          "data": {},
          "input": true,
          "output": false
        }
      },
      {
        "code": "print_form_id",
        "type": "STRING",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "ID печатной формы",
          "data": {
            "additionalType": "string"
          },
          "input": true,
          "output": false
        }
      },
      {
        "code": "doc_type_name",
        "type": "STRING",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Название вида печатной формы",
          "data": {
            "additionalType": "string"
          },
          "input": true,
          "output": false
        }
      },
      {
        "code": "app_code",
        "type": "STRING",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Код документа",
          "data": {
            "additionalType": "string"
          },
          "input": true,
          "output": false
        }
      },
      {
        "code": "app_name",
        "type": "STRING",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Название документа",
          "data": {
            "additionalType": "string"
          },
          "input": true,
          "output": false
        }
      },
      {
        "code": "show_modal",
        "type": "BOOLEAN",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": false,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Отобразить модальное окно?",
          "data": {
            "additionalType": "radio",
            "noValue": "Нет",
            "yesValue": "Да"
          },
          "input": false,
          "output": false
        }
      },
      {
        "code": "selected_element",
        "type": "JSON",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Выбранный документ",
          "data": {},
          "input": false,
          "output": false
        }
      },
      {
        "code": "cache_guid",
        "type": "STRING",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "cache_guid",
          "data": {
            "additionalType": "string"
          },
          "input": true,
          "output": false
        }
      },
      {
        "code": "skip_print_form",
        "type": "BOOLEAN",
        "searchable": false,
        "indexed": false,
        "deleted": false,
        "array": false,
        "required": false,
        "single": true,
        "defaultValue": null,
        "calcByFormula": false,
        "formula": "",
        "data": {},
        "view": {
          "name": "Не учитывать печатную форму",
          "data": {
            "additionalType": "checkbox",
            "noValue": "Нет",
            "yesValue": "Да"
          },
          "input": true,
          "output": false
        }
      }
    ],
    "fieldVisibilityConditions": {
      "app_code": {
        "enabled": false,
        "conditions": []
      },
      "app_name": {
        "enabled": false,
        "conditions": []
      },
      "cache_guid": {
        "enabled": false,
        "conditions": []
      },
      "print_form": {
        "enabled": false,
        "conditions": []
      },
      "show_modal": {
        "enabled": false,
        "conditions": []
      },
      "doc_type_name": {
        "enabled": false,
        "conditions": []
      },
      "print_form_id": {
        "enabled": false,
        "conditions": []
      },
      "skip_print_form": {
        "enabled": false,
        "conditions": []
      },
      "selected_element": {
        "enabled": false,
        "conditions": []
      }
    },
    "scriptOptions": {},
    "clientScripts": "/* Client scripts module */\n\ndeclare const document: any;\n\ninterface ILineDetail {\n    docTypeName?: string,\n    appCode?: string,\n    appName?: string,\n    printFormID: string,\n    skipPrintForm: boolean,\n}\n\nasync function selectElement(): Promise\u003cvoid\u003e {\n    if (!Context.data.selected_element) {\n        return;\n    }\n\n    /** Переменная Context.data.selected_element связана с виджетом \"Структура решений\".\n     * При выборе приложения данное поле обновляется и туда записываются данные по выбранному приложенияю.\n     */\n    Context.data.app_name = Context.data.selected_element.name;\n    Context.data.app_code = Context.data.selected_element.code;\n\n    await closeModal();\n}\n\nasync function openModal(): Promise\u003cvoid\u003e {\n    Context.data.show_modal = true;\n}\n\nasync function closeModal(): Promise\u003cvoid\u003e {\n    if (!Context.data.app_code) Context.data.selected_element = undefined;\n    Context.data.show_modal = false;\n}\n\n/** Функция для обмена данными с основной формой через кэш.\n * Вызывается при изменеии полей виджета.\n * cache_guid - уникальный идентификатор для кэша. Нужен для предотвращения коллизий.\n */\nasync function updateRow(): Promise\u003cvoid\u003e {\n    const cache_guid = Context.data.cache_guid;\n\n    const row_details: ILineDetail = {\n        docTypeName: Context.data.doc_type_name,\n        appCode: Context.data.app_code,\n        appName: Context.data.app_name,\n        printFormID: Context.data.print_form_id!,\n        skipPrintForm : Context.data.skip_print_form ?? false,\n    }\n\n    await System.cache.setItem(`update_line_${cache_guid}`, JSON.stringify(row_details));\n\n    const update_button = document.querySelector(\".update-button-trigger\");\n\n    if (!update_button) {\n        throw new Error(\"Не удалось обновить информацию в таблице.\");\n    }\n\n    update_button.querySelector(\"button\").click();\n}\n\nasync function docTypeNameOnChange(): Promise\u003cvoid\u003e {\n    await updateRow();\n}\n\nasync function appCodeOnChange(): Promise\u003cvoid\u003e {\n    await updateRow();\n}\n\nasync function skipPrintFormOnChange(): Promise\u003cvoid\u003e {\n    await updateRow();\n}\n",
    "clientScriptOptions": {
      "allowServer": true
    },
    "serverScripts": "/* Server scripts module */\n",
    "serverScriptOptions": {}
  },
  "dataNamespace": "",
  "dataCode": "",
  "runtime": {
    "version": 1,
    "clientScripts": "System.register([], function (exports_1, context_1) {\n    \"use strict\";\n    var __moduleName = context_1 \u0026\u0026 context_1.id;\n    function default_1(Context, ViewContext, Server, System) {\n        async function selectElement() {\n            if (!Context.data.selected_element) {\n                return;\n            }\n            Context.data.app_name = Context.data.selected_element.name;\n            Context.data.app_code = Context.data.selected_element.code;\n            await closeModal();\n        }\n        async function openModal() {\n            Context.data.show_modal = true;\n        }\n        async function closeModal() {\n            if (!Context.data.app_code)\n                Context.data.selected_element = undefined;\n            Context.data.show_modal = false;\n        }\n        async function updateRow() {\n            var _a;\n            const cache_guid = Context.data.cache_guid;\n            const row_details = {\n                docTypeName: Context.data.doc_type_name,\n                appCode: Context.data.app_code,\n                appName: Context.data.app_name,\n                printFormID: Context.data.print_form_id,\n                skipPrintForm: (_a = Context.data.skip_print_form) !== null \u0026\u0026 _a !== void 0 ? _a : false,\n            };\n            await System.cache.setItem(`update_line_${cache_guid}`, JSON.stringify(row_details));\n            const update_button = document.querySelector(\".update-button-trigger\");\n            if (!update_button) {\n                throw new Error(\"Не удалось обновить информацию в таблице.\");\n            }\n            update_button.querySelector(\"button\").click();\n        }\n        async function docTypeNameOnChange() {\n            await updateRow();\n        }\n        async function appCodeOnChange() {\n            await updateRow();\n        }\n        async function skipPrintFormOnChange() {\n            await updateRow();\n        }\n        return {\n            selectElement,\n            openModal,\n            closeModal,\n            updateRow,\n            docTypeNameOnChange,\n            appCodeOnChange,\n            skipPrintFormOnChange\n        };\n    }\n    exports_1(\"default\", default_1);\n    return {\n        setters: [],\n        execute: function () {\n        }\n    };\n});\n",
    "clientFnDeclarations": [
      {
        "name": "selectElement",
        "parameters": [],
        "type": "[object Object]"
      },
      {
        "name": "openModal",
        "parameters": [],
        "type": "[object Object]"
      },
      {
        "name": "closeModal",
        "parameters": [],
        "type": "[object Object]"
      },
      {
        "name": "updateRow",
        "parameters": [],
        "type": "[object Object]"
      },
      {
        "name": "docTypeNameOnChange",
        "parameters": [],
        "type": "[object Object]"
      },
      {
        "name": "appCodeOnChange",
        "parameters": [],
        "type": "[object Object]"
      },
      {
        "name": "skipPrintFormOnChange",
        "parameters": [],
        "type": "[object Object]"
      }
    ],
    "clientDependencies": {
      "applications": [],
      "collections": [],
      "pages": []
    }
  },
  "__createdAt": "2024-03-28T07:13:35.097883468Z",
  "__createdBy": "cd06151e-bd48-4554-bb3b-34ae2f4e4eb3",
  "__updatedAt": "2024-03-28T07:13:35.097883468Z",
  "__updatedBy": "cd06151e-bd48-4554-bb3b-34ae2f4e4eb3",
  "__deletedAt": null
}
